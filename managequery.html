{% load static %}
<style>
textarea.form-control {
    min-height: calc(4.5em + (0.75rem + 2px));
}

.ibex-card-section .dropdown .dropdown-menu{
    box-shadow: rgba(99, 99, 99, 0.2) 0px 0.2rem 0.7rem 0px;
    border:none;
}
.ibex-card-section .dropdown a:focus{
    outline: 0;
    box-shadow: none;
}

.ibex-card-section .ibex-wraper .crt-btn{
    background: #58b056;
    border: #58b056;
    padding: 0.8rem 1.5rem;
    font-size: 1.1rem;
    filter: drop-shadow(0px 0.4rem 0.4rem rgba(0, 0, 0, 0.25));
}
.ibex-card-section .in-c input::placeholder{
	color: #4d42b9;
}
.ibex-card-section .in-c input{
background: #ecf3ff;
border-radius: 1.5rem;
border: 0;
padding: 0.8rem 1.5rem;
width: 100%;
}
.ibex-card-section .in-c{
	display: flex;
	position: relative;
  width: 85%;
  margin: 0 0 0 auto;
}
.ibex-card-section .in-c i{
	    color: #4d42b9 !important;
    font-size: 1.5rem;
    position: absolute;
    right: 1rem;
    top: 0.8rem;
}

.ibex-card-section .ibex-wraper i{
	font-size: 1.5rem;
	margin-right: 0.8rem;
	 color: #b0b0b0;
	     vertical-align: middle;
}
.ibex-card-section .ibex-wraper h4 {
    display: inline-block;
   color: #8d8d8d;
    font-size: 1rem;
    font-weight: 400;
    }
  .ibex-card-section .ibex-wraper .dropdown-toggle::after{
   	color: #b0b0b0;
   }
   .ibex-card-section .ibex-wraper{
   margin: 1.8rem;
}
   .ibex-card-section .rgt-wrap{
   	display: flex;
   	    justify-content: end;
   }
    .ibex-card-section .card-list ul{
    	display: flex;

   
    }
    .ibex-card-section li{
    	list-style: none;
        display: inline-flex;
    }
        .ibex-card-section .card-list ul li{
        	
        	color: #8d8d8d;
        	    padding: 0.6rem 1rem;
            border: 0.1rem solid #ddd;
        }
        .ibex-card-section .card-list ul li.list-bg{
        background: #ecf3ff;
        border-top-left-radius: 0.5rem;
        border-bottom-left-radius: 0.5rem;
        border-right: 0;
    }
    .ibex-card-section .card-list ul li.rgt-list{
    	border-top-right-radius: 0.5rem;
    	border-bottom-right-radius: 0.5rem;	
    }
    .ibex-card-section .card-btm .switch{
    position: relative;
    display: inline-block;
    width: 1.5rem;
    height: 0.7rem;
    margin: 0.5rem 0.5rem 0px 0;
    line-height: 0.8rem;
    margin-top: 4px;
    margin-left: 10px;
}
.ibex-card-section .card-btm .switch input{
    opacity: 0;
    width: 0;
    height: 0;
}
.ibex-card-section .card-btm .slider.round {
    border-radius: 2.8rem;
}
.ibex-card-section .card-btm .slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #616161;
    -webkit-transition: .4s;
    transition: .4s;
}
.ibex-card-section .card-btm .slider:before{
        position: absolute;
    content: "";
    height: 0.6rem;
    width: 0.6rem;
    left: 0;
    bottom: 0.1rem;
    background-color: white;
    -webkit-transition: .4s;
    transition: .4s;
}
.ibex-card-section .card-btm .slider.round:before {
    border-radius: 50%;
}
.ibex-card-section .card-btm input:checked + .slider {
  background-color: #2196F3;
}

.ibex-card-section .card-btm input:focus + .slider {
  box-shadow: 0 0 0.1rem #2196F3;
}

.ibex-card-section .card-btm input:checked + .slider:before {
  -webkit-transform: translateX(1.625rem);
  -ms-transform: translateX(1.625rem);
  transform: translateX(1.625rem);
}
.ibex-card-section .card-btm input:checked + .slider:before {
    left: -0.8rem;
}
.ibex-card-section .card-btm  ul{
	display: flex;
    align-items: center;
    justify-content: space-between;
        padding: 0rem 1rem;
    /* background: #1c6bb9; */
    color: #fff;
        border-bottom-left-radius: 1rem;
    border-bottom-right-radius: 1rem;
}
.ibex-card-section .card-btm  ul li i{
	color: #000;
	color: #000;
    background: #ecf3ff;  
    /* checkbox background color */
    padding: 0.55rem;
    margin: 0.5rem;
    border-radius: 50%;
    font-size: 0.9rem;
    width: 1.938rem;
    height: 1.938rem;
    text-align: center;
}
.ibex-card-section .ibex-card {
    background: #fff;
    padding: 0.9rem 1.8rem 0.1rem;
    margin: 0.8rem 0 0;
     min-height: 15.625rem;
}
.ibex-card-section .card-btm .switch:before {
           position: absolute;
    content: "";
    background: #ecf3ff;
    padding: 0.9rem;
    top: -0.6rem;
    border-radius: 50%;
    left: -0.2rem;
    width: 2rem;
    height: 2rem;
}
.ibex-card-section .ibex-card h2{
	margin-top: 1.5rem;
    font-size: 1.8rem;
        margin-bottom: 0.2rem;
}

.ibex-card-section .ibex-card p{
	margin-bottom: 1.875rem;
}
.ibex-card-section .card-ibox {
    box-shadow: 0px 0.3rem 0.4rem #D8D8D8;
        border-bottom-left-radius: 1rem;
    border-bottom-right-radius: 1rem;

}
.ibex-card-section img.tcs {
    height: 4.063rem;
}
.ibex-card-section .i-logo {
    min-height: 4.063rem;
        display: flex;
    align-items: center;
}
.ibex-card-section .pagination li i{
    font-size: 0.8rem;
} 
.ibex-card-section .pagination li {
    margin-right: 1rem;
    border-radius: 0.3rem;
}
.ibex-card-section .page-link {
    padding: 0.5rem 1rem;
    color: #000;
    border-radius: 0.3rem;
}
.ibex-card-section .pagination a.page-link{
font-weight: 600;
}
.ibex-card-section .pagination a.page-link:hover {
    background: #ecf3ff;
    color: #4d42b9;
    border-color: #4d42b9;
}
.ibex-card-section .pagination li.page-item.page-s {
    margin-right: 0;
}


.ibex-card-section .ibex-title h2{
    /*margin-top: 1.5rem;*/
    margin-left: 1.5rem;
}

@media(max-width: 1024px){
    .ibex-card-section .rgt-wrap{
        justify-content: left;
            flex-wrap: wrap;
    }
    .card-list{
        margin-top: 0.8rem;
    }
    .ibex-card-section .ibex-card h2{
        font-size: 1.5rem;
    }
    .ibex-card-section .ibex-card{
        min-height: 16.875rem;
    }
}
@media(max-width: 991px){
    html {
    font-size: 0.8rem;
}

    .ibex-card-section .rgt-wrap {
    
        flex-wrap: inherit;
        margin-left: -0.1rem;
    margin-top: 0.8rem;
}
.ibex-card-section .card-list ul li{
    width: 6.875rem;
    margin-top: -0.8rem;
}
}

@media(max-width: 767px){
    .ibex-card-section .in-c{
            margin: 0.8rem 0;
    }
    .ibex-card-section .card-list ul{
        padding-left: 0;
    }
    .ibex-card-section .ibex-card {
    min-height: 12.5rem;
    margin: 0;
}
.ibex-card-section .pagination li {
    margin-right: 0.8rem;
    }
    .pagination{
        justify-content: center !important;
    }
    .ibex-card-section .ibex-wraper {
    margin: 0.5rem;
}
.rgt-wrap .i-bor{
    padding: 0;
    border: 0;
}
.ibex-card-section .in-c{
    width: 100%;
}
.ibex-card-section .ibex-title h2{
    margin-left: 0.5rem;
    font-size: 1.5rem;
}
.ibex-card-section .ibex-wraper i{
    margin-right: 0.3rem;
    font-size: 1rem;
}
.ibex-card-section .card-list ul li {
    width: 6.5rem;
    margin-top: -0.7rem;
    padding: 0.5rem 1rem;
    }
    .card-list{
        margin-left: 1.2rem;
    }
    .ibex-card-section .rgt-wrap{
        margin-top: 0;
            margin-left: 0.8rem;
    }
}

@media(max-width: 320px){
    .ibex-card-section .card-list ul li {
      width: 5.5rem;
      margin-top: -0.7rem;
      padding: 0.5rem 0.5rem;
  }
}

/* link add name color change 8-05-2023 */

.ibex-wraper .card-ibox .card-btm ul li a{
    color: #fff;
    text-decoration: none;
}
</style>
<div class="tab-pane fade show accordion-item active"  id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">                      
  <h2 class="accordion-header " id="headingOne"></h2>
  <div class="accordion-body">
  <div id="collapseOne" class="accordion-collapse  show  d-lg-block" style="border-color:black;" aria-labelledby="headingOne" data-bs-parent="#myTabContent" >
     
      <div class="row justify-content-center" style="height:300px;width:1200px;" id="buttonrow">
          <div class="col-lg-3" style="margin-top:10px;">
            <form   action="{% url 'userform' %}" method="post">{% csrf_token %}
              <select class="parenttable form-control border" id="pagename" onclick="ajax_gettablename()" name='pagename' required>
              </select><br> 
              </div>
              <div class="row justify-content-center">
                <div class="col-2">
                  <div class="create-new-field mt-3" id="createbutton" style="padding-top:10px;display:none;">
                    <button type="button" class="btn create-btn" style="background-color:#CCDFFF;color:#5B5E71;margin-bottom: 50px;"><i class="fa fa-plus me-1" aria-hidden="true"></i> {{ get_chache_formbuildbtn }}</button>
                    <input type="hidden" id="formbuilderurl" name="formbuilderurl" value={{ form_builderurl }}>
                  </div>
                </div>  
                <!-- {% comment %} <div class="col-2">
                  <div class="create-new-field mt-3" id="viewbutton" style="padding-top:10px;display:none;text-align:end;">
                    <button type="submit" class="btn create-btn" id="viewpage" style="background-color:#CCDFFF;color:#5B5E71;"><i class="fa fa-eye me-1" aria-hidden="true"></i> {{ get_chache_formview }}</button>
                  </div>
                </div> {% endcomment %} -->
            </form>
            <!-- {% comment %} <div class="col-4">
              <div class="create-new-field mt-3" id="logintheme" style="padding-top:10px;">
                <a href="{% url 'loginpagetheme'  %}"><button type="button" class="btn create-btn" style="background-color:#CCDFFF;color:#5B5E71;"><i class="fa fa-plus me-1" aria-hidden="true"></i>Login page</button></a>
              </div>
            </div>{% endcomment %} -->
          </div> 
          <div class="row justify-content-center"> 
            <div class="col-2">
              <input type="button" style="display: none;"name="formdata" id="formdata">
            </div> 
         </div> 
          <div class="row justify-content-center">
            <div class="col-2">
              <input type="button" style="display: none;"name="manageqdata" id="manageqdata">
            </div>  
          </div> 
          <input type="hidden" id="userid" name="userid" value="{{ userid }}">
      </div>
    
      <div class="container" id="queryselection" style="display:none;">
        <div class="row justify-content-end" style="margin-top:10px;margin-bottom:10px;">
          <div class="col-4" id="querydisplaymsg">

          </div>
          <div class="col-2">
            <button type="button" class="btn" style="background-color:#BCBCBC;color:white;" id="top_previousbutton"><i class="fa fa-arrow-circle-up" style="color:white;" ></i>&nbsp;{{ get_chache_previous }}</button>
          </div>
        </div>
        <div class="" >
          <div class="overflow">
            <div id ="querymessage">
              
            </div>
            <div class="querymessagebody">
            <div class="panel panel-default">
              <div class="panel-heading">
                  <h6 class="panel-title">{{ get_chache_selecttablecol }}</h6>
              </div>
              <div class="panel-body">
                <form name="template" class="form-horizontal">
                  <!-- Left Column -->
                  <div class="row form-btm-space">
                    <div class="col-md-3">
                        <label>{{ get_chache_selectfromtable }}</label>
                        <select name="select_tablename" id="select_tablename" class="form-control" type="text" onchange="getval();"> 
                        </select>
                    </div>
                    <div class="col-md-3">
                      <label>{{ get_chache_coltolist }}</label>
                      <select class="selectpicker" id="selectpicker" name='columnid[]' multiple data-live-search="true" >
                        <option value="" disabled>{{ get_chache_selectcolumnerror }}</option>
                      </select>
                    </div>
                  </div>
                </form>
              </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading">
             <h6 class="panel-title">{{ get_chache_join }}</h6>
          </div>
          <div class="panel-body">
             <form name="template" class="form-horizontal">
             <!-- Left Column -->
             <!-- Enga -->
             <div class="row form-btm-space">
                <div class="col-md-3">
                   <label>{{ get_chache_jointypes }}</label>
                   <select name="element1" id="jointypes" class="form-control" type="text">
                    <option disabled selected>{{ get_chache_selectjoins }}</option>
                    <option value='INNER JOIN'>{{ get_chache_innerjoin }}</option>
                    <option value='LEFT JOIN'>{{ get_chache_leftjoin }}</option>
                    <option value='RIGHT JOIN'>{{ get_chache_rightjoin }}</option>
                   </select>
                </div>
                <div class="col-md-3">
                   <label>{{ get_chache_jointable }}</label>
                   <select name="element1" id="jointables" class="form-control" type="text">
                     <option value="" selected disabled>{{ get_chache_selectjointableerror }}</option>
                   </select>
                </div>

                <div class="col-md-3" id="selectcolumn_alisename">
                  <label>Display columnn</label>
                  <select class="selectpicker" id="Joincolumnname" name='columnid[]' multiple data-live-search="true" >
                    <option value="" disabled>{{ get_chache_selectcolumnerror }}</option>
                  </select>
                </div>
                <div id="column_alisename" style="display:none;"></div>

                <div class="col-md-3">
                   <label>{{ get_chache_joincondition }}</label>
                   <select name="element1" id="joincondition" class="form-control" type="text">
                    <option value="{{ get_chache_selectcondition }}" disabled selected>{{ get_chache_selectcondition }}</option>
                    <option value="ON" id ='joinon'>{{ get_chache_on }}</option>
                    <option value="AND" id='joinand' style="display:none">{{ get_chache_and }}</option>
                    <option values="OR" id='joinor' style="display:none">{{ get_chache_or }}</option>
                   </select>
                </div>
                <div class="col-md-3">
                   <label>{{ get_chache_joincols }}</label>
                   <select name="joincolumns" id="joincolumns" class="form-control" type="text">
                     <option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>
                   </select>
                </div>
             </div>
             <div class="row form-btm form-btm-space">
                <div class="col-md-3">
                   <label>{{ get_chache_conditionaloper }}</label>
                   <select name="element1" id="join_check_condition" class="form-control" type="text">
                    <option disabled selected>{{ get_chache_selectcondition }}</option>
                    <option value="=">=</option>
                    <option value="IN">IN</option>
                    <option value="NOT IN ">NOT IN</option>
                    <option value="<>"><></option>
                    <option value="!=">!=</option>
                    <option value=">">></option>
                    <option value=">=">>=</option>
                    <option value="<"><</option>
                    <option value="<="><=</option>
                    <option value="NOT">NOT</option>
                    <option value="BETWEEN">BETWEEN</option>
                    <option value="IS NULL">IS NULL</option>
                    <option value="IS NOT NULL">IS NOT NULL</option>
                    <option value="LIKE">LIKE</option>
                    <option value="EXISTS">EXISTS</option>
            
                   </select>
                </div>
                <div class="col-md-3" id ="from_table_show_data" style="display: none;">
                  <label>{{ get_chache_joinfromtbl }}</label>
                  <select name="element1" id="joinfromtablelist" class="form-control" type="text">
                    <option value="" selected disabled>{{ get_chache_selectjointableerror}}</option>
                  </select>
               </div>
               <div class="col-md-3" id ="from_column_show_data" style="display: none;">
                <label>{{ get_chache_joinfromcol }}</label>
                <select name="element1" id="joinfromcolumns" class="form-control" type="text">
                  <option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>
                </select>
             </div>
    
             <div class="col-md-3" id="from_joincheck" style="display: none;" >
              <input type="checkbox" id="joincheck" name="joincheck" value="1">
              <label style="margin-top: 30px;">{{ get_chache_isparenttable }}</label>
           </div>
    
           <div class="col-md-3" id ="joincolumnvalues_data" style="display: none;">
            <label>{{ get_chache_joincolvalues }}:</label>
            <select class="selectpicker" id="joincolumnvalues" name='joincolumnvalues' multiple data-live-search="true"   required>
              <option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>
            </select>
            </form>
          </div>
         <!-- Upto here -->
            <div class="col-md-3" id="joindynamic_checkbox">
              <input type="checkbox" id="joindynamic" name="joindynamic" value="1">
              <label style="margin-top: 30px;">{{ get_chache_isparenttable }}</label>
              <button class="btn join-btn" style="background-color:#99B0CE;" id="joincolumn_go">
              {{ get_chache_go }}
              </button>
              <div id="output1" style="display:none;">0</div>
            </div>
        </div>
             <div class="row join_complited_go">
                <div class="col-md-8">
                  <label for="exampleFormControlTextarea1" class="form-label">{{ get_chache_fromjointext }} </label>
                   <textarea name="element7" class="form-control input-lg" id="fromjoin_execute" rows="3"></textarea>
                </div>
                <div class="col-md-4" style="margin-top:70px;">
                   <button class="btn join-btn" style="background-color:#99B0CE;" id="join_go">
                    {{ get_chache_go }}
                   </button>
                   <div id="output" style="display:none;">0</div>
                </div>
    
             </div>
          </div>
       </div>
        <!-- WHERE CONDITION -->
       <div class="panel panel-default">
        <div class="panel-heading">
           <h6 class="panel-title"><strong>{{ get_chache_where }}</strong></h6>
        </div>
        <div class="panel-body">
           <form name="template" class="form-horizontal">
            <!-- Left Column -->
            <div class="row form-btm-space">
                <div class="col-md-3">
                  <label>{{ get_chache_wherecondition }}:</label>
                  <select name="element1" id="wherecondition" class="form-control" type="text">
                    <option disabled selected>{{ get_chache_selectcondition }}</option>
                    <option value="WHERE" id='where_option'>{{ get_chache_where }}</option>
                    <option value="AND" id="and_option" style="display: none;" >{{ get_chache_and }}</option>
                    <option value="OR" id="or_option" style="display: none;" >{{ get_chache_or }}</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label>{{ get_chache_headtablelist }}</label>
                  <select name="element1" id="select" class="form-control" type="text">
                    <option value="" disabled selected>{{ get_chache_selecttableerrormsg }}</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label>{{ get_chache_joincondition }}</label>
                  <select name="element1" id="select_columns" class="form-control" type="text">
                    <option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label>{{ get_chache_conditionaloper }}</label>
                  <select name="element1" id="where_check_condition" class="form-control" type="text">
                    <option disabled selected>{{ get_chache_selectcondition }}</option>
                    <option value="=">=</option>
                    <option value="IN">IN</option>
                    <option value="NOT IN ">NOT IN</option>
                    <option value="<>"><></option>
                    <option value="!=">!=</option>
                    <option value=">">></option>
                    <option value=">=">>=</option>
                    <option value="<"><</option>
                    <option value="<="><=</option>
                    <option value="NOT">NOT</option>
                    <option value="BETWEEN">BETWEEN</option>
                    <option value="IS NULL">IS NULL</option>
                    <option value="IS NOT NULL">IS NOT NULL</option>
                    <option value="LIKE">LIKE</option>
                    <option value="EXISTS">EXISTS</option>
                  </select>
                </div>
            </div>
              <div class="row form-btm form-btm-space" id="dynamic" >
                <div class="col-md-3" id ="get_columvalues" style="display:none;">
                  <label>{{ get_chache_colvalues }}:</label>
                  <select class="selectpicker" id="select_columnsvalues" name='select_columnsvalues' multiple data-live-search="true"   required>
                    <option value="" disabled>{{ get_chache_selectcolumnerror }}</option>
                  </select>
                </div>
                <div class="col-md-3" id="get_perpandoption">
                  <input type="checkbox" id="defaultvalues" name="defaultvalues" value="1">
                  <label style="margin-top: 30px;">{{ get_chache_isparenttable }}</label>
                  <button class="btn join-btn" style="background-color:#99B0CE;" id="condition_executed">{{ get_chache_go }}</button>
                </div>
                <!-- <div class="col-md-3">
                  <button class="btn btn-lg btn-success join-btn" id="condition_executed">Go</button>
                  </div>
              </div> -->
              </div>
            </form>  
      </div>
      </div>
      <!-- WHERE CONDITION -->
      <div class="panel panel-default"id="groupby_hideshow">
        <div class="panel-heading">
           <h6 class="panel-title">{{ get_chache_groupby }}</h6>
        </div>
        <div class="panel-body">
           <form name="template" class="form-horizontal">
            <!-- Left Column -->
            <div class="row form-btm-space">
              <div class="col-md-3">
                <label>{{ get_chache_groupcollist }}:</label>
                <select class="selectpicker" id="groupby_columnlist" name='groupby_columnid[]' multiple data-live-search="true" required>
                  <option value="" disabled>{{ get_chache_selectcolumnerror }}</option>
                </select>
              </div>
  
              <div class="col-md-3">
                <label>{{ get_cache_get_groupbycon }}:</label>
                <select name="groupbycondition_val" id="groupbycondition" class="form-control" type="text">
                  <option disabled selected>{{ get_chache_selectcondition }}</option>
                  <option value ='STRING_AGG'>STRING_AGG</option>
                  <option value ='ARRAY_AGG'>ARRAY_AGG</option>
                </select>
              </div>

              <div class="col-md-3">
                <label>{{ get_cache_get_aggrfunc }}:</label>
                <select class="selectpicker" id="aggregatefunctions" name='groupby_columnid[]' multiple data-live-search="true" required>
                  <option value="" disabled>{{ get_chache_selectcolumnerror }}</option>
                </select>
              </div>
  
              
            </div>
          </form>
         </div>
        </div>
    
      <div class="panel panel-default"id="orderby_hideshow">
      <div class="panel-heading">
         <h6 class="panel-title">{{ get_chache_orderby }}</h6>
      </div>
      <div class="panel-body">
         <form name="template" class="form-horizontal">
         <!-- Left Column -->
         <div class="row form-btm-space" >
            <div class="col-md-3">
               <label>{{ get_chache_ordertablelist }}:</label>
               <select name="orderby_table" id="orderby_table" class="form-control" type="text"> 
                <option value="" disabled selected>{{ get_chache_selecttableerrormsg }}</option>
               </select>
            </div>
            <div class="col-md-3">
             <label>{{ get_chache_ordercollist }}:</label>
             <select name="orderby_columnlist" id="orderby_columnlist" class="form-control" type="text"> 
              <option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>
            </select>
            </div>
            <div class="col-md-3">
              <label>{{ get_chache_ordertype }}:</label>
              <select name="orderbylist" id="orderbylist" class="form-control" type="text"> 
                <option disabled selected>{{ get_chache_selectlist }}</option>
                <option value='ASC'>{{ get_chache_asc }}</option>
                <option value ='DESC'>{{ get_chache_desc }}</option>
              </select>
             </div>
             <div class="col-md-2" style="margin-top:20px;">
              <button class="btn join-btn" type="button" style="background-color:#99B0CE;" id="orferby_go">{{ get_chache_go }}</button>
            </div>
         </div>
       </div>
      </form>
    </div>
    
    
    <div class="panel panel-default"id="limits_hideshow">
      <div class="panel-heading">
         <h6 class="panel-title">{{ get_chache_limit }}</h6>
      </div>
      <div class="panel-body">
         <form name="template" class="form-horizontal">
         <!-- Left Column -->
         <div class="row form-btm-space" >
            <div class="col-md-3">
               <label>{{ get_chache_limits }}:</label>
               <input type="number" id="limitsnumbers" name ="properties[wallpaper_size_width]"class="form-control">
               </select>
            </div>
          </div>
        </form>
       </div>
      </div>
     
      <form name="template" class="form-horizontal">
        <!-- Left Column -->
        <div class="row form-btm-space mt-3" >
           <div class="col-md-3">
              <label><strong>{{ get_chache_queryshortname }} &nbsp;<span style="color:red;">*</span>:</strong></label>
              <input type="text" id="queryshortname" name ="queryshortname"class="form-control">
           </div>
         </div>
       </form>
    
        <div class="col-md-12" style="margin-top: 20px;">
          <strong> {{ get_chache_querygeneratorsec }}</strong> 
          <div  style="margin-top: 10px;" id ='queryset'>
            <span id='selectquery'> </span>
            <span id='groupbydata'  class="disabled"> </span>
            <span id='selectquery2' class="disabled"> </span>
            <span id='joinquery'> </span>
            <span id='joincolumnquery'> </span>
            <span id='wherequery'> </span>
            <span id='groupbyquery'> </span>
            <span id='orderbyquery'> </span>
            <span id='limitsquery'> </span>
          </div>
          <div id ="joincolumnsalisedata"></div>
        </div>
    
        <label for="exampleFormControlTextarea1" class="form-label">{{ get_chache_queryexecution }}</label>
        <textarea class="form-control" id="exampleFormControlTextarea1" rows="1"></textarea>
        {% comment %} <form action="{% url 'grid_datadetails' %}" method="post">{% csrf_token %}
          <input type="hidden" class="form-control" id="gridprojectname" name='projectname' value=''>
          <input type="hidden" class="form-control" id="gridquerydata" name='queryvalues' value=''>
          <button type="submit" class="btn join-btn" style="margin-top: 10px;background-color:#99B0CE;" id="query_savebutton" >Save</button>
        </form>
        <button type="button" class="btn" style="background-color:#BCBCBC;color:white;margin-top: 10px;" id="bottom_previousbutton"><i class="fa fa-arrow-circle-up" style="color:white;"></i>&nbsp;{{ get_chache_previous }}</button>
        <div id="querysucess" style="margin-bottom:80px;"></div> {% endcomment %}
        <button type="button" class="btn" style="background-color:#99B0CE;color:white;margin-top: 10px;" id="query_savebutton">Save</button>
        <button type="button" class="btn" style="background-color:#BCBCBC;color:white;margin-top: 10px;" id="bottom_previousbutton"><i class="fa fa-arrow-circle-up" style="color:white;"></i>&nbsp;{{ get_chache_previous }}</button>
        
        <div id="querysucess" style="margin-bottom:80px;"></div>
        <div id ="joincolumn_select"></div>
        </div>
        <div class="application-data" style="margin-top:10px;" >
          <div class="title">
            <div class="table-responsive" >
                <table class="w-75 table m" id="querytabledata" style="margin-left: 100px;">
                  <thead>
                    <tr style="border-color: #C8C9CA;border-top-style: #C8C9CA;background-color:#F7F7F7;">
                      <th class="col-4" style="font-weight:600;">Pagename</th>
                      <th class="col-4" style="font-weight:600;">Query shortname</th>
                      <th class="col-4" style="font-weight:600;">Query manage</th>
                    </tr>
                  </thead>
                  <tbody id="querydatalist">

                  </tbody>
                </table>
            </div>
          </div>
        </div>
        <div id="queryidappend" style="display:none;"></div>
        <!-- Dropdown Update and edit-->
        <div class="modal" tabindex="-1" role="dialog" id ="editboxshow" style="display: none;">
          <div class="modal-dialog" role="document">
            <div class="modal-content" style="width: 900px">
              <div class="modal-header">
                <h5 class="modal-title">Query update</h5>
                <button type="button" class="close btn" data-dismiss="modal" id ="editquery_closebutton" onclick="closebutton()" aria-label="Close">
                  <span aria-hidden="true" style="width:20px; height: 10px;
                  font-size: large;">X</span>
                </button>
              </div>
              <div class="modal-body" id="querycontent">
                <div class="form-group purple-border">
                  <label for="queryshortname_values"><strong>Query</strong></label>
                  <textarea class="form-control" id="querycontent_readonlydata" rows="3" disabled></textarea>
                </div>
                <div class="form-group mt-2">
                  <label for="queryshortname_values">Query shortname:</label>
                  <input type="text" class="form-control" id="queryshortname_values" value =''>
                </div>    
              </div>
              <div class="panel-body">
                <form name="template" class="form-horizontal">
                  <!-- Left Column -->
                  <div class="row form-btm-space">
                    <div class="col-md-3">
                        <label>{{ get_chache_selectfromtable }}</label>
                        <select name="update_tablename" id="update_tablename" class="form-control" type="text" onchange="getupdateval();"> 
                        </select>
                    </div>
                    <div class="col-md-3" style="margin-right: 27px;">
                      <label>{{ get_chache_coltolist }}</label>
                      <select class="selectpicker" id="selectpicker1" name='columnid[]' multiple data-live-search="true" >
                        <option value="" disabled>{{ get_chache_selectcolumnerror }}</option>
                      </select>
                      <span id="querysave" style="display: none;"></span>
                    </div>
                    <div class="col-md-3" style="margin-right: 10px;">
                      <button type="button" class="btn" style="background-color:#99B0CE;color:white;margin-top: 10px;margin-left: 40px;" id ="selectqueryupdatebutton">Go query</button>
                      </button>
                    </div>
                    <div class="col-md-2">
                      <button type="button" class="btn" style="background-color:rgb(0, 0, 0);color:#99B0CE;margin-left: -62px;" id ="jointoggledisplay">Join query</button>
                      </button>
                    </div>
                    <div class="col-md-2">
                      <button type="button" class="btn" style="background-color:rgb(225, 225, 225);color:#99B0CE;margin-top: 12px;" id ="wheretoggledisplay">Where query</button>
                      </button>
                    </div>
                    <div class="col-md-3">
                      <button type="button" class="btn" style="background-color:rgb(0, 0, 0);color:rgb(225, 225, 225);margin-top: 12px;" id ="groupbytoggledisplay">Groupby query</button>
                      </button>
                    </div>
                  </div>
                </form>
              </div>
              <div class="panel-body" id="jointypesfunctions" style="margin-top: -34px;">
                <form name="template" class="form-horizontal">
                  <div class="panel-heading">
                    <span><section class="ibex-card-section">    
                      <div class="card-btm">
                          
                      </div>    
                  </section></span>   
                 </div>
            <div class="col">     
              <div id="carouselExampleControlsNoTouching" class="carousel slide" data-bs-touch="false" data-bs-interval="false">
                <div class="carousel-inner">
                  <div class="carousel-item active" id="carousel-item-main">
                    <div class="row form-btm-space">
                      <div class="col-md-3">
                         <label>{{ get_chache_jointypes }}</label>
                         <select name="element1" id="joinupdatetypes" class="form-control" type="text">
                          <option value="" selected disabled>{{ get_chache_selectjoins }}</option>
                          <option value='INNER JOIN'>{{ get_chache_innerjoin }}</option>
                          <option value='LEFT JOIN'>{{ get_chache_leftjoin }}</option>
                          <option value='RIGHT JOIN'>{{ get_chache_rightjoin }}</option>
                         </select>
                         
                      </div>
                      <div class="col-md-3">
                         <label>{{ get_chache_jointable }}</label>
                         <select name="element1" id="joinupdatetables" class="form-control" type="text">
                         </select>
                      </div>   
                      <div class="col-md-3" id="selectcolumn_alisename">
                        <label>Joincolumnname</label>
                        <select class="selectpicker" id="Joinupdatecolumnname" name='columnid[]' multiple data-live-search="true" >
                          <option value="" disabled>{{ get_chache_selectcolumnerror }}</option>
                        </select>
                      </div>
                      <div id="column_alisename" style="display:none;"></div>
                      <div class="col-md-3">
                         <label>{{ get_chache_joincondition }}</label>
                         <select name="element1" id="joinupdatecondition" class="form-control" type="text">
                          <option value="{{ get_chache_selectcondition }}" disabled selected>{{ get_chache_selectcondition }}</option>
                          <option value="ON" id ='joinupdateon'>{{ get_chache_on }}</option>
                          <option value="AND" id='joinupdateand' style="display:none">{{ get_chache_and }}</option>
                          <option values="OR" id='joinupdateor' style="display:none">{{ get_chache_or }}</option>
                         </select>
                      </div>
                      <div class="col-md-3">
                         <label>{{ get_chache_joincols }}</label>
                         <select name="joinupdatecolumns" id="joinupdatecolumns" class="form-control" type="text">
                          <option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>
                         </select>
                      </div> 
                </div>
                <div class="row form-btm form-btm-space" style="margin-top: -39px;">
                  <div class="col-md-3">
                     <label>{{ get_chache_conditionaloper }}</label>
                     <select name="element1" id="join_updatecheck_condition" class="form-control" type="text">
                       <option value="" selected disabled>{{ get_chache_selectcondition }}</option>
                       <option value="=">=</option>
                       <option value="IN">IN</option>
                       <option value="NOT IN">NOT IN</option>
                       <option value="<>"><></option>
                       <option value="!=">!=</option>
                       <option value=">">></option>
                       <option value=">=">>=</option>
                       <option value="<"><</option>
                       <option value="<="><=</option>
                       <option value="NOT">NOT</option>
                       <option value="BETWEEN">BETWEEN</option>
                       <option value="IS NULL">IS NULL</option>
                       <option value="IS NOT NULL">IS NOT NULL</option>
                       <option value="LIKE">LIKE</option>
                       <option value="EXISTS">EXISTS</option>
                     </select>
                  </div>
                  <div class="col-md-3" id ="from_table_show_updatedata" style="display: none;">
                    <label>{{ get_chache_joinfromtbl }}</label>
                    <select name="element11" id="joinfromupdatetablelist" class="form-control" type="text">
                    </select>
                    <!-- joinfromtablelist -->
                 </div>
                 <div class="col-md-3" id ="from_column_show_updatedata" style="display: none;">
                  <label>{{ get_chache_joinfromcol }}</label>
                  <select name="element1" id="joinfromupdatecolumns" class="form-control" type="text">
                    <option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>
                  </select>   
                  <!-- joinfromcolumns -->
               </div>
      
               <div class="col-md-3" id="from_updatejoincheck" style="display: none;" >
                <input type="checkbox" id="joinupdatecheck" name="joinupdatecheck" value="1">
                <label style="margin-top: 30px;">isparent textinput</label>
              </div>
      
             <div class="col-md-3" id ="joincolumnvalues_updatedata" style="display: none;">
              <label>{{ get_chache_joincolvalues }}:</label>
              <select class="selectpicker" id="joincolumnupdatevalues" name='joincolumnupdatevalues' multiple data-live-search="true"   required>
                <option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>
              </select>
              <!-- joincolumnvalues -->
             </div>
             <div class="col-md-3" id="joinupdatedynamic_checkbox">
               <span><input type="checkbox" id="joinupdatedynamic" name="joinupdatedynamic" value="1">
               <label style="margin-top: 30px;">{{ get_chache_isparenttable }}</label>
               <button class="btn join-btn" style="background-color:#99B0CE;" id="joincolumn_updatego">
               {{ get_chache_go }}
               </button></span>
               <div id="outputupdate1" style="display:none;"></div>
               </div>
              </div>
              <div class="row join_complited_go" style="margin-top: -10px;" >
                <div class="col-md-3">
                  <label for="exampleFormControlTextarea1" class="form-label">{{ get_chache_fromjointext }} </label>
                  <textarea name="element7" class="form-control input-lg" id="fromjoin_updateexecute" rows="3"></textarea>
                </div>
                <div class="col-md-3" style="margin-top:70px;">
                  <button class="btn join-btn" style="background-color:#99B0CE;" id="join_updatego">
                    {{ get_chache_go }}
                  </button>
                  <div id="outputupdate" style="display:none;">0</div>
                </div>
           </div>
            </div>
            
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide="prev" style="width: 0px;">
                  <i class="fa fa-angle-left" aria-hidden="true" style="color: #9ebcdd;font-size: 93px;margin-right: 106px;"></i>
                  <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide="next" style="width: 0px;">
                  <i class="fa fa-angle-right" aria-hidden="true" style="color: #9ebcdd;font-size: 93px;margin-left: 106px;"></i>
                  <span class="visually-hidden">Next</span>
                </button>
              </div>
            </div>                 
               </form>
            </div>
              <!-- WHERE CONDITION -->
        <div class="panel-heading" id="wheredisplay">
           <h6 class="panel-title"><strong>{{ get_chache_where }}</strong></h6>
        </div>
        <div class="panel-body" id="wheredisplay1" style="margin-top: -15px;">
           <form name="template" class="form-horizontal">
            <!-- Left Column -->
            <div class="row form-btm-space">
                <div class="col-md-3">
                  <label>{{ get_chache_wherecondition }}:</label>
                  <select name="element1" id="whereupdatecondition" class="form-control" type="text">
                    <option disabled selected>{{ get_chache_selectcondition }}</option>
                    <option value="WHERE" id='where_optionupdate'>{{ get_chache_where }}</option>
                    <option value="AND" id="and_optionupdate" style="display: none;" >{{ get_chache_and }}</option>
                    <option value="OR" id="or_optionupdate" style="display: none;" >{{ get_chache_or }}</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label>{{ get_chache_headtablelist }}</label>
                  <select name="element1" id="selectupdate" class="form-control" type="text">
                      
                  </select>
                </div>
                <div class="col-md-3">
                  <label>{{ get_chache_joincondition }}</label>
                  <select name="element1" id="select_updatecolumns" class="form-control" type="text">
                    <option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label>{{ get_chache_conditionaloper }}</label>
                  <select name="element1" id="where_check_updatecondition" class="form-control" type="text">
                    <option value="" disabled>{{ get_chache_selectcondition }}</option>
                    <option value="=">=</option>
                    <option value="IN">IN</option>
                    <option value="NOT IN ">NOT IN</option>
                    <option value="<>"><></option>
                    <option value="!=">!=</option>
                    <option value=">">></option>
                    <option value=">=">>=</option>
                    <option value="<"><</option>
                    <option value="<="><=</option>
                    <option value="NOT">NOT</option>
                    <option value="BETWEEN">BETWEEN</option>
                    <option value="IS NULL">IS NULL</option>
                    <option value="IS NOT NULL">IS NOT NULL</option>
                    <option value="LIKE">LIKE</option>
                    <option value="EXISTS">EXISTS</option>
                  </select>
                </div>
            </div>
            <div class="row form-btm form-btm-space" id="dynamicupdate" >
              <div class="col-md-3" id ="get_updatecolumvalues" style="display: none;">
                <label>{{ get_chache_colvalues }}:</label>
                  <select class="form-control" type="text" id="select_updatecolumnsvalues" name="element1" data-live-search="true" required="">
                    <option value="" disabled>{{ get_chache_selectcolumnerror }}</option>
                </select>
              </div>
              <div class="col-md-3" id="get_perpandoption" style="margin-top: -36px;">
                <input type="checkbox" id="defaultvaluesupdate" name="defaultvaluesupdate" value="1">
                <label style="margin-top: 30px;">{{ get_chache_isparenttable }}</label>
                <button class="btn join-btn" style="background-color:#99B0CE;" id="condition_updateexecuted">{{ get_chache_go }}</button>
              </div>
              <!-- <div class="col-md-3">
                <button class="btn btn-lg btn-success join-btn" id="condition_executed">Go</button>
                </div>
            </div> -->
            </div>
            </form>  
      </div>
      <div class="panel-body" id="groupby_updatehideshow" style="margin-top: -30px;">
        <div class="panel-heading">
          <h6 class="panel-title">{{ get_chache_groupby }}</h6>
        </div>
        <form name="template" class="form-horizontal">
         <!-- Left Column -->
         <div class="row form-btm-space">
           <div class="col-md-3">
             <label>{{ get_chache_groupcollist }}:</label>
             <select class="selectpicker" id="groupby_updatecolumnlist" name='groupby_updatecolumnid[]' multiple data-live-search="true" required>
              <option value="" disabled>{{ get_chache_selectcolumnerror }}</option> 
            </select>
           </div>
  
           <div class="col-md-3">
            <label>groupby condition:</label>
            <select name="groupbycondition_val" id="groupbyconditionupdate" class="form-control" type="text">
              <option value="" selected disabled>selectcondition</option>
              <option value ='STRING_AGG'>STRING_AGG</option>
              <option value ='ARRAY_AGG'>ARRAY_AGG</option>
            </select>
          </div>

           <div class="col-md-3">
             <label>aggregatefunctions:</label>
             <select class="selectpicker" id="aggregatefunctionsupdate" name='groupby_updatecolumnid[]' multiple data-live-search="true" required>
              <option value="" disabled>{{ get_chache_selectcolumnerror }}</option>
             </select>
           </div>

         </div>
       </form>
      </div>
      <div class="panel-body">
        <div class="col-md-12" id ='querysetupdatedisplay'style="margin-top: -26px;">
          <strong> {{ get_chache_querygeneratorsec }}</strong> 
          <div  style="margin-top: 10px;" id ='querysetupdate'>
            <span id='selectqueryupdate'></span>
            <span id='selectquery1update'></span>
            <span id='groupbydataupdate'> </span>
            <span id='selectquery2update'> </span>
            <span id='joinqueryupdate'> </span>
            <span id='joincolumnquery'> </span>
            <span id='wherequeryupdate'> </span>
            <span id='groupbyqueryupdate'> </span>
            <span id='orderbyqueryupdate'> </span>
            <span id='limitsqueryupdate'> </span>
          </div>
          <div id ="joincolumnsalisedata"></div>
        </div>
        <div class="row form-btm-space">
          <div class="form-group purple-border" style="margin-top: 10px;">
            <label for="querycontent_data"><strong>Updated Query</strong></label>
            <textarea class="form-control" id="querycontent_data" rows="3"></textarea>
          </div>
      </div>	
    </div>  
    
      <!-- WHERE CONDITION --> 
              <div class="modal-footer">
                <button type="button" class="btn" style="background-color:#99B0CE;color:white;margin-top: 10px;" id ="queryupdatebutton"onclick="editquerydetails()">Update</button>
              </div> 
            </div>
          </div>
        </div>
    </div>
  </div>
</div>
</div>
      
  </div>
</div>
<script>
  function joinfunction_toggle(){
    $('#samplecheckbox').click(function(){
      var selectqueryvaluid =  $('#selectqueryupdate').html()
      var value = "*";
      var asteric_check = selectqueryvaluid.includes(value) ? "Yes" : "No";
      var from_query_val = $("#selectquery2update").text(); 
      $("#joinupdateon").show();
      $('#joinupdateand').prop('disabled', 'disabled');
      $('#joinupdateor').prop('disabled', 'disabled');
      $('#joinupdateon').removeAttr('disabled');
      $('#joinqueryupdate').text("")
      $('#join_updatecheck_condition option[value =""]').prop('selected', true); 
      $('#joinupdatetypes option[value =""]').prop('selected', true); 
      $('#joinfromupdatecolumns').empty();    
      $('#joinfromupdatecolumns').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>');  
      $('#joinupdatecolumns').empty();    
      $('#joinupdatecolumns').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>'); 
      $('#fromjoin_updateexecute').val("")
      $('#selectquery1update').text("")
      $('#joincolumnupdatevalues').empty()
      $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
      $('#joincolumnupdatevalues').selectpicker('refresh');  
      //Join button starts   selectupdate
      $('#Joinupdatecolumnname').empty();
      $('#Joinupdatecolumnname').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
      $('#Joinupdatecolumnname').selectpicker('refresh')
      $('#joinupdatecondition option[value="select condition"]').prop('selected', true);
      var val_arr = $("select#aggregatefunctionsupdate option").map(function() {return $(this).val();}).get()
      $('#joinupdatetypes option[value =""]').prop('selected', true);
      
      for(var i = 0; i < val_arr.length; i++){    
          if(val_arr[i].search('a1.') > -1){
          $('#aggregatefunctionsupdate').find('[value="'+val_arr[i]+'"]').remove()
          $('#aggregatefunctionsupdate').selectpicker("refresh");
        }
      } 
      var val_arr_groupby = $("select#groupby_updatecolumnlist option").map(function() {return $(this).val()}).get()
      for(var i = 0; i < val_arr_groupby.length; i++){    
          if(val_arr_groupby[i].search('a1.') > -1){
          $('#groupby_updatecolumnlist').find('[value="'+val_arr_groupby[i]+'"]').remove()
          $('#groupby_updatecolumnlist').selectpicker("refresh");
        }
      }          
      var select_updatecolumnsvalues = JSON.stringify($("#select_updatecolumnsvalues").val())
      var urllist = window.location.pathname;
      var url=urllist.split('/');
      var projectid=url[2];
      var tableid =$("#update_tablename :selected").val();

      var tablename = $('#update_tablename :selected').text()
      var columnname =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
      var aliasesname = $("#update_tablename :selected").data("aliases");
      var wheretablename =  $("#selectupdate :selected").text();
      var select_updatecolumnsvalues = JSON.stringify($("#select_updatecolumnsvalues").val());
      var stringvalarray = []
  
  $('#select_updatecolumnsvalues option[value='+select_updatecolumnsvalues+']').prop('selected', true);
  
  //---------------------------join_query_linktable----------------------------------------
      var pagename =$('#pagename').val();
      var array = pagename.split(",");
      var pageid =(array[2]);  
    
      $.ajax({
            type : 'POST',
            url :"/ajax_tanlename/",
            async: false,
            data:{'projectid':projectid,'pageid':pageid},
            success : function(data) {

              $('#joinupdatetables').empty();
              $('#joinupdatetables').append('<option value="" selected disabled>{{ get_chache_selectjointableerror }}</option>');
              $.each(data.tablename, function(idx2,kvalue){ 
                $('#joinupdatetables').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');
              });
            }
        });// Main table
      


      var projectid = $('#projectid').val();
      var urllist = window.location.pathname;
      var url=urllist.split('/');
      var projectid=url[2];
      $.ajax({
            type : 'POST',
            url :"/ajaxwhere_tablelist/",
            async: false,
            data:{'projectid':projectid,'tableid':tableid},
            dataType : 'json',
            success : function(data) {
              $('#joinfromupdatetablelist').empty();
              $('#joinfromupdatetablelist').append('<option value="" selected disabled>{{ get_chache_selectjointableerror}}</option>');      
              $.each(data.table_data, function(idx2,kvalue){ 
                $('#joinfromupdatetablelist').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');
              });
            }
          });      
      var tableid = $("#joinfromupdatetablelist :selected").val();
      var urllist = window.location.pathname;
      var url=urllist.split('/');
      var projectid=url[2];
      
      $.ajax({
          url :"/column_list/",
          type : 'POST',
          async: false,
          data:{'projectid':projectid,'tableid':tableid},
          dataType : 'json',
          success : function(data){
            $('#joinfromupdatecolumns').empty();
            $('#joinfromupdatecolumns').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
            $('#joinfromupdatecolumns').append('<option value="id">id</option>');
            $('#joinfromupdatecolumns').append('<option value="status">status</option>');
            $('#joinfromupdatecolumns').append('<option value="createdon">createdon</option>');
            $('#joinfromupdatecolumns').append('<option value="createdby">createdby</option>');
            $('#joinfromupdatecolumns').append('<option value="modifiedon">modifiedon</option>');
            $('#joinfromupdatecolumns').append('<option value="modifiedby">modifiedby</option>'); 
            
            $.each(data.get_columnname, function(idx2,kvalue){ 
              $('#joinfromupdatecolumns').append('<option value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
              });
            $('#joinfromupdatecolumns option[value =""]').prop('selected', true);  
            $('#joinfromupdatecolumns').empty();   
            }    
          }); 
          $('#joinfromupdatetablelist option[value =""]').prop('selected', true); 
          var q = $('#querysetupdate').text();
          var ans = $.trim(q.replace(/\s/g, ' '))
          var finalquery = ans.replace(/ +/g, " ")
          const result1 = {};
          // create an array from the input
          const count1 = finalquery.split(' ');
          for(let word of count1){
              // if the word is already in the result object, increment the count
              if(result1[word]) {
                result1[word]++;
              } else{
                // otherwise, add the word to the result object with a count of 1
                result1[word] = 1;
              }
                  }
          var join_count1 = result1['JOIN']
          if(asteric_check != "No"){
            $('#groupby_updatehideshow').hide();
            $('#selectqueryupdate').html(selectqueryvaluid)
            $('#selectpicker1 option').prop('selected', true);
            $( "#selectpicker1 option:first-child" ).prop('selected', false);
            $('#selectpicker1').selectpicker('refresh')
            var r = $('#querysetupdate').text();
            var ans1 = $.trim(r.replace(/\s/g, ' '))
            var finalquery1 = ans1.replace(/ +/g, " ")
            $('#querycontent_data').val(finalquery1);  
          }else{
            if(join_count1 == undefined){
            $("#selectquery2update").text("")
            if(tablename != null && tablename != '' && columnname != [] && columnname != ''){
              for(var i = 0; i < columnname.length; i++){
                    var strvalconvert=aliasesname+'.'+columnname[i]+' as '+aliasesname+'_'+columnname[i]
                    stringvalarray.push(strvalconvert)
                    var my_string = stringvalarray.join()
                          }                
                var data = "select "+my_string+" from "+ tablename +" as "+ aliasesname +"" 
                $('#querycontent_data1').val(data);
                $("#selectqueryupdate").html(data); 
                $("#joinsection1").show();
                var r = $('#querysetupdate').text();
                var ans1 = $.trim(r.replace(/\s/g, ' '))
                var finalquery1 = ans1.replace(/ +/g, " ")
                $('#querycontent_data').val(finalquery1);  
            }else{
              //pass
              }
          }
          }
          
      })
   
}
function joinfunction_toggle1(countt){
    if(countt > 0){
      $('#joinfromupdatecolumns'+countt+'').empty();
      $('#joinfromupdatecolumns'+countt+'').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>');  
      var val_count = countt + 1
      //joinupdatetables1 click function
    $("#joinupdatetables"+countt+"").click(function(){
    var tableid = $("#joinupdatetables"+countt+" :selected").val();
    var tablename = $("#joinupdatetables"+countt+" :selected").text();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
  
    $.ajax({
      url :"/column_list/",
      type : 'POST',
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data) {
        $('#joinupdatecolumns'+countt+'').empty();
        $('#joinupdatecolumns'+countt+'').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>');
        $('#joinupdatecolumns'+countt+'').append('<option data-datatype="serial" value="id">id</option>');
        $('#joinupdatecolumns'+countt+'').append('<option data-datatype="int4" value="status">status</option>')
        $('#joinupdatecolumns'+countt+'').append('<option value="createdon">createdon</option>');
        $('#joinupdatecolumns'+countt+'').append('<option value="createdby">createdby</option>');
        $('#joinupdatecolumns'+countt+'').append('<option value="modifiedon">modifiedon</option>');
        $('#joinupdatecolumns'+countt+'').append('<option value="modifiedby">modifiedby</option>');
        $.each(data.get_columnname, function(idx2,kvalue){   
          $('#joinupdatecolumns'+countt+'').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
        }); 
        $('#Joinupdatecolumnname'+countt+'').empty();
        $('#Joinupdatecolumnname'+countt+'').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
        $('#Joinupdatecolumnname'+countt+'').append('<option value="id">id</option>');
        $('#Joinupdatecolumnname'+countt+'').append('<option value="status">status</option>');       
        $('#Joinupdatecolumnname'+countt+'').append('<option value="createdon">createdon</option>');
        $('#Joinupdatecolumnname'+countt+'').append('<option value="createdby">createdby</option>');
        $('#Joinupdatecolumnname'+countt+'').append('<option value="modifiedon">modifiedon</option>');
        $('#Joinupdatecolumnname'+countt+'').append('<option value="modifiedby">modifiedby</option>');  
        $.each(data.get_columnname, function(idx2,kvalue){
          $('#Joinupdatecolumnname'+countt+'').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
            }); 
            $('#Joinupdatecolumnname'+countt+'').selectpicker("refresh")
          }
        }); 
      });

      //Joinupdatecolumnname change function
      $("#Joinupdatecolumnname"+countt+"").change(function (){   
            var querydata = $("#querycontent_data").val();    
            var key =  $("#Joinupdatecolumnname"+countt+" :selected").map((_, e) => e.value).get();
            var value =  $("#Joinupdatecolumnname"+countt+" :selected").map((_, e) => e.text).get();
            column_data = value 
            string = JSON.stringify(column_data);
            
            var urllist = window.location.pathname;
            var url=urllist.split('/');
            var projectid=url[2];
            var tableid =  $("#joinupdatetables"+countt+"").val();
            var aliasesname=$("#joinupdatetables"+countt+" :selected").data("aliases");
            $.ajax({
              url :"/ajax_option/",
              type : 'POST',
              async: false,
              data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname},
              dataType : 'json',
              success : function(data) {
                $.each(data.string_val3, function(idx2,kvalue){ 
                    $("#groupby_updatecolumnlist").append('<option value="'+aliasesname+'.'+kvalue+'">'+aliasesname+'.'+kvalue+'</option>');
                  });
              }
            });
            $('#groupby_updatecolumnlist').selectpicker('refresh')  
      });
       // joinupdatedynamic CHECKBOX for columnvalues
      $("#joinupdatedynamic"+countt+"").click(function(){
        data =$("#joinupdatedynamic"+countt+"").val()
        var datatype = $("#joinupdatecolumns"+countt+" :selected").data("datatype");
        var joincondition =$("#joinupdatecondition"+countt+" :selected").val();
        
        if($(this).is(":checked")&&(joincondition !='AND')){
          $("#from_table_show_updatedata"+countt+"").show();
          $("#from_column_show_updatedata"+countt+"").show();
          $("#fromjoin_condition_col"+countt+"").show();
          $("#from_updatejoincheck"+countt+"").hide();
          $("#joincolumnvalues_updatedata"+countt+"").hide();
        }else{
          $("#from_table_show_updatedata"+countt+"").hide();
          $("#from_column_show_updatedata"+countt+"").hide();
          $("#from_updatejoincheck"+countt+"").show();
          $('#joinfromupdatetablelist'+countt+' option[value =""]').prop('selected', true);
          $('#joinfromupdatecolumns'+countt+'').empty();
          $('#joinfromupdatecolumns'+countt+'').append(' <option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>')
          var values=$('#joinupdatecheck'+countt+'').prop('checked', true);
          if($("#joinupdatecheck"+countt+"").is(":checked")){
            $("#joincolumnvalues_updatedata"+countt+"").show();
            $("#joininput_data"+countt+"").hide();
            var tableid = $("#joinupdatetables"+countt+" :selected").text();
            var urllist = window.location.pathname;
            var url=urllist.split('/');
            var projectid=url[2];
            var column_id = $("#joinupdatecolumns"+countt+" :selected").text();          
            $.ajax({
              type:'POST',
              url:"/join_columnvalues/",
              async:false,
              data:{'projectid':projectid,'tableid':tableid,'column_id':column_id},
              datatype:'json',
              success : function(data) {
                if(column_id =='status'){
                  $('#joincolumnupdatevalues'+countt+'').empty();
                  $('#joincolumnupdatevalues'+countt+'').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                  $.each(data.status_values, function(idx21,value) { 
                    $('#joincolumnupdatevalues'+countt+'').append('<option value="'+value+'">'+value+'</option>');
                  });                    
                }else{
                  $('#joincolumnupdatevalues'+countt+'').empty();
                  $('#joincolumnupdatevalues'+countt+'').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                  $.each(data.column_values, function(idx2,kvalue) { 
                    $.each(kvalue, function(idx21,kvalue1){ 
                      $('#joincolumnupdatevalues'+countt+'').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
                    });
                  }); 
                    }
                    $('#joincolumnupdatevalues'+countt+'').selectpicker('refresh')   
                  }
                });
          }else{
            $("#joininput_data"+countt+"").show();
            $("#joincolumnvalues_data"+countt+"").hide();
                } 
              }
            });
            $("#joinupdatecondition"+countt+"").click(function(){
                var joincolname = $("#Joinupdatecolumnname"+countt+" :selected").map((_, e) => e.value).get();
                var joincolname_len = (joincolname.length);
                $('#join_columnupdatenames_error'+countt+'').remove();
                if(joincolname_len == 0){
                  var join_columnnames_errormsg = "please select columns"
                  join_columnnames_error = join_columnnames_errormsg
                  $('#Joinupdatecolumnname'+countt+'').parent().after("<span id='join_columnupdatenames_error"+countt+"' class='error_msg'>"+join_columnnames_error+"</span>");
                  $('#joinupdatecondition'+countt+' option[value="select condition"]').prop('selected', true);
                  return false
                }
              });

            $("#join_updatecheck_condition"+countt+"").click(function(){
                  var joincondition =$("#joinupdatecondition"+countt+" :selected").val();
                  var join_check_condition =$("#join_updatecheck_condition"+countt+" :selected").val();
                  if(joincondition =='ON'){
                    $('#joinupdatedynamic'+countt+'').prop('checked', true);
                    $("#from_table_show_updatedata"+countt+"").show();
                    $("#from_column_show_updatedata"+countt+"").show();
                    $("#from_updatejoincheck"+countt+"").hide();
                    $("#joincolumnvalues_updatedata"+countt+"").hide();
                    $("#joininput_data"+countt+"").hide();
                  }else{
                    $('#joinupdatedynamic'+countt+'').prop('checked', false);
                    $('#joinupdatecheck'+countt+'').prop('checked', true);
                    $("#from_table_show_updatedata"+countt+"").hide();
                    $("#from_column_show_updatedata"+countt+"").hide();
                    $("#joininput_data"+countt+"").hide();
                    $("#from_updatejoincheck"+countt+"").show();
                    $("#joincolumnvalues_updatedata"+countt+"").show();
                  } 
                });  
            
            $('#joinupdatecheck'+countt+'').click(function(){
                var datatype = $("#joinupdatecolumns"+countt+" :selected").data("datatype");
                data =$('#joinupdatecheck'+countt+'').val()
              
                if($(this).is(":checked")){
                  $("#joincolumnvalues_updatedata"+countt+"").show();
                  $("#joininput_data"+countt+"").hide();
                }else{
                  $("#joincolumnvalues_updatedata"+countt+"").hide();
                  $('#from_updatejoincheck'+countt+'').after('<div class="col-md-3" id ="joininput_data'+countt+'"><label>Column values</label style="margin-left: -36px;"><input type="text" id="text_joininputtypes'+countt+'" name="varchartext" style="margin-left: -36px;" required="true"></div>')
                  if((datatype == "int")||(datatype =="int4")||(datatype =="int8")||(datatype =="bigint") || (datatype =="float4") || (datatype =="float8") ||(datatype =="decimal") ||(datatype =="serial")){
                    $("#text_joininputtypes"+countt+"").prop("type", "number");
                  }
                  else{
                    $("#text_joininputtypes"+countt+"").prop("type", "text");
                  }
                }
              });

           //joinfromupdatetablelist click function
            $("#joinfromupdatetablelist"+countt+"").click(function(){
              var tableid = $("#joinfromupdatetablelist"+countt+" :selected").val();
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
            
              $.ajax({
                url :"/column_list/",
                type : 'POST',
                async: false,
                data:{'projectid':projectid,'tableid':tableid},
                dataType : 'json',
                success : function(data){
                  $('#joinfromupdatecolumns'+countt+'').empty();
                  $('#joinfromupdatecolumns'+countt+'').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                  $('#joinfromupdatecolumns'+countt+'').append('<option value="id">id</option>');
                  $('#joinfromupdatecolumns'+countt+'').append('<option value="status">status</option>');
                  $('#joinfromupdatecolumns'+countt+'').append('<option value="createdon">createdon</option>');
                  $('#joinfromupdatecolumns'+countt+'').append('<option value="createdby">createdby</option>');
                  $('#joinfromupdatecolumns'+countt+'').append('<option value="modifiedon">modifiedon</option>');
                  $('#joinfromupdatecolumns'+countt+'').append('<option value="modifiedby">modifiedby</option>');  
                  
                  $.each(data.get_columnname, function(idx2,kvalue) { 
                    $('#joinfromupdatecolumns'+countt+'').append('<option value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
                  });   
                }
              });
            });
  
           // joincolumn_updatego button
            $("#joincolumn_updatego"+countt+"").click(function(){
              var fromtablevalues1 =$("#fromjoin_updateexecute"+countt+"").val();
              $('#fromjoin_updateexecute'+countt+'').val("")
              var jointypes = $("#joinupdatetypes"+countt+"").val();
              var jointablename = $("#joinupdatetables"+countt+" :selected").text();
              var joincolumns =$("#joinupdatecolumns"+countt+" :selected").text();
              var joinfromtable =$("#joinfromupdatetablelist"+countt+" :selected").text();
              var joinfromcolumns =$("#joinfromupdatecolumns"+countt+" :selected").text();
              var joincondition =$("#joinupdatecondition"+countt+" :selected").val();
              var join_condition_col =$("#join_condition_col"+countt+" :selected").text();
              var join_check_condition =$("#join_updatecheck_condition"+countt+" :selected").val();
              var colum_valus1 = $("#joincolumnupdatevalues"+countt+" :selected").map((_, e) => e.value).get();
              var colum_valus= JSON.stringify(colum_valus1);
              var Joinupdatecolumnname = $("#Joinupdatecolumnname"+countt+" :selected").map((_, e) => e.value).get();
              var column_datatype = $("#joinupdatecolumns"+countt+" :selected").data("datatype");
              var colum_valus_text =$("#text_joininputtypes"+countt+"").val();
              var from_joininput_text=$("#from_joininput_text"+countt+"").val();
              var aliasesname=$("#update_tablename :selected").data("aliases");
              colum_valus_len=(colum_valus1.length)
              var err_msg = $('#join_condition_error'+countt+'').remove();
              var fromtablevalues =$("#fromjoin_updateexecute"+countt+"").val();
              var get_aliasesname=$(" #joinupdatetables"+countt+" :selected").data("aliases");
              var wheretablename =  $("#selectupdate :selected").text();
              var joinfromcoltype =$("#joinfromupdatecolumns :selected").data("datatype");
              var val_arr = $("select#aggregatefunctionsupdate option").map(function() {return $(this).val();}).get()
              for(var i = 0; i < val_arr.length; i++){    
                  if(val_arr[i].search('a'+val_count+'.') > -1){
                  $('#aggregatefunctionsupdate').find('[value="'+val_arr[i]+'"]').remove();
                  $('#aggregatefunctionsupdate').selectpicker("refresh");
                }
              }
              $('#join_tablename'+countt+'').remove();
              $('#join_columnnames'+countt+'').remove();
              $('#join_check_conditionerror'+countt+'').remove();
              $('#joinfromtable_errormsg'+countt+'').remove();
              $('#joinfromcolumns_error'+countt+'').remove();
              $('#join_condition_error'+countt+'').remove();  
              $('#join_tablenameerr'+countt+'').remove();
              $('#jointypes_error'+countt+'').remove();     
              $('#Joinupdatecolumnname_error'+countt+'').remove();   
              var ermsg = 0;
              var jointypes_errormsg ="{{ get_chache_jointypeserror }}"
              if(jointypes =="{{ get_chache_selectjoineerror }}" || jointypes == null){
              jointypes_error = jointypes_errormsg    
              $('#joinupdatetypes'+countt+'').after("<span id='jointypes_error"+countt+"' class='error_msg'>"+jointypes_error+"</span>");
              ermsg = 1;
              }
              var join_tablenameerrormsg ="{{ get_chache_jointablenameerrormsg }}"
              if(jointablename =="{{ get_chache_selectjointableerror }}"){
                join_tablename = join_tablenameerrormsg
                $('#joinupdatetables'+countt+'').after("<span id='join_tablename"+countt+"' class='error_msg'>"+join_tablename+"</span>");
                ermsg = 1;
              }
              var Joinupdatecolumnname_errormsg = "select joincolumnname"
              if(Joinupdatecolumnname.length == 0){
              Joinupdatecolumnname_errormsgtypes_error = Joinupdatecolumnname_errormsg
              $('#Joinupdatecolumnname'+countt+'').after("<span id='Joinupdatecolumnname_error"+countt+"' class='error_msg'>"+Joinupdatecolumnname_errormsgtypes_error+"</span>");
              ermsg = 1;
              }
              var joincloumserrormsg ="{{ get_chache_joincolumnserrormsg }}"
              if(joincolumns =="{{ get_chache_selectcolumnerror }}"){
                join_columnnames= joincloumserrormsg
                $('#joinupdatecolumns'+countt+'').after("<span id='join_columnnames"+countt+"' class='error_msg'>"+join_columnnames+"</span>");
                ermsg = 1;
              }
              var joincheckconderrormsg ="{{ getcachejoincheckconditionerrormsg }}"
              if((join_check_condition =="{{ get_chache_selectconditionerror }}")||(join_check_condition =="sélectionner l'état" || join_check_condition == '')){
                join_check_condition_errormsg= joincheckconderrormsg
                $('#join_updatecheck_condition'+countt+'').after("<span id='join_check_conditionerror"+countt+"' class='error_msg'>"+join_check_condition_errormsg+"</span>");
                ermsg = 1;
              }
              var joinfromcolumns_errormsg ="{{ get_chache_joinfromcolumnserrormsg }}"
              if(joinfromcolumns =="{{ get_chache_selectcolumnerror }}"){
                joinfromcolumns_error= joinfromcolumns_errormsg
                $('#joinfromupdatecolumns'+countt+'').after("<span id='joinfromcolumns_error"+countt+"' class='error_msg'>"+joinfromcolumns_error+"</span>");
                ermsg = 1;
              }
              var join_condition_errormsg ="{{ get_chache_joinconditionerrormsg }}"
              if(((joincondition =="ON") || (joincondition =='AND') || (joincondition =='OR'))&&(colum_valus_len > 1)&&((join_check_condition =='=')||(join_check_condition =='<>')||(join_check_condition =='!=')||(join_check_condition =='>')||(join_check_condition =='>=')||(join_check_condition =='<=')||(join_check_condition =='<'))){
                join_condition_error = join_condition_errormsg
                $('#joincolumnvalues').after("<span id='join_condition_error"+countt+"' class='error_msg'>"+join_condition_error+"</span>");
                ermsg = 1;
              }
              var joinfromtable_errormsg ="{{ get_chache_joinfromtableerrormsg }}"
              if(joinfromtable =="{{ get_chache_selecttableerrormsg }}" && colum_valus_len == 0){
                joinfromtable_error= joinfromtable_errormsg
                $('#joinfromupdatetablelist'+countt+'').after("<span id='joinfromtable_errormsg"+countt+"' class='error_msg'>"+joinfromtable_error+"</span>");
                ermsg = 1;
              }  
              if(ermsg){
                return false
              }else{
                  $("#joinupdateand"+countt+"").show();
                  $("#joinupdateor"+countt+"").show();
                  $('#joinupdateand'+countt+'').removeAttr('disabled');
                  $('#joinupdateor'+countt+'').removeAttr('disabled');
                  $('#joinupdateon'+countt+'').prop('disabled', 'disabled');
                  var get_aliasesname=$(" #joinupdatetables"+countt+"  :selected").data("aliases");
                    // $('#outputupdate11').html(function(i, val) { return val*1+1 });
                    get_randomnum = $("#outputupdate1"+countt+"").html();
                    aliasesname_col = get_aliasesname 
                    var alisejoin =$('#joincolumnsalisedata').html(aliasesname_col)
                    $.ajax({
                      type:'POST',
                      url:"/join_columnquery/",
                      data:{'jointablename':jointablename,'joincolumns':joincolumns,'joinfromtable':joinfromtable,'joinfromcolumns':joinfromcolumns,'joincondition':joincondition,'join_condition_col':join_condition_col,'join_check_condition':join_check_condition,'colum_valus':colum_valus,'column_datatype':column_datatype,'colum_valus_text':colum_valus_text,'fromtablevalues':fromtablevalues,'aliasesname':aliasesname,'aliasesname_col':aliasesname_col},
                      success : function(data) {
                        $('#jointypes_error'+countt+'').remove();
                        $('#join_tablenameerr'+countt+'').remove();
                        $('#jointabl_column_val_errormsg'+countt+'').remove();
                        $('#join_check_condition_error'+countt+'').remove()
                        var fromtablevaluesend=data.query;
                        fromtablevaluesend_str = fromtablevaluesend.toString()
                        var fromtablevaluesend_strcheckand = fromtablevaluesend_str.search("AND")
                        var fromtablevaluesend_strcheckor = fromtablevaluesend_str.search("OR")
                        if(fromtablevaluesend_strcheckand != -1){
                          var fromtablevalues1val = fromtablevalues1+" "+fromtablevaluesend
                          $('#fromjoin_updateexecute'+countt+'').val(fromtablevalues1val)
                        }
                        if(fromtablevaluesend_strcheckor != -1){
                          var fromtablevalues1val = fromtablevalues1+" "+fromtablevaluesend
                          $('#fromjoin_updateexecute'+countt+'').val(fromtablevalues1val)
                        }
                        if(fromtablevaluesend_strcheckand == -1 && fromtablevaluesend_strcheckor == -1){
                          $('#fromjoin_updateexecute'+countt+'').val(fromtablevaluesend_str)
                        }
                        var fromtablevaluesafter =$("#fromjoin_updateexecute"+countt+"").val();
                        if(fromtablevaluesafter.length){
                          $("#joinupdateand"+countt+"").show();
                          $("#joinupdateor"+countt+"").show();
                          $('#joinupdateon'+countt+'').prop('disabled', 'disabled');
                        }
                      }
                    });
                      }
            


              if($("#joinupdatedynamic"+countt+"").is(":checked")){
                if((joincondition =='ON')&&(joincolumns !="{{ get_chache_selectcolumnerror }}")&&(join_check_condition !="{{ get_chache_selectconditionerror }}")&&(joinfromtable !="{{ get_chache_selecttableerrormsg }}")&&(joinfromcolumns !="{{ get_chache_selectcolumnerror }}") &&(jointablename !="{{ get_chache_selectjointableerror }}")){
                  var get_aliasesname=$(" #joinupdatetables"+countt+" :selected").data("aliases");
                  aliasesname_col= get_aliasesname
                  var alisejoin =$('#joincolumnsalisedata').html(aliasesname_col)//need to know
                }
              }
              else{
                $('#joinfromupdatetablelist'+countt+' option[value =""]').prop('selected', true);
                $('#joinfromupdatecolumns'+countt+'  option[value=""]').prop('selected', true);
                if((joincondition =='ON')&&(joincolumns !="{{ get_chache_selectcolumnerror }}")&&(join_check_condition !="{{ get_chache_selectconditionerror }}")){
                  var get_aliasesname=$(" #joinupdatetables"+countt+"  :selected").data("aliases");
                  // $('#outputupdate11').html(function(i, val) { return val*1+1 });
                  get_randomnum =$("#outputupdate1"+countt+"").html();
                  aliasesname_col=get_aliasesname 
                  var alisejoin =$('#joincolumnsalisedata').html(aliasesname_col)
                }
              }
            //$("#joinupdatecondition").val([]);
            //$("#joinfromupdatetablelist").val([]);
            //$("#joinfromupdatecolumns").val([]);
            $("#join_condition_col"+countt+"").val([]);
            $('#fromjoin_updateexecute'+countt+'').val("")
            $("#joincolumnupdatevalues"+countt+"").selectpicker('refresh'); 
            //$("#text_joininputtypes").val([]);
            //$("#joinupdatecolumns").val([]);
            //$("#join_updatecheck_condition").val([]);
            //$('#joincolumnupdatevalues').selectpicker('refresh'); 
            //$("#joincolumnupdatevalues").empty(); 
            //$("#Joinupdatecolumnname").val([]);
            var aliasesname_colval = aliasesname_col
            var tableid = $("#joinupdatetables"+countt+" :selected").val();
            var urllist = window.location.pathname;
            var url=urllist.split('/');
            var projectid=url[2];

            $.ajax({
              url :"/column_list/",
              type : 'POST',
              async: false,
              data:{'projectid':projectid,'tableid':tableid},
              dataType : 'json',
              success : function(data){
                $.each(data.get_columnname, function(idx2,kvalue){   
                  $('#aggregatefunctionsupdate').append('<option value="'+aliasesname_colval+'.'+kvalue.columnname+'">'+aliasesname_colval+'.'+kvalue.columnname+'</option>');
                }); 
              }
            }); 
            $('#aggregatefunctionsupdate').selectpicker('refresh')
          });  

          $('#joinupdatecolumns'+countt+'').click(function(){
              var tableid = $("#joinupdatetables"+countt+" :selected").text();
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var column_id = $("#joinupdatecolumns"+countt+" :selected").text();
              
              $.ajax({
                type:'POST',
                url:"/join_columnvalues/",
                async:false,
                data:{'projectid':projectid,'tableid':tableid,'column_id':column_id},
                datatype:'json',
                success : function(data) {
                  if(column_id =='status'){
                    $('#joincolumnupdatevalues'+countt+'').empty();
                    $('#joincolumnupdatevalues'+countt+'').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                    $.each(data.status_values, function(idx21,value) { 
                      $('#joincolumnupdatevalues'+countt+'').append('<option value="'+value+'">'+value+'</option>');
                    });
                  
                  }else{
                    $('#joincolumnupdatevalues'+countt+'').empty();
                    $('#joincolumnupdatevalues'+countt+'').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                    $.each(data.column_values, function(idx2,kvalue) { 
                      $.each(kvalue, function(idx21,kvalue1){ 
                        $('#joincolumnupdatevalues'+countt+'').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
                      });
                    });
                  }
                }
              });
              $('#joincolumnupdatevalues'+countt+'').selectpicker('refresh')
            }); 

          //join_updatego final button in joins
          $("#join_updatego"+countt+"").click(function(){
              var selectqueryvaluid =  $('#selectqueryupdate').html()
              var value = "*";
              var asteric_check = selectqueryvaluid.includes(value) ? "Yes" : "No";
              var jointypes = $("#joinupdatetypes"+countt+"").val();
              var jointablename = $("#joinupdatetables"+countt+"  :selected").text();
              var joinfromsection = $('#fromjoin_updateexecute'+countt+'').val();
              var fromtablevalues =$("#fromjoin_updateexecute"+countt+"").val();//heretertrtert
              var joinquery = $('#joinquery'+countt+'').val();
              
              $('#jointypes_error'+countt+'').remove();
              $('#joinfromsection_error'+countt+'').remove();
              var ermsg = 0;
              var jointypes_errormsg ="{{ get_chache_jointypeserror }}"
              if(jointypes =="{{ get_chache_selectjoineerror }}" || jointypes == null){
                jointypes_error = jointypes_errormsg
                $('#jointypes_error'+countt+'').remove()
                $('#joinupdatetypes'+countt+'').after("<span id='jointypes_error"+countt+"' class='error_msg'>"+jointypes_error+"</span>");            
                ermsg = 1;
              }
              var joinfromsection_errormsg = "{{ get_chache_joinfromsectionerror }}"
              if(joinfromsection == ''){
                joinfromsection_error = joinfromsection_errormsg
                $('#joinfromsection_error'+countt+'').remove();
                $('#fromjoin_updateexecute'+countt+'').after("<span id='joinfromsection_error"+countt+"' class='error_msg'>"+joinfromsection_error+"</span>");   
                ermsg = 1;
              }
              if(ermsg){
                  return false
                }
              if((joinfromsection)&&(jointypes !="{{ get_chache_selectjoineerror }}")){
                var str = joinfromsection
                var split1 = str.replaceAll(" ON ","")
                var value = $('#joinupdatecolumns'+countt+' :selected').text()
                var val_str = value.toString()
                var split2 = split1.replace("."+val_str+"","")
                var checkcon = $('#join_updatecheck_condition'+countt+' :selected').val()
                var aliasesname = split2.split(" "+checkcon+" ")
                aliasesname_val = 'a'+val_count+''
              }
              
              if((fromtablevalues.length ==0)|| jointypes){
                $("#joinupdateon"+countt+"").prop('disabled', false);
                $("#joinupdateand"+countt+"").hide();
                $("#joinupdateor"+countt+"").hide();
              }else{
                $('#joinupdateon'+countt+'').prop('disabled', 'disabled')
              }
              $.ajax({
                type:'POST',
                url:"/join_query/",
                async:false,
                data:{'jointypes':jointypes,'jointablename':jointablename,'joinfromsection':joinfromsection,'aliasesname_val':aliasesname_val},
                datatype:'json',
                success : function(data){
                  $("#joinqueryupdate"+countt+"").html(data.query);
                }
              });
              var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
              string = JSON.stringify(value);
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =  $("#update_tablename").val();
              var jointableselect_column_val =  $("#Joinupdatecolumnname"+countt+" :selected").map((_, e) => e.text).get();
              var joinselectcolumn_name= JSON.stringify(jointableselect_column_val);
              var aliasesname=$("#update_tablename :selected").data("aliases");
              var joincolmun_aliasesname = aliasesname_val
              
            
              $.ajax({
                url :"/ajax_option/",
                type : 'POST',
                async: false,
                data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname,'joinselectcolumn_name':joinselectcolumn_name,'joincolmun_aliasesname':joincolmun_aliasesname},
                dataType : 'json',
                success : function(data){
                  $("#selectqueryupdate").html(data.query1); 
                  $("#selectquery1update"+countt+"").html(data.query2);
                  $("#selectquery2update").html(data.query3);         
                }
              });
              var groupbycondition_val = $("#groupbyconditionupdate").val();
              var groupby_columnlist_string =$("#aggregatefunctionsupdate").val();
              var groupby_columnlist_val = JSON.stringify(groupby_columnlist_string);
              var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
              var groupby_updatecolumnlist = $("#groupby_updatecolumnlist :selected").map((_, e) => e.text).get();

              string = JSON.stringify(value);
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =  $("#update_tablename").val();
              var aliasesname=$("#update_tablename :selected").data("aliases");
              var columnname =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
              var jointableselect_column_val =  $("#Joinupdatecolumnname :selected").map((_, e) => e.text).get();
              var joinselectcolumn_name= JSON.stringify(jointableselect_column_val);
              if(groupbycondition_val != '' && groupby_columnlist_string.length != 0){
                var stringvalarray = []
                $.ajax({
                type : 'POST',
                url :"/groupbycondition_query/",
                async: false,
                data:{'groupbycondition_val':groupbycondition_val,'groupby_columnlist_val':groupby_columnlist_val,'string':string,'projectid':projectid,'tableid':tableid,'aliasesname':aliasesname,'joinselectcolumn_name':joinselectcolumn_name},
                dataType : 'json',
                success : function(data){
                  if(data.status =='success'){
                    //pass
                  }
                  else{
                    $("#groupbydataupdate").html(data.query);
                  }
                }
              });   
            }
            if(asteric_check != "No"){
              $('#groupby_updatehideshow').hide();
              $('#selectqueryupdate').html(selectqueryvaluid)
              $("#selectquery1update"+countt+"").html("")
              $('#selectquery2update').html("")
            } 
            var q = $('#querysetupdate').text();
            var ans = $.trim(q.replace(/\s/g, ' '))
            var finalquery = ans.replace(/ +/g, " ")
            $('#querycontent_data').val(finalquery);

            var querydata = $("#querycontent_data").val()
            const result3 = {};
                    // create an array from the input
                    const count3 = querydata.split(' ');
                    for(let word of count3) {
                        // if the word is already in the result object, increment the count
                        if(result3[word]) {
                            
                          result3[word]++;
                        } else {
                          // otherwise, add the word to the result object with a count of 1
                          result3[word] = 1;
                        }
                            }
            var join_count3 = result3["JOIN"]
            var val= 10
            for(var i = 0; i < val; i++){
              if(i == 0){
                $("#selectpicker1").trigger("change"); 
                $("#Joinupdatecolumnname").trigger("change");
                }else{              
                  $("#Joinupdatecolumnname"+i+"").trigger("change");                             
                }
            }
            });
           
            $('#samplecheckbox'+countt+'').click(function(){
              var selectqueryvaluid =  $('#selectqueryupdate').html()
              var value = "*";
              var asteric_check = selectqueryvaluid.includes(value) ? "Yes" : "No";
              $('#joinupdatetables'+countt+'').empty();
              $('#selectquery1update'+countt+'').text("")
              $('#selectquery1update'+countt+'').text("")
              $('#joincolumnupdatevalues'+countt+'').empty()
              $('#joincolumnupdatevalues'+countt+'').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
              $('#joincolumnupdatevalues'+countt+'').selectpicker('refresh');  
              $('#joinupdatetypes'+countt+' option[value =""]').prop('selected', true);
              $('#join_updatecheck_condition'+countt+' option[value =""]').prop('selected', true);
              $("#joinupdateon"+countt+"").show();
              $('#joinupdateand'+countt+'').prop('disabled', 'disabled');
              $('#joinupdateor'+countt+'').prop('disabled', 'disabled');
              $('#joinfromupdatecolumns'+countt+'').empty();
              $('#joinfromupdatecolumns'+countt+'').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>');  
              $('#joinupdateon'+countt+'').removeAttr('disabled');
              $('#joinupdatecondition'+countt+' option[value="ON"]').prop('selected', true); 
              var val_arr = $("select#aggregatefunctionsupdate option").map(function() {return $(this).val();}).get()
              $('#joinupdatecondition'+countt+' option[value="select condition"]').prop('selected', true);
              $('#Joinupdatecolumnname'+countt+'').empty();
              $('#Joinupdatecolumnname'+countt+'').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
              $('#Joinupdatecolumnname'+countt+'').selectpicker('refresh');
              $('#selectquery1update'+countt+'').text("")
              for(var i = 0; i < val_arr.length; i++){    
                  if(val_arr[i].search('a'+val_count+'.') > -1){
                  $('#aggregatefunctionsupdate').find('[value="'+val_arr[i]+'"]').remove()
                  $('#aggregatefunctionsupdate').selectpicker("refresh");
                }
              }  
              var val_arr_groupby = $("select#groupby_updatecolumnlist option").map(function() {return $(this).val();}).get()
              $('#selectquery1update'+countt+'').text("")
              for(var i = 0; i < val_arr_groupby.length; i++){    
                  if(val_arr_groupby[i].search('a'+val_count+'.') > -1){
                  $('#groupby_updatecolumnlist').find('[value="'+val_arr_groupby[i]+'"]').remove()
                  $('#groupby_updatecolumnlist').selectpicker("refresh");
                }
              }  
              var valuefrom = 2
              $('#joinqueryupdate'+countt+'').text("")              
              $('#joinupdatecolumns'+countt+'').empty()  
              $('#joinupdatecolumns'+countt+'').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>');    
              $('#fromjoin_updateexecute'+countt+'').val("")

    var select_updatecolumnsvalues = JSON.stringify($("#select_updatecolumnsvalues").val())
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    var tableid =$("#update_tablename :selected").val();

    var tablename = $('#update_tablename :selected').text()
    var columnname =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
    var aliasesname = $("#update_tablename :selected").data("aliases");
    var wheretablename =  $("#selectupdate :selected").text();
    var select_updatecolumnsvalues = JSON.stringify($("#select_updatecolumnsvalues").val());
    var stringvalarray = []


    var pagename =$('#pagename').val();
    var array = pagename.split(",");
    var pageid =(array[2]);  
   
    $.ajax({
          type : 'POST',
          url :"/ajax_tanlename/",
          async: false,
          data:{'projectid':projectid,'pageid':pageid},
          success : function(data) {
            $('#joinupdatetables'+countt+'').empty();
            $('#joinupdatetables'+countt+'').append('<option value="" selected disabled>{{ get_chache_selectjointableerror }}</option>');
            $.each(data.tablename, function(idx2,kvalue){ 
              $('#joinupdatetables'+countt+'').append('<option value="'+kvalue.id+'" data-aliases ="a'+val_count+'">'+kvalue.tablename+'</option>');
            });
          }
      });// Main table
     
    var projectid = $('#projectid').val();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    $.ajax({
          type : 'POST',
          url :"/ajaxwhere_tablelist/",
          async: false,
          data:{'projectid':projectid,'tableid':tableid},
          dataType : 'json',
          success : function(data) {
            $('#joinfromupdatetablelist'+countt+'').empty();
            $('#joinfromupdatetablelist'+countt+'').append('<option value="" selected disabled>{{ get_chache_selectjointableerror}}</option>');
            $.each(data.table_data, function(idx2,kvalue){ 
              $('#joinfromupdatetablelist'+countt+'').append('<option value="'+kvalue.id+'" data-aliases ="a2">'+kvalue.tablename+'</option>');
            });
          }
        });      
    var tableid = $("#joinfromupdatetablelist"+countt+" :selected").val();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    
    $.ajax({
        url :"/column_list/",
        type : 'POST',
        async: false,
        data:{'projectid':projectid,'tableid':tableid},
        dataType : 'json',
        success : function(data){
          $('#joinfromupdatecolumns'+countt+'').empty();
          $('#joinfromupdatecolumns'+countt+'').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
          $('#joinfromupdatecolumns'+countt+'').append('<option value="id">id</option>');
          $('#joinfromupdatecolumns'+countt+'').append('<option value="status">status</option>');
          $('#joinfromupdatecolumns'+countt+'').append('<option value="createdon">createdon</option>');
          $('#joinfromupdatecolumns'+countt+'').append('<option value="createdby">createdby</option>');
          $('#joinfromupdatecolumns'+countt+'').append('<option value="modifiedon">modifiedon</option>');
          $('#joinfromupdatecolumns'+countt+'').append('<option value="modifiedby">modifiedby</option>');  
          
          $.each(data.get_columnname, function(idx2,kvalue){ 
            $('#joinfromupdatecolumns'+countt+'').append('<option value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
            });
          $('#joinfromupdatecolumns'+countt+' option[value =""]').prop('selected', true);  
          $('#joinfromupdatecolumns'+countt+'').empty();   
          }    
        }); 
        $('#joinfromupdatetablelist'+countt+' option[value =""]').prop('selected', true);
        var q = $('#querysetupdate').text();
        var ans = $.trim(q.replace(/\s/g, ' '))
        var finalquery = ans.replace(/ +/g, " ")
        $('#querycontent_data').val(finalquery);   
        const result1 = {};
        const count1 = finalquery.split(' ');
        for(let word of count1) {
            if(result1[word]) {           
              result1[word]++;
            } else {
              result1[word] = 1;
            }
                }  
        var join_count1 = result1['JOIN']    
        if(asteric_check != "No"){
            $('#groupby_updatehideshow').hide();
            $('#selectpicker1 option').prop('selected', true);
            $( "#selectpicker1 option:first-child" ).prop('selected', false);
            $('#selectpicker1').selectpicker('refresh')
            $('#selectqueryupdate').html(selectqueryvaluid)
            var r = $('#querysetupdate').text();
            var ans1 = $.trim(r.replace(/\s/g, ' '))
            var finalquery1 = ans1.replace(/ +/g, " ")
            $('#querycontent_data').val(finalquery1);  
          }
      })
    }

    //joinupdatetables1 click function
    $("#joinupdatetables"+countt+"").click(function(){
    var tableid = $("#joinupdatetables"+countt+" :selected").val();
    var tablename = $("#joinupdatetables"+countt+" :selected").text();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
  
    $.ajax({
      url :"/column_list/",
      type : 'POST',
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data) {
        $('#joinupdatecolumns'+countt+'').empty();
        $('#joinupdatecolumns'+countt+'').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>');
        $('#joinupdatecolumns'+countt+'').append('<option data-datatype="serial" value="id">id</option>');
        $('#joinupdatecolumns'+countt+'').append('<option data-datatype="int4" value="status">status</option>')
        $('#joinupdatecolumns'+countt+'').append('<option value="createdon">createdon</option>');
        $('#joinupdatecolumns'+countt+'').append('<option value="createdby">createdby</option>');
        $('#joinupdatecolumns'+countt+'').append('<option value="modifiedon">modifiedon</option>');
        $('#joinupdatecolumns'+countt+'').append('<option value="modifiedby">modifiedby</option>');  
        $.each(data.get_columnname, function(idx2,kvalue){   
          $('#joinupdatecolumns'+countt+'').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
        }); 
        $('#Joinupdatecolumnname'+countt+'').empty();
        $('#Joinupdatecolumnname'+countt+'').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
        $('#Joinupdatecolumnname'+countt+'').append('<option value="id">id</option>');
        $('#Joinupdatecolumnname'+countt+'').append('<option value="status">status</option>');       
        $('#Joinupdatecolumnname'+countt+'').append('<option value="createdon">createdon</option>');
        $('#Joinupdatecolumnname'+countt+'').append('<option value="createdby">createdby</option>');
        $('#Joinupdatecolumnname'+countt+'').append('<option value="modifiedon">modifiedon</option>');
        $('#Joinupdatecolumnname'+countt+'').append('<option value="modifiedby">modifiedby</option>'); 
        $.each(data.get_columnname, function(idx2,kvalue){
          $('#Joinupdatecolumnname'+countt+'').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
        }); 
      }
    }); 
    $('#Joinupdatecolumnname'+countt+'').selectpicker('refresh')
  });
}
 var y = 0
 $(document).ready(function(){
  $("#jointoggledisplay").click(function(){
    var selectqueryvaluid =  $('#selectqueryupdate').html()
    var value = "*";
    var asteric_check = selectqueryvaluid.includes(value) ? "Yes" : "No";
    $("#jointypesfunctions").show()
    var checkbox_html = $("[class=card-btm]").find('#dynamicjoin').parent().html()
    if(checkbox_html == undefined){
      $('.card-btm').parent().parentsUntil('section').find('.card-btm').append("<span id='dynamicjoin' style='list-style: none;display: inline-flex;'><h6 class='panel-title'>JOIN 1</h6><label class='switch'><input type='checkbox' id ='samplecheckbox'  checked><span class='slider round'></span></label></span>") 
      var i = 0 
      $("#samplecheckbox").prop('checked', false)
      joinfunction_toggle() 
    }else{
    var checkbox_html = checkbox_html.replace(/^\s+/g, '');
    var result1 = {};
    var count1 = checkbox_html.split(' ');
    for(let word of count1){
        if(result1[word]) {           
          result1[word]++;
        } else {
          result1[word] = 1;
        }
          }
    var i = result1['type="checkbox"']
    var minus_i = i - 1
    var ii = i + 1
    if(minus_i == 0){
      var minus_i = ""
    }
    $('#selectquery1update'+minus_i+'').after('<span id="selectquery1update'+i+'"></span>');
     $('.carousel-inner').append('<div class="carousel-item" id="carousel-item-main2"><div class="row form-btm-space"><div class="col-md-3"><label>{{ get_chache_jointypes }}</label><select name="element1" id="joinupdatetypes'+i+'" class="form-control" type="text"><option value="" selected disabled>{{ get_chache_selectjoins }}</option><option value="INNER JOIN">{{ get_chache_innerjoin }}</option><option value="LEFT JOIN">{{ get_chache_leftjoin }}</option><option value="RIGHT JOIN">{{ get_chache_rightjoin }}</option></select></div><div class="col-md-3"><label>{{ get_chache_jointable }}</label><select name="element1" id="joinupdatetables'+i+'" class="form-control" type="text"><option value="" selected disabled>{{ get_chache_selectjointableerror }}</option></select></div><div class="col-md-3" id="selectcolumn_alisename'+i+'"><label>Joincolumnname</label><select class="selectpicker" id="Joinupdatecolumnname'+i+'" name="columnid[]" multiple data-live-search="true" tabindex="-98"><option value="" disabled>{{ get_chache_selectcolumnerror }}</option></select></div><div id="column_alisename" style="display:none;"></div><div class="col-md-3"><label>{{ get_chache_joincondition }}</label><select name="element1" id="joinupdatecondition'+i+'" class="form-control" type="text"><option value="{{ get_chache_selectcondition }}" disabled selected>{{ get_chache_selectcondition }}</option><option value="ON" id ="joinupdateon'+i+'">{{ get_chache_on }}</option><option value="AND" id="joinupdateand'+i+'" style="display:none">{{ get_chache_and }}</option><option values="OR" id="joinupdateor'+i+'" style="display:none">{{ get_chache_or }}</option></select></div><div class="col-md-3"><label>{{ get_chache_joincols }}</label><select name="joinupdatecolumns'+i+'" id="joinupdatecolumns'+i+'" class="form-control" type="text"><option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option></select></div></div><div class="row form-btm form-btm-space" style="margin-top: -12px;"><div class="col-md-3"><label>{{ get_chache_conditionaloper }}</label><select name="element1" id="join_updatecheck_condition'+i+'" class="form-control" type="text"><option value="" selected disabled>{{ get_chache_selectcondition }}</option><option value="=">=</option><option value="IN">IN</option><option value="NOT IN">NOT IN</option><option value="<>"><></option><option value="!=">!=</option><option value=">">></option><option value=">=">>=</option><option value="<"><</option><option value="<="><=</option><option value="NOT">NOT</option><option value="BETWEEN">BETWEEN</option><option value="IS NULL">IS NULL</option><option value="IS NOT NULL">IS NOT NULL</option><option value="LIKE">LIKE</option><option value="EXISTS">EXISTS</option></select></div><div class="col-md-3" id ="from_table_show_updatedata'+i+'" style="display: none;"><label>{{ get_chache_joinfromtbl }}</label><select name="element11" id="joinfromupdatetablelist'+i+'" class="form-control" type="text"><option value="" selected disabled>{{ get_chache_selectjointableerror}}</option></select></div><div class="col-md-3" id ="from_column_show_updatedata'+i+'" style="display: none;"><label>{{ get_chache_joinfromcol }}</label><select name="element1" id="joinfromupdatecolumns'+i+'" class="form-control" type="text"></select></div><div class="col-md-3" id="from_updatejoincheck'+i+'" style="display: none;" ><input type="checkbox" id="joinupdatecheck'+i+'" name="joinupdatecheck" value="1"><label style="margin-top: 30px;">isparent textinput</label></div><div class="col-md-3" id ="joincolumnvalues_updatedata'+i+'" style="display: none;"><label>{{ get_chache_joincolvalues }}:</label><select class="selectpicker" id="joincolumnupdatevalues'+i+'" name="joincolumnupdatevalues'+i+'" multiple data-live-search="true"   required><option value="" disabled >{{ get_chache_selectcolumnerror }}</option></select></div><div class="col-md-3" id="joinupdatedynamic_checkbox'+i+'"><span><input type="checkbox" id="joinupdatedynamic'+i+'" name="joinupdatedynamic'+i+'" value="1"><label style="margin-top: 30px;">{{ get_chache_isparenttable }}</label><button class="btn join-btn" style="background-color:#99B0CE;" id="joincolumn_updatego'+i+'">Go</button></span><div id="outputupdate1'+i+'" style="display: none;"></div></div></div><div class="row join_complited_go'+i+'" style="margin-top: -10px;"><div class="col-md-3"><label for="exampleFormControlTextarea1" class="form-label">{{ get_chache_fromjointext }} </label><textarea name="element7" class="form-control input-lg" id="fromjoin_updateexecute'+i+'" rows="3"></textarea></div><div class="col-md-3" style="margin-top:70px;"><button class="btn join-btn" style="background-color:#99B0CE;" id="join_updatego'+i+'">{{ get_chache_go }}</button><div id="outputupdate'+i+'" style="display:none;"></div></div></div></div>')  
           
    var joinquery_set_check = $('#querysetupdate').find("#joincolumnquery1").html()
    if(joinquery_set_check == undefined){
      $('#querysetupdate').find("#joincolumnquery").after('<span id="joinqueryupdate'+i+'"></span><span id="joincolumnquery'+i+'"></span>');
    }else{
      var ii = i - 1
      $('#querysetupdate').find("#joincolumnquery"+ii+"").after('<span id="joinqueryupdate'+i+'"></span><span id="joincolumnquery'+i+'"></span>');
    }    
    $('#Joinupdatecolumnname'+i).selectpicker("refresh") 
    $("#jointypesfunctions").css("display", "block");
    var join_id_add = i + 1
    $('.card-btm').parent().parentsUntil('section').find('.card-btm').append("<span id='dynamicjoin' style='list-style: none;display: inline-flex;'><h6 class='panel-title'>JOIN "+join_id_add+"</h6><label class='switch'><input type='checkbox' id ='samplecheckbox"+i+"'  checked><span class='slider round'></span></label></span>")       
    $("#samplecheckbox"+i+"").prop('checked', false)
    if(asteric_check != "No"){
        $('#groupby_updatehideshow').hide();
        $('#selectqueryupdate').html(selectqueryvaluid)
      }
    joinfunction_toggle1(i) 
    }
  });
});
$(document).ready(function(){
  $("#wheretoggledisplay").click(function(){
    var fromjoin_updateexecute = $('#fromjoin_updateexecute').val();
    var valueofwhere = $('#wherequeryupdate').text();
    var selectqueryvaluid =  $('#selectqueryupdate').html()
    var value = "*";
    var asteric_check = selectqueryvaluid.includes(value) ? "Yes" : "No";
    var querycontent_data_val = $('#querycontent_data').val()
    $('#wherequeryupdate').text("");
      if (fromjoin_updateexecute.length > 0){
        //pass
      }else{
        var jointablename = $("#joinupdatetables :selected").text();
        if(jointablename =="{{ get_chache_selectjointableerror }}" || jointablename == ''){
          $('#selectqueryupdatebutton').trigger( "click" );
        }else{
          $('#joincolumn_updatego').trigger( "click" );
          $("#join_updatego").trigger( "click" );
        } 
      }   
    
    $("#wheredisplay").toggle();
    $("#wheredisplay1").toggle();
    $("#where_optionupdate").removeAttr('disabled');
    $('#whereupdatecondition option[value="WHERE"]').prop('selected', true);
    $('#and_optionupdate').prop('disabled', 'disabled');
    $('#or_optionupdate').prop('disabled', 'disabled');
    $('#where_check_updatecondition option[value =""]').prop('selected', true); 
    $('#select_updatecolumns').empty();
    $('#select_updatecolumns').append('<option value="" disabled selected>select column</option>');
    $('#defaultvaluesupdate').prop('checked', true);
    $('#select_updatecolumnsvalues').empty();
    $('#select_updatecolumnsvalues').append('<option value="" disabled>select column</option>');
    $('#get_updatecolumvalues').show();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    var tableid =$("#update_tablename :selected").val();
    $.ajax({
        type : 'POST',
        url :"/ajaxwhere_tablelist/",
        async: false,
        data:{'projectid':projectid,'tableid':tableid},
        dataType : 'json',
        success : function(data){
          $('#selectupdate').empty();
          $('#selectupdate').append('<option value="" disabled>{{ get_chache_selecttableerrormsg }}</option>');
          $.each(data.table_data, function(idx2,kvalue){ 
            $('#selectupdate').append('<option value="'+kvalue.id+'">'+kvalue.tablename+'</option>');
          });
        }
      });
      $('#selectupdate option[value =""]').prop('selected', true);   
    if(asteric_check != "No"){
      $('#groupby_updatehideshow').hide();
      $('#selectqueryupdate').html(selectqueryvaluid)
    }
    var q = $('#querysetupdate').text();
    var ans1 = $.trim(q.replace(/\s/g, ' '))
    var ans = ans1.replace(/ +/g, " ")
    $('#querycontent_data').val(ans);   
  });
});  
$("#pagename").change(function(){
  var selectfulldata = $('#pagename').val();
  var match = selectfulldata.split(',')
  var pageid = (match[2]); 
  $.ajax({
    type: 'POST',
    url: '/get_pagequery/',
    data : {
      projectid: projectid,
      pageid: pageid
    },
    success: function(data){
      if(data.status == 'Success'){
        $('#inputquery').append('<option value="">--- Select query ---</option>');
        $.each(data.querydata, function(index, value){
          $("#inputquery").append('<option value="'+value.fullquery+'">' + value.queryshortname + '</option>');
        });
      }
    }
  })
});
</script>
<script>
  $('#formdata').click(function(e){  
    $('#buttonrow').slideUp();
    $("#queryselection").css("display","block");
    $("#querymessage").css("display","block"); 
    $(".querymessagebody").css("display","block"); 
    $("#querydisplaymsg").css("display","none"); 
    $('.application-data').css("display","none"); 
    var pagedetails = $("#pagename").val();
    var pagevalues =pagedetails.split(",");
    var projectid =(pagevalues[0]);
    var pageid =(pagevalues[2]);
    $.ajax({
      type : 'POST',
      url :'/query_table/',
      data : { projectid : projectid,pageid : pageid},
      success: function(data){
        error_msg = 0;
        if(data.status =='success'){
          $('#querydatalist').empty();
          $.each(data.query_tablelist, function(index, value){
            var queryid =(value.id);
            var querypage =value.pageid;
            var querystatus =value.status;
            var queryshortname =value.queryshortname;
            $('#querydatalist').append('<tr class="tablequerylistdata" id ="delectqueryrow'+queryid+'"><td id="querydataid" >'+queryid+'</td><td id="querydatapage">'+querypage+'</td><td id ="querydatastatus">'+querystatus+'</td><td id ="querydatashortname'+ queryid+'" >'+queryshortname+'</td><td class="dev-icons" style="padding-left:30px;"><i class="fa fa-edit me-2" id="editqueries" aria-hidden="true" onclick="editquery('+querypage+','+queryid+')"></i><i class="fa fa-trash ms-3" aria-hidden="true" onclick="deletequery('+querypage+','+queryid+')"></i></td></tr>');   
          });
          error_msg = 0;
        }else{
          $('#queryerror_msg').remove();
          $("#querymessage").append("<p id ='queryerror_msg' style ='color:red;font-family: 'Roboto', sans-serif;'">+data.message+"</p>");
          error_msg = 1; 
        }
        if(error_msg){
            return false
          }
        }
      }); 
  });
  

  $('#manageqdata').click(function(e){  
    $('#buttonrow').slideUp();
    $('[id=dev-icons]').add();
    $("#queryselection").css("display","block");
    $("#querymessage").css("display","none"); 
    $(".querymessagebody").css("display","none"); 
    $("#querydisplaymsg").css("display","block"); 
    $('.application-data').css("display","block");
    var pagedetails = $("#pagename").val();
    var pagevalues =pagedetails.split(",");
    var projectid =(pagevalues[0]);
    var pageid =(pagevalues[2]);
    
    $.ajax({
      type : 'POST',
      url :'/query_table/',
      data : { projectid : projectid,pageid : pageid},
      success: function(data){
        error_msg = 0;
        if(data.status =='success'){
          $('#querydatalist').empty();
          $.each(data.query_tablelist, function(index, value){
            var queryid =value.id;
            var querypage =value.pageid;
            var querypagename = value.pagename;
            var queryshortname =value.queryshortname;
            $('#querydatalist').append('<tr class="tablequerylistdata" id ="delectqueryrow'+queryid+'"><td id="querydatapage">'+querypagename+'</td><td id ="querydatashortname'+ queryid+'" >'+queryshortname+'</td><td class="dev-icons" style="padding-left:30px;"><i class="fa fa-edit me-2" aria-hidden="true" id="editqueries" onclick="editquery('+querypage+','+queryid+')"></i><i class="fa fa-trash ms-3" aria-hidden="true" onclick="deletequery('+querypage+','+queryid+')"></i></td></tr>');
          });
          error_msg = 0;
        }else{
          $('#queryerror_msg').remove();
          $("#querymessage").append("<p id ='queryerror_msg' style ='color:red;font-family: 'Roboto', sans-serif;'">+data.message+"</p>");
          error_msg = 1; 
        }
        if(error_msg){
            return false
          }
        }
      });
  });


  //-----------------------------query_tabledelete_flow_start----------------------
  function deletequery(querypage,queryid){
    var pageid =querypage;
    var queryid =queryid;
    var projectid = $('#projectid').val();
    $.ajax({
      type : 'POST',
      url :'/query_delete/',
      data : { projectid : projectid,pageid : pageid,'queryid':queryid},
      success: function(data){
        error_msg = 0;
        if(data.status =='success'){
          $('#querydelete_errormsg').remove();
          $("#querydisplaymsg").after("<p id='querydelete_errormsg' style='color:green;margin-top:20px;text-align:center;'>"+data.message+"</p>");
          error_msg = 0; 
          $('#delectqueryrow'+queryid).remove();
          
        }else{
          $('#querydelete_errormsg').remove();
          $("#querydisplaymsg").after("<p id='querydelete_errormsg' style='color:green;margin-top:20px;text-align:center;'>"+data.message+"</p>");
          error_msg = 1; 
        }
        if(error_msg){
            return false
          }
        setTimeout (function(){
            $('#querydelete_errormsg').remove();
          },2000)  
        }
      });  
    }
  
  //------------------------------query_tabledelete_flow_end------------------------

  //------------------------------HH----MANAGE_QUERY_STARTS------query_edit_flowstart--------------------------------
</script>
<script>
function editquery(querypage,queryid){
  $('#groupby_updatehideshow').show();
  var querypage =querypage
  var queryid1 =queryid
  var projectid = $('#projectid').val();
  var urllist = window.location.pathname;
  var url=urllist.split('/');
  var projectid=url[2];
  var pagename =$('#pagename').val();
  var array = pagename.split(",");
  var pageid =(array[2]);
  $('#queryidappend').html(queryid1);
  $('#editboxshow').show();
  $('#editqueryerror_msg').remove();
  var queryid =$('#queryidappend').html();
  $('#joinupdatetypes option[value=""]').prop('selected', true);
  $('#joinupdatetables').empty();
  $('#joinupdatetables').append('<option value="" selected disabled>{{ get_chache_selectjointableerror }}</option>');
  $.ajax({
    type : 'POST',
      url :'/queryedit_data/',
      data : { querypage : querypage,queryid :queryid,projectid:projectid},
      success: function(data){
        if(data.status =='success'){
          $("#querycontent_data").val(data.query_editdatalist);
          $("#querycontent_readonlydata").val(data.query_editdatalist);
          $('#queryshortname_values').val(data.query_shortname_val);

          var query_str = data.query_editdatalist
          $('#querysave').append(query_str);
          var strvalue = query_str;
          var searchTerm = "from ";
          var result = strvalue.split(searchTerm).at(1);
          var arraylist = result
          var splitt = arraylist.replace(' ',',').replace(' ',',')
          var tablename = splitt.split(",").at(0) 
          $.ajax({
            type : 'POST',
            url :"/ajax_tanlenamevalue/",
            data:{'projectid':projectid,'pageid':pageid,'tablename':tablename},
            success : function(data) {
              $.each(data.tablename, function(idx2,kvalue) { 
                $('#update_tablename option[value='+kvalue.id+']').prop('selected', true)
                $('#select_tablename option[value='+kvalue.id+']').prop('selected', true)
          });
          var tableid =$("#update_tablename :selected").val();
          const text = strvalue
          var joins1 = text.search(" LEFT JOIN ");
          var joins2 = text.search(" RIGHT JOIN ");
          var joins3 = text.search(" INNER JOIN ");
          var joincon = text.search(" ON ");
          var wherecon = text.search(" WHERE ")
          var groupby = text.search("GROUP BY")
          const result = {};
          const count = text.split(' ');
          for(let word of count) {
              if(result[word]) {
                  
                result[word]++;
              } else {
                result[word] = 1;
              }
                  } 
          var join_count = result['JOIN']
          function wherecondition(){
  var jointablename = $("#joinupdatetables :selected").text();
  if(jointablename =="{{ get_chache_selectjointableerror }}"){
    $("#jointypesfunctions").css("display", "none");
  }else{
    $("#jointypesfunctions").css("display", "block");
  }

$("#wheredisplay").css("display","block");  
$("#wheredisplay1").css("display","block");  
$("[id=wheredisplay],[id=wheredisplay1]").css("display","block");  
var textt = strvalue;
var asplit = textt.replaceAll("a.","").replaceAll("a_","")
var fromsplit = asplit.split("from");
var arr = fromsplit[0];
var selectsplit = arr.split("select").splice(1);
var selectstr = selectsplit.toString()
var asreplace = selectstr.replaceAll("as ","")
var query = asreplace.toString()
var comaquery = query.replaceAll(" ",",").substring(1)
value = Array.from(new Set(comaquery.split(','))).toString();
var tablecol1 = value.split(",");
tablecol1.splice(-1);
var splitmain = textt.split(" WHERE ")
var conditional_operator_check = splitmain[1]
var val = conditional_operator_check.split(".")
var split_cond = conditional_operator_check.split(" ")

    if(split_cond.length > 3){
        var conditional_operator_check1 = split_cond[1]
        var condition_value = JSON.stringify(conditional_operator_check1)
        $("#where_check_updatecondition option[value="+condition_value+"]").prop('selected', true)
        $('#checkcondition_error').remove();
        $('#defaultvaluesupdate').prop('checked', true);

                      
        var column_val = split_cond[2]
        var column_valstr = JSON.stringify(column_val)
        var column_name = split_cond[0]
        var col_splitname = split_cond[0].split(".")
        var col_nam = col_splitname[1]
        // $('#select_updatecolumns option[value='+column_table+']').prop('selected', true)
        var aliasesname=$("#update_tablename :selected").data("aliases");
        var tableid =$("#update_tablename :selected").val();
        var projectid = $('#projectid').val();
        var urllist = window.location.pathname;
        var url=urllist.split('/');
        var projectid=url[2];
        and_con = textt.search("AND")
        or_con = textt.search("OR")
              if( and_con != -1){
                $("#and_optionupdate").css("display","block"); 
                $('#whereupdatecondition option[value="AND"]').prop('selected', true);    
                $('#where_optionupdate').prop("disabled", "disabled")
                $("#or_optionupdate").css("display","block"); 
                $("#or_optionupdate").removeAttr("disabled"); 
                $("#and_optionupdate").removeAttr("disabled"); 
                var andcount = result['AND']
                // $("#wherequeryupdate").append(" "+data.query);
                var where_con = []
                for(i=0; i<andcount; i++){
                  var secondand = textt.indexOf("AND", and_con+1)
                  if(and_con != -1 && secondand != -1 && groupby == -1){
                    var firstadd = textt.slice(and_con, secondand-1)
                    where_con.push(firstadd)
                    var and_con = secondand
                  }
                  if(and_con != -1 && secondand == -1){
                    var second_val = textt.slice(and_con, textt.length)
                    var split_secondval = second_val.split("AND")
                    var andval = split_secondval[1].replaceAll("a.", "")
                    var split_andval = andval.split(" ")
                    var column_val1 = split_andval[split_andval.length - 1]
                    var column_valstr = JSON.stringify(column_val1)
                    var conditional_operator_check1 = split_andval[2]
                    var condition_value = JSON.stringify(conditional_operator_check1)
                    $("#where_check_updatecondition option[value="+condition_value+"]").prop('selected', true)
                    var col_nam = split_andval[1]
                    if(groupby == -1){
                      where_con.push(second_val)
                    }else{
                      var second_val = textt.slice(and_con, groupby)
                      where_con.push(second_val)
                    }        
                  }
                }
                if(where_con.length > 1){
                  where_con.pop();
                }   
                var andsplitmain = conditional_operator_check.split(" AND ")
                var where_value = andsplitmain[0]
                $("#wherequeryupdate").append("WHERE "+where_value);
                if(where_con.length > 0){
                    for(i=0; i<where_con.length; i++){
                    $("#wherequeryupdate").append(" "+where_con[i])
                    }
                  }  
                }
                if( or_con != -1){
                $("#or_optionupdate").css("display","block"); 
                $('#whereupdatecondition option[value="OR"]').prop('selected', true);
                $("#and_optionupdate").css("display","block"); 
                $("#or_optionupdate").removeAttr("disabled"); 
                $("#and_optionupdate").removeAttr("disabled"); 
                var orcount = result['OR']
                // $("#wherequeryupdate").append(" "+data.query);
                var where_con1 = []
    
                for(i=0; i<orcount; i++){
                  var secondor = textt.indexOf("OR", or_con+1)
                  if(or_con != -1 && secondor != -1 && groupby == -1){
                    var firstadd = textt.slice(or_con, secondor-1)
                    where_con1.push(firstadd)
                    var or_con = secondor
                  }
                  if(or_con != -1 && secondor == -1){
                    var second_val = textt.slice(or_con, textt.length)
                    if(groupby == -1){
                      where_con1.push(second_val)
                    }else{
                      var second_val = textt.slice(or_con, groupby)
                      where_con1.push(second_val)
                    }        
                  }
                }
                where_con1.pop();
                var orsplitmain = conditional_operator_check.split(" OR ")
                var where_value = orsplitmain[0]
                $("#wherequeryupdate").append("WHERE "+where_value);
                if(where_con1.length > 0){
                    for(i=0; i<where_con1.length; i++){
                    $("#wherequeryupdate").append(" "+where_con1[i])
                  }
                }     
              }
$.ajax({
    type : 'POST',
    url :"/ajaxwhere_tablelist/",
    async: false,
    data:{'projectid':projectid,'tableid':tableid},
    dataType : 'json',
    success : function(data) {
      $('#joinfromupdatetablelist').empty();
      $('#joinfromupdatetablelist').append('<option value="" selected disabled>{{ get_chache_selectjointableerror}}</option>')
      $.each(data.table_data, function(idx2,kvalue){ 
        $('#joinfromupdatetablelist').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');
      });
    }
  });
  $.ajax({
      type : 'POST',
      url :"/ajaxwhere_tablelist/",
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data) {
        $('#selectupdate').empty();
        $('#selectupdate').append('<option value="" disabled>{{ get_chache_selecttableerrormsg }}</option>');
        $.each(data.table_data, function(idx2,kvalue) { 
          $('#selectupdate').append('<option value="'+kvalue.id+'">'+kvalue.tablename+'</option>');
          $('#selectupdate option[value='+kvalue.id+']').prop('selected', true)
        });
        var tableid =  $("#selectupdate :selected").val();
        var column_name = JSON.stringify(col_nam)
        var urllist = window.location.pathname;
        var url=urllist.split('/');
        var projectid=url[2];
        var aliasesname=$("#update_tablename :selected").data("aliases");
      
        $.ajax({
          type:'POST',
          url:"/ajaxwhere_tablelist/",
          async:false,
          data:{'projectid':projectid,'tableid':tableid},
          datatype:'json',
          success : function(data){ 
            $('#select_updatecolumns').empty();
            $('#select_updatecolumns').append('<option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>');
            $('#select_updatecolumns').append('<option data-datatype ="serial" value="id">id</option>');
            $('#select_updatecolumns').append('<option data-datatype ="int4"value="status">status</option>');
            $('#select_updatecolumns').append('<option value="createdon">createdon</option>');
            $('#select_updatecolumns').append('<option value="createdby">createdby</option>');
            $('#select_updatecolumns').append('<option value="modifiedon">modifiedon</option>');
            $('#select_updatecolumns').append('<option value="modifiedby">modifiedby</option>'); 
            $.each(data.where_get_columnname, function(idx2,kvalue){ 
              $('#select_updatecolumns').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
            });
            $('#select_updatecolumns').find('option').not(':selected').each(function(k,v){
              if(col_nam==v.text){   
                finalvalue = JSON.stringify(v.value)  
                $('#select_updatecolumns option[value='+finalvalue+']').prop('selected', true)               
              }
            });
            var urllist = window.location.pathname;
            var url=urllist.split('/');
            var projectid=url[2];
            var tablename =  $("#selectupdate :selected").text();
            var column_name=  $("#select_updatecolumns :selected").text();
            var column_id=  $("#select_updatecolumns :selected").val();
            var tableid =  $("#selectupdate :selected").val();
            var column_values = column_valstr
            $.ajax({
                type:'POST',
                url:"/ajaxwhere_columndata/",
                async:false,
                data:{'projectid':projectid,'tableid':tableid,'column_id':column_id,'column_name':column_name,'tablename':tablename},
                datatype:'json',
                success : function(data) {
                  if(column_name =='status'){
                    $('#select_updatecolumnsvalues').empty();
                    $('#select_updatecolumnsvalues').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                    $.each(data.status_values, function(idx21,value){ 
                      $('#select_updatecolumnsvalues').append('<option value="'+value+'">'+value+'</option>');
                    });
                  }else{
                  $('#select_updatecolumnsvalues').empty();
                  $('#select_updatecolumnsvalues').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                    $.each(data.get_columnvalues, function(idx2,kvalue){ 
                      $.each(kvalue, function(idx21,kvalue1){ 
                        $('#select_updatecolumnsvalues').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
                      });
                    });
                  }
                  $('#select_updatecolumnsvalues option[value='+column_values+']').prop('selected', true);
                }
            });
          }
        });
        var update_column = $('#select_updatecolumns').val()
        if (update_column != '' || update_column != empty){
          $('#get_updatecolumvalues').show();
          $('#defaultvaluesupdate').prop('checked', true);
        }else{
          $('#get_updatecolumvalues').hide();
          $('#defaultvaluesupdate').prop('checked', false);
        } 
      } 
    });    
$.ajax({
url :"/column_list/",
type : 'POST',
async: false,
data:{'projectid':projectid,'tableid':tableid},
dataType : 'json',
success : function(data){
    $('#selectpicker1').empty();
    $('#selectpicker1').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
    $('#selectpicker1').append('<option value="id">id</option>');
    $('#selectpicker1').append('<option value="status">status</option>');
    $('#selectpicker1').append('<option value="createdon">createdon</option>');
    $('#selectpicker1').append('<option value="createdby">createdby</option>');
    $('#selectpicker1').append('<option value="modifiedon">modifiedon</option>');
    $('#selectpicker1').append('<option value="modifiedby">modifiedby</option>');
    $.each(data.get_columnname, function(idx2,kvalue) { 
      $('#selectpicker1').append('<option value="'+kvalue.id+'" name = "'+kvalue.id+'">'+kvalue.columnname+'</option>');
      $("#columnquery").html(data.columnquery);
    });
      for (var i = 0; i < tablecol1.length; i++){        
      $('#selectpicker1').find('option').not(':selected').each(function(k,v){
          if(tablecol1[i]==v.text){        
            $('#selectpicker1 option[value='+v.value+']').prop('selected', true);
            }
          });
        }
      }
    });
$('#selectpicker1').selectpicker('refresh')
$("[id=wheredisplay],[id=wheredisplay1]").css("display","block");  
}else{
$("#whereupdatecondition").css("display","block"); 
$('#whereupdatecondition option[value="WHERE"]').prop('selected', true);
$('#or_optionupdate').prop("disabled", "disabled");
$('#and_optionupdate').prop("disabled", "disabled");     
var conditional_operator_check1 = split_cond[1]
var condition_value = JSON.stringify(conditional_operator_check1)
$("#where_check_updatecondition option[value="+condition_value+"]").prop('selected', true)
$('#checkcondition_error').remove();


var column_val = split_cond[2]
var column_valstr = JSON.stringify(column_val)
var column_name = split_cond[0]
var col_name = column_name.split(".")
var col_nam = col_name[1]
var aliasesname=$("#update_tablename :selected").data("aliases");
var tableid =$("#update_tablename :selected").val();
var projectid = $('#projectid').val();
var urllist = window.location.pathname;
var url=urllist.split('/');
var projectid=url[2];

$.ajax({
    type : 'POST',
    url :"/ajaxwhere_tablelist/",
    async: false,
    data:{'projectid':projectid,'tableid':tableid},
    dataType : 'json',
    success : function(data) {
      $('#joinfromupdatetablelist').empty();
      $('#joinfromupdatetablelist').append('<option value="" selected disabled>{{ get_chache_selectjointableerror}}</option>')
      $.each(data.table_data, function(idx2,kvalue){ 
        $('#joinfromupdatetablelist').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');
      });
    }
  });
  $.ajax({
      type : 'POST',
      url :"/ajaxwhere_tablelist/",
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data) {
        $('#selectupdate').empty();
        $('#selectupdate').append('<option value="" disabled>{{ get_chache_selecttableerrormsg }}</option>');
        $.each(data.table_data, function(idx2,kvalue) { 
          $('#selectupdate').append('<option value="'+kvalue.id+'">'+kvalue.tablename+'</option>');
          $('#selectupdate option[value='+kvalue.id+']').prop('selected', true)
        });
        var tableid =  $("#selectupdate :selected").val();
        var column_name = JSON.stringify(col_nam)
        var urllist = window.location.pathname;
        var url=urllist.split('/');
        var projectid=url[2];
        var aliasesname=$("#update_tablename :selected").data("aliases");
      
        $.ajax({
          type:'POST',
          url:"/ajaxwhere_tablelist/",
          async:false,
          data:{'projectid':projectid,'tableid':tableid},
          datatype:'json',
          success : function(data){ 
            $('#select_updatecolumns').empty();
            $('#select_updatecolumns').append('<option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>');
            $('#select_updatecolumns').append('<option data-datatype ="serial" value="id">id</option>');
            $('#select_updatecolumns').append('<option data-datatype ="int4"value="status">status</option>');
            $('#select_updatecolumns').append('<option value="createdon">createdon</option>');
            $('#select_updatecolumns').append('<option value="createdby">createdby</option>');
            $('#select_updatecolumns').append('<option value="modifiedon">modifiedon</option>');
            $('#select_updatecolumns').append('<option value="modifiedby">modifiedby</option>'); 
            $.each(data.where_get_columnname, function(idx2,kvalue){ 
              $('#select_updatecolumns').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
            });
            $('#select_updatecolumns').find('option').not(':selected').each(function(k,v){
              if(col_nam==v.text){   
                finalvalue = JSON.stringify(v.value)  
                $('#select_updatecolumns option[value='+finalvalue+']').prop('selected', true)               
              }
            });
            var urllist = window.location.pathname;
            var url=urllist.split('/');
            var projectid=url[2];
            var tablename =  $("#selectupdate :selected").text();
            var column_name=  $("#select_updatecolumns :selected").text();
            var column_id=  $("#select_updatecolumns :selected").val();
            var tableid =  $("#selectupdate :selected").val();
            var column_values = column_valstr
            $.ajax({
                type:'POST',
                url:"/ajaxwhere_columndata/",
                async:false,
                data:{'projectid':projectid,'tableid':tableid,'column_id':column_id,'column_name':column_name,'tablename':tablename},
                datatype:'json',
                success : function(data) {
                  if(column_name =='status'){
                    $('#select_updatecolumnsvalues').empty();
                    $('#select_updatecolumnsvalues').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                    $.each(data.status_values, function(idx21,value){ 
                      $('#select_updatecolumnsvalues').append('<option value="'+value+'">'+value+'</option>');
                    });
                  }else{
                  $('#select_updatecolumnsvalues').empty();
                  $('#select_updatecolumnsvalues').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                    $.each(data.get_columnvalues, function(idx2,kvalue){ 
                      $.each(kvalue, function(idx21,kvalue1){ 
                        $('#select_updatecolumnsvalues').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
                      });
                    });
                  }
                  $('#select_updatecolumnsvalues option[value='+column_values+']').prop('selected', true);
                  // $('#select_updatecolumnsvalues').selectpicker('refresh')
                }
            });
          }
        });
        var update_column = $('#select_updatecolumns').val()
        if (update_column != '' || update_column != empty){
          $('#get_updatecolumvalues').show();
          $('#defaultvaluesupdate').prop('checked', true);
        }else{
          $('#get_updatecolumvalues').hide();
          $('#defaultvaluesupdate').prop('checked', false);
        } 
      } 
    });    
$.ajax({
url :"/column_list/",
type : 'POST',
async: false,
data:{'projectid':projectid,'tableid':tableid},
dataType : 'json',
success : function(data){
$('#selectpicker1').empty();
$('#selectpicker1').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
$('#selectpicker1').append('<option value="id">id</option>');
$('#selectpicker1').append('<option value="status">status</option>');
$('#selectpicker1').append('<option value="createdon">createdon</option>');
$('#selectpicker1').append('<option value="createdby">createdby</option>');
$('#selectpicker1').append('<option value="modifiedon">modifiedon</option>');
$('#selectpicker1').append('<option value="modifiedby">modifiedby</option>');
$.each(data.get_columnname, function(idx2,kvalue) { 
  $('#selectpicker1').append('<option value="'+kvalue.id+'" name = "'+kvalue.id+'">'+kvalue.columnname+'</option>');
  $("#columnquery").html(data.columnquery);
});
  for (var i = 0; i < tablecol1.length; i++){        
    $('#selectpicker1').find('option').not(':selected').each(function(k,v){
        if(tablecol1[i]==v.text){        
          $('#selectpicker1 option[value='+v.value+']').prop('selected', true);
          }
        });
      }
    }
  });
  $('#selectpicker1').selectpicker('refresh')
  $("[id=wheredisplay],[id=wheredisplay1]").css("display","block");  
  }
  var wherecolumnval = $("#select_updatecolumnsvalues :selected").val()
  $("#condition_updateexecuted").trigger("click")
  var wherecolumnvalstr = JSON.stringify(wherecolumnval)
  $('#select_updatecolumnsvalues option[value='+wherecolumnvalstr+']').prop('selected', true)
  }  
          // IF Condition For checking the Select Query or Join Query
          if (joins1 == -1 && joins2 == -1 && joins3 == -1 && wherecon == -1){
              $("#jointypesfunctions").css("display", "none");
              $("[id=wheredisplay],[id=wheredisplay1]").css("display", "none");
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =$("#update_tablename :selected").val();
              var aliasesname=$("#update_tablename :selected").data("aliases");
              $.ajax({
                url :"/column_list/",
                type : 'POST',
                async: false,
                data:{'projectid':projectid,'tableid':tableid},
                dataType : 'json',
                success : function(data) {
                  $('#aggregatefunctionsupdate').empty();
                  $('#aggregatefunctionsupdate').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
                  $.each(data.get_columnname, function(idx2,kvalue) { 
                    $('#aggregatefunctionsupdate').append('<option value="'+ aliasesname +'.'+kvalue.columnname+'">'+ aliasesname +'.'+kvalue.columnname+'</option>');
                  });
                }
              });
              $('#aggregatefunctionsupdate').selectpicker('refresh') 
              if (groupby == -1){
                var textt = text;
              }else{
                var samtext = text;
                var indexval = samtext.indexOf("GROUP BY")
                var length = samtext.length
                var groupbydata = samtext.slice(indexval, length)      
                var textt = samtext.replaceAll(groupbydata,"")
                var val1 = samtext.split(" GROUP BY ")
                var groupbyval = val1[1] 
                value2 = Array.from(new Set(groupbyval.split(','))).toString();
                var finalvaluea = value2.split(",");
                var array_aggcheck = text.search("ARRAY_AGG")
                var string_aggcheck = text.search("STRING_AGG")
              }      
              var selectqueryvaluid =  text
              var value = "*";
              var asteric_check = selectqueryvaluid.includes(value) ? "Yes" : "No";
              var searchstragg = textt.search("STRING_AGG")
              var searcharragg = textt.search("ARRAY_AGG")
              if(searchstragg != -1){
                $('#groupbyconditionupdate option[value="STRING_AGG"]').prop('selected', true)          
                 var val = textt.replaceAll("(","[").replaceAll(")","]")
                 var finalvalue = Array.from(val.matchAll(/\[([^\][]*)]/g), x => x[1])
                 var arr = []
                 for(var i = 0; i < finalvalue.length; i++){
                   var strval = JSON.stringify(finalvalue[i])
                   $('#aggregatefunctionsupdate option[value='+strval+']').prop('selected', true)
                 }
                 $("#aggregatefunctionsupdate").selectpicker('refresh')
              }
              if(searcharragg != -1){
                $('#groupbyconditionupdate option[value="ARRAY_AGG"]').prop('selected', true)

                var val = textt.replaceAll("(","[").replaceAll(")","]")
                var finalvalue = Array.from(val.matchAll(/\[([^\][]*)]/g), x => x[1])
                var arr = []
                for(var i = 0; i < finalvalue.length; i++){
                  var strval = JSON.stringify(finalvalue[i])
                  $('#aggregatefunctionsupdate option[value='+strval+']').prop('selected', true)
                }
                $("#aggregatefunctionsupdate").selectpicker('refresh')
                      }
              var asplit = textt.replaceAll("a.","").replaceAll("a_","")
              var fromsplit = asplit.split("from");
              var arr = fromsplit[0];
              var selectsplit = arr.split("select").splice(1);
              var selectstr = selectsplit.toString()
              var asreplace = selectstr.replaceAll("as ","")
              var query = asreplace.toString()
              var comaquery = query.replaceAll(" ",",").substring(1)
              value = Array.from(new Set(comaquery.split(','))).toString();
              var tablecol1 = value.split(",");
              tablecol1.splice(-1);
              var aliasesname=$("#update_tablename :selected").data("aliases");
              var tableid =$("#update_tablename :selected").val();
              var projectid = $('#projectid').val();
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              $.ajax({
                    type : 'POST',
                    url :"/ajaxwhere_tablelist/",
                    async: false,
                    data:{'projectid':projectid,'tableid':tableid},
                    dataType : 'json',
                    success : function(data) {
                      $('#joinfromupdatetablelist').empty();
                      $('#joinfromupdatetablelist').append('<option value="" selected disabled>{{ get_chache_selectjointableerror}}</option>')
                      $.each(data.table_data, function(idx2,kvalue) { 
                        $('#joinfromupdatetablelist').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');
                      });
                    }
                  });
 
              $.ajax({
              url :"/column_list/",
              type : 'POST',
              async: false,
              data:{'projectid':projectid,'tableid':tableid},
              dataType : 'json',
              success : function(data) {
                $('#selectpicker1').empty();
                $('#selectpicker1').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                $('#selectpicker1').append('<option value="id">id</option>');
                $('#selectpicker1').append('<option value="status">status</option>');
                $('#selectpicker1').append('<option value="createdon">createdon</option>');
                $('#selectpicker1').append('<option value="createdby">createdby</option>');
                $('#selectpicker1').append('<option value="modifiedon">modifiedon</option>');
                $('#selectpicker1').append('<option value="modifiedby">modifiedby</option>');
                $.each(data.get_columnname, function(idx2,kvalue) { 
                  $('#selectpicker1').append('<option value="'+kvalue.id+'" name = "'+kvalue.id+'">'+kvalue.columnname+'</option>');
                  $("#columnquery").html(data.columnquery);
                });
                for(var i = 0; i < tablecol1.length; i++){        
                $('#selectpicker1').find('option').not(':selected').each(function(k,v){
                    if(tablecol1[i]==v.text){        
                      $('#selectpicker1 option[value='+v.value+']').prop('selected', true)
                    }
                  });
                }
              }
            });
            $('#selectpicker1').selectpicker('refresh')
            if(asteric_check != "No"){
              $('#groupby_updatehideshow').hide();
              $('#selectqueryupdate').html(textt)
              $('#selectpicker1 option').prop('selected', true);
              $( "#selectpicker1 option:first-child" ).prop('selected', false);
              $('#selectpicker1').selectpicker('refresh')
            }
            if(groupby != -1){
              var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
              column_data = value
              string = JSON.stringify(column_data);
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =  $("#update_tablename").val();
              var aliasesname=$("#update_tablename :selected").data("aliases");
                    $.ajax({
                        url :"/ajax_option/",
                        type : 'POST',
                        async: false,
                        data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname},
                        dataType : 'json',
                        success : function(data) {
                          var val = $("#querycontent_data").val()
                          var join_check = val.search("JOIN")
                          if(join_check == -1){
                            $("#selectqueryupdate").html(data.query); 
                          }      
                          $('#groupby_updatecolumnlist').empty();
                          $('#groupby_updatecolumnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
                          $.each(data.string_val3, function(idx2,kvalue){ 
                              $("#groupby_updatecolumnlist").append('<option value="'+aliasesname+'.'+kvalue+'" selected>'+aliasesname+'.'+kvalue+'</option>');
                            });
                        }
                      });
                      $('#groupby_updatecolumnlist').selectpicker('refresh')
                      $('#groupby_updatecolumnlist').trigger("change")  
                    }else{
                      $("#groupby_updatehideshow").hide()
                      var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
                      column_data = value
                      string = JSON.stringify(column_data);
                      var urllist = window.location.pathname;
                      var url=urllist.split('/');
                      var projectid=url[2];
                      var tableid =  $("#update_tablename").val();
                      var aliasesname=$("#update_tablename :selected").data("aliases");
                    $.ajax({
                        url :"/ajax_option/",
                        type : 'POST',
                        async: false,
                        data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname},
                        dataType : 'json',
                        success : function(data) {
                          var val = $("#querycontent_data").val()
                          var join_check = val.search("JOIN")
                          if(join_check == -1){
                            $("#selectqueryupdate").html(data.query); 
                          }    
                          $('#groupby_updatecolumnlist').empty();
                          $('#groupby_updatecolumnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
                          $.each(data.string_val3, function(idx2,kvalue){ 
                              $("#groupby_updatecolumnlist").append('<option value="'+aliasesname+'.'+kvalue+'">'+aliasesname+'.'+kvalue+'</option>');
                            });
                        }
                      });
                      $('#groupby_updatecolumnlist').selectpicker('refresh')
                    };
                    var groupbycondition_val = $("#groupbyconditionupdate").val();
                    if(groupbycondition_val != null || groupbycondition_val.length == 0){
                      $('#groupbyconditionupdate').trigger("click")
                  }    
          }
          //WHERE CONDITION
          if (joins1 == -1 && joins2 == -1 && joins3 == -1 && wherecon != -1){
              $("#jointypesfunctions").css("display", "none");
              $("#wheredisplay").css("display","block");  
              $("#wheredisplay1").css("display","block");  
              $("[id=wheredisplay],[id=wheredisplay1]").css("display","block");  
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =$("#update_tablename :selected").val();
              var aliasesname=$("#update_tablename :selected").data("aliases");
              $.ajax({
                url :"/column_list/",
                type : 'POST',
                async: false,
                data:{'projectid':projectid,'tableid':tableid},
                dataType : 'json',
                success : function(data){
                  $('#aggregatefunctionsupdate').empty();
                  $('#aggregatefunctionsupdate').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                  $.each(data.get_columnname, function(idx2,kvalue) { 
                    $('#aggregatefunctionsupdate').append('<option value="'+ aliasesname +'.'+kvalue.columnname+'">'+ aliasesname +'.'+kvalue.columnname+'</option>');
                  });
                }
              });
              $('#aggregatefunctionsupdate').selectpicker('refresh') 
              if (groupby == -1){
                var textt = text;
                $("#groupby_updatehideshow").hide()   
              }else{
                var samtext = text;
                var indexval = samtext.indexOf("GROUP BY")
                var length = samtext.length
                var groupbydata = samtext.slice(indexval, length)    
                var textt = samtext.replaceAll(groupbydata,"").replaceAll("  "," ").slice(0, -1)
                var val1 = samtext.split(" GROUP BY ")
                var groupbyval = val1[1]
                value2 = Array.from(new Set(groupbyval.split(','))).toString();
                var finalvaluea = value2.split(",");
                var array_aggcheck = text.search("ARRAY_AGG")
                var string_aggcheck = text.search("STRING_AGG") 
            }      
              var searchstragg = textt.search("STRING_AGG")
              var searcharragg = textt.search("ARRAY_AGG")
              if(searchstragg != -1){
                $('#groupbyconditionupdate option[value="STRING_AGG"]').prop('selected', true)
                 
                 var val = textt.replaceAll("(","[").replaceAll(")","]")
                 var finalvalue = Array.from(val.matchAll(/\[([^\][]*)]/g), x => x[1])
                 var arr = []
                 for(var i = 0; i < finalvalue.length; i++){
                   var strval = JSON.stringify(finalvalue[i])
                   $('#aggregatefunctionsupdate option[value='+strval+']').prop('selected', true)
                 }
                 $("#aggregatefunctionsupdate").selectpicker('refresh')
              }
              if(searcharragg != -1){
                $('#groupbyconditionupdate option[value="ARRAY_AGG"]').prop('selected', true)
                 
                var val = textt.replaceAll("(","[").replaceAll(")","]")
                var finalvalue = Array.from(val.matchAll(/\[([^\][]*)]/g), x => x[1])
                var arr = []
                for(var i = 0; i < finalvalue.length; i++){
                  var strval = JSON.stringify(finalvalue[i])
                  $('#aggregatefunctionsupdate option[value='+strval+']').prop('selected', true)
                }
                $("#aggregatefunctionsupdate").selectpicker('refresh')
                      }
              var asplit = textt.replaceAll("a.","").replaceAll("a_","")
              var fromsplit = asplit.split("from");
              var arr = fromsplit[0];
              var selectsplit = arr.split("select").splice(1);
              var selectstr = selectsplit.toString()
              var asreplace = selectstr.replaceAll("as ","")
              var query = asreplace.toString()
              var comaquery = query.replaceAll(" ",",").substring(1)
              value = Array.from(new Set(comaquery.split(','))).toString();
              var tablecol1 = value.split(",");
              tablecol1.splice(-1);
              var splitmain = textt.split(" WHERE ")
              var conditional_operator_check = splitmain[1]
              var selectqueryvaluid =  splitmain[0]
              var value = "*";
              var asteric_check = selectqueryvaluid.includes(value) ? "Yes" : "No";
              var val = conditional_operator_check.split(".")
              var split_cond = conditional_operator_check.split(" ")
             if(split_cond.length > 3){
                var conditional_operator_check1 = split_cond[1]
                var condition_value = JSON.stringify(conditional_operator_check1)
                $("#where_check_updatecondition option[value="+condition_value+"]").prop('selected', true)
                $('#checkcondition_error').remove();
                $('#defaultvaluesupdate').prop('checked', true);

                              
                var column_val = split_cond[2]
                var column_valstr = JSON.stringify(column_val)
                var column_name = split_cond[0]
                var col_splitname = split_cond[0].split(".")
                var col_nam = col_splitname[1]
                var aliasesname=$("#update_tablename :selected").data("aliases");
                var tableid =$("#update_tablename :selected").val();
                var projectid = $('#projectid').val();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                and_con = textt.search("AND")
                or_con = textt.search("OR")
              if( and_con != -1){
                $("#and_optionupdate").css("display","block"); 
                $('#whereupdatecondition option[value="AND"]').prop('selected', true);    
                $('#where_optionupdate').prop("disabled", "disabled")
                $("#or_optionupdate").css("display","block"); 
                $("#or_optionupdate").removeAttr("disabled"); 
                $("#and_optionupdate").removeAttr("disabled"); 
                var andcount = result['AND'];
                // $("#wherequeryupdate").append(" "+data.query);
                var where_con = []
                for(i=0; i<andcount; i++){
                  var secondand = textt.indexOf("AND", and_con+1)
                  if(and_con != -1 && secondand != -1 && groupby == -1){
                    var firstadd = textt.slice(and_con, secondand-1)
                    where_con.push(firstadd)
                    var and_con = secondand
                  }
                  if(and_con != -1 && secondand == -1){
                    var second_val = textt.slice(and_con, textt.length)
                    var split_secondval = second_val.split("AND")
                    var andval = split_secondval[1].replaceAll("a.", "")
                    var split_andval = andval.split(" ")
                    var column_val1 = split_andval[split_andval.length - 1]
                    var column_valstr = JSON.stringify(column_val1)
                    var conditional_operator_check1 = split_andval[2]
                    var condition_value = JSON.stringify(conditional_operator_check1)
                    $("#where_check_updatecondition option[value="+condition_value+"]").prop('selected', true)
                    var col_nam = split_andval[1]
                    if(groupby == -1){
                      where_con.push(second_val)
                    }else{
                      var second_val = textt.slice(and_con, groupby)
                      where_con.push(second_val)
                    }        
                  }
                }
                var andsplitmain = conditional_operator_check.split(" AND ")
                var where_value = andsplitmain[0]
                $("#wherequeryupdate").append("WHERE "+where_value);
                for(i=0; i<where_con.length; i++){
                  $("#wherequeryupdate").append(" "+where_con[i])
                }
              }
              if( or_con != -1){
                $("#or_optionupdate").css("display","block"); 
                $('#whereupdatecondition option[value="OR"]').prop('selected', true);
                $("#whereupdatecondition").prop("disabled", "disabled")
                $("#and_optionupdate").css("display","block"); 
                $("#or_optionupdate").removeAttr("disabled"); 
                $("#and_optionupdate").removeAttr("disabled"); 
                var orcount = result['OR']
                // $("#wherequeryupdate").append(" "+data.query);
                var where_con1 = []
    
                for(i=0; i<orcount; i++){
                  var secondor = textt.indexOf("OR", or_con+1)
                  if(or_con != -1 && secondor != -1 && groupby == -1){
                    var firstadd = textt.slice(or_con, secondor-1)
                    where_con1.push(firstadd)
                    var or_con = secondor
                  }
                  if(or_con != -1 && secondor == -1){
                    var second_val = textt.slice(or_con, textt.length)
                    var split_secondval = second_val.split("OR")
                    var andval = split_secondval[1].replaceAll("a.", "")
                    var split_andval = andval.split(" ")
                    var column_val1 = split_andval[split_andval.length - 1]
                    var column_valstr = JSON.stringify(column_val1)
                    var conditional_operator_check1 = split_andval[2]
                    var condition_value = JSON.stringify(conditional_operator_check1)
                    $("#where_check_updatecondition option[value="+condition_value+"]").prop('selected', true)
                    var col_nam = split_andval[1]
                    if(groupby == -1){
                      where_con1.push(second_val)
                    }else{
                      var second_val = textt.slice(and_con, groupby)
                      where_con1.push(second_val)
                    }        
                  }
                }
                var orsplitmain = conditional_operator_check.split(" OR ")
                var where_value = orsplitmain[0]
                $("#wherequeryupdate").append("WHERE "+where_value);
                for(i=0; i<where_con1.length; i++){
                  $("#wherequeryupdate").append(" "+where_con1[i])
                }
              }
              $.ajax({
                    type : 'POST',
                    url :"/ajaxwhere_tablelist/",
                    async: false,
                    data:{'projectid':projectid,'tableid':tableid},
                    dataType : 'json',
                    success : function(data){
                      $('#joinfromupdatetablelist').empty();
                      $('#joinfromupdatetablelist').append('<option value="" selected disabled>{{ get_chache_selectjointableerror}}</option>')
                      $.each(data.table_data, function(idx2,kvalue){ 
                        $('#joinfromupdatetablelist').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');
                      });
                    }
                  });
                  $.ajax({
                      type : 'POST',
                      url :"/ajaxwhere_tablelist/",
                      async: false,
                      data:{'projectid':projectid,'tableid':tableid},
                      dataType : 'json',
                      success : function(data) {
                        $('#selectupdate').empty();
                        $('#selectupdate').append('<option value="" disabled>{{ get_chache_selecttableerrormsg }}</option>');
                        $.each(data.table_data, function(idx2,kvalue) { 
                          $('#selectupdate').append('<option value="'+kvalue.id+'">'+kvalue.tablename+'</option>');
                          $('#selectupdate option[value='+kvalue.id+']').prop('selected', true)
                        });
                        var tableid =  $("#selectupdate :selected").val();
                        var column_name = JSON.stringify(col_nam)
                        var urllist = window.location.pathname;
                        var url=urllist.split('/');
                        var projectid=url[2];
                        var aliasesname=$("#update_tablename :selected").data("aliases");
                      
                        $.ajax({
                          type:'POST',
                          url:"/ajaxwhere_tablelist/",
                          async:false,
                          data:{'projectid':projectid,'tableid':tableid},
                          datatype:'json',
                          success : function(data){ 
                            $('#select_updatecolumns').empty();
                            $('#select_updatecolumns').append('<option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>');
                            $('#select_updatecolumns').append('<option data-datatype ="serial" value="id">id</option>');
                            $('#select_updatecolumns').append('<option data-datatype ="int4"value="status">status</option>');
                            $('#select_updatecolumns').append('<option value="createdon">createdon</option>');
                            $('#select_updatecolumns').append('<option value="createdby">createdby</option>');
                            $('#select_updatecolumns').append('<option value="modifiedon">modifiedon</option>');
                            $('#select_updatecolumns').append('<option value="modifiedby">modifiedby</option>'); 
                            $.each(data.where_get_columnname, function(idx2,kvalue){ 
                              $('#select_updatecolumns').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
                            });
                            $('#select_updatecolumns').find('option').not(':selected').each(function(k,v){
                              if(col_nam==v.text){   
                                finalvalue = JSON.stringify(v.value)
                                $('#select_updatecolumns option[value='+finalvalue+']').prop('selected', true)               
                              }
                            });
                            var urllist = window.location.pathname;
                            var url=urllist.split('/');
                            var projectid=url[2];
                            var tablename =  $("#selectupdate :selected").text();
                            var column_name=  $("#select_updatecolumns :selected").text();
                            var column_id=  $("#select_updatecolumns :selected").val();
                            var tableid =  $("#selectupdate :selected").val();
                            var column_values =column_valstr.replaceAll("(","").replaceAll(")","")
                            $.ajax({
                                type:'POST',
                                url:"/ajaxwhere_columndata/",
                                async:false,
                                data:{'projectid':projectid,'tableid':tableid,'column_id':column_id,'column_name':column_name,'tablename':tablename},
                                datatype:'json',
                                success : function(data){
                                  if(column_name =='status'){
                                    $('#select_updatecolumnsvalues').empty();
                                    $('#select_updatecolumnsvalues').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                                    $.each(data.status_values, function(idx21,value){ 
                                      $('#select_updatecolumnsvalues').append('<option value="'+value+'">'+value+'</option>');
                                    });
                                  }else{
                                  $('#select_updatecolumnsvalues').empty();
                                  $('#select_updatecolumnsvalues').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                                    $.each(data.get_columnvalues, function(idx2,kvalue){ 
                                      $.each(kvalue, function(idx21,kvalue1){ 
                                        $('#select_updatecolumnsvalues').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
                                      });
                                    });
                                  }
                                  $('#select_updatecolumnsvalues option[value='+column_values+']').prop('selected', true);                                  
                                }
                            });
                            $('#select_updatecolumnsvalues option[value='+column_values+']').prop('selected', true);
                          }
                        });
                        var update_column = $('#select_updatecolumns').val()
                        if (update_column != '' || update_column != empty){
                          $('#get_updatecolumvalues').show();
                          $('#defaultvaluesupdate').prop('checked', true);
                        }else{
                          $('#get_updatecolumvalues').hide();
                          $('#defaultvaluesupdate').prop('checked', false);
                        } 
                      } 
                    });    
              $.ajax({
              url :"/column_list/",
              type : 'POST',
              async: false,
              data:{'projectid':projectid,'tableid':tableid},
              dataType : 'json',
              success : function(data){
                $('#selectpicker1').empty();
                $('#selectpicker1').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                $('#selectpicker1').append('<option value="id">id</option>');
                $('#selectpicker1').append('<option value="status">status</option>');
                $('#selectpicker1').append('<option value="createdon">createdon</option>');
                $('#selectpicker1').append('<option value="createdby">createdby</option>');
                $('#selectpicker1').append('<option value="modifiedon">modifiedon</option>');
                $('#selectpicker1').append('<option value="modifiedby">modifiedby</option>');
                $.each(data.get_columnname, function(idx2,kvalue) { 
                  $('#selectpicker1').append('<option value="'+kvalue.id+'" name = "'+kvalue.id+'">'+kvalue.columnname+'</option>');
                  $("#columnquery").html(data.columnquery);
                });
                for (var i = 0; i < tablecol1.length; i++){        
                $('#selectpicker1').find('option').not(':selected').each(function(k,v){
                    if(tablecol1[i]==v.text){        
                      $('#selectpicker1 option[value='+v.value+']').prop('selected', true);
                    }
                  });
                }
              }
            });
            $('#selectpicker1').selectpicker('refresh')
            $("[id=wheredisplay],[id=wheredisplay1]").css("display","block");  
          }else{
            var andsplit = conditional_operator_check.indexOf("AND")
            var orsplit = conditional_operator_check.indexOf("AND")
            if(andsplit != -1){
              var firstadd = conditional_operator_check.slice(andsplit, conditional_operator_check.length)
            }
            if(orsplit != -1){
              
            }
            $("#whereupdatecondition").css("display","block"); 
            $('#whereupdatecondition option[value="WHERE"]').prop('selected', true);
            $('#or_optionupdate').prop("disabled", "disabled");
            $('#and_optionupdate').prop("disabled", "disabled");     
            var conditional_operator_check1 = split_cond[1]
            var condition_value = JSON.stringify(conditional_operator_check1)
            $("#where_check_updatecondition option[value="+condition_value+"]").prop('selected', true)
            $('#checkcondition_error').remove();
     
            var column_val = split_cond[2]
            var column_valstr = JSON.stringify(column_val)
            var column_name = split_cond[0]
            var col_name = column_name.split(".")
            var col_nam = col_name[1]
            var aliasesname=$("#update_tablename :selected").data("aliases");
            var tableid =$("#update_tablename :selected").val();
            var projectid = $('#projectid').val();
            var urllist = window.location.pathname;
            var url=urllist.split('/');
            var projectid=url[2];
              $.ajax({
                    type : 'POST',
                    url :"/ajaxwhere_tablelist/",
                    async: false,
                    data:{'projectid':projectid,'tableid':tableid},
                    dataType : 'json',
                    success : function(data) {
                      $('#joinfromupdatetablelist').empty();
                      $('#joinfromupdatetablelist').append('<option value="" selected disabled>{{ get_chache_selectjointableerror}}</option>');
                      $.each(data.table_data, function(idx2,kvalue){ 
                        $('#joinfromupdatetablelist').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');
                      });
                    }
                  });
                  $.ajax({
                      type : 'POST',
                      url :"/ajaxwhere_tablelist/",
                      async: false,
                      data:{'projectid':projectid,'tableid':tableid},
                      dataType : 'json',
                      success : function(data){
                        $('#selectupdate').empty();
                        $('#selectupdate').append('<option value="" disabled>{{ get_chache_selecttableerrormsg }}</option>');
                        $.each(data.table_data, function(idx2,kvalue) { 
                          $('#selectupdate').append('<option value="'+kvalue.id+'">'+kvalue.tablename+'</option>');
                          $('#selectupdate option[value='+kvalue.id+']').prop('selected', true)
                        });
                        var tableid =  $("#selectupdate :selected").val();
                        var column_name = JSON.stringify(col_nam)
                        var urllist = window.location.pathname;
                        var url=urllist.split('/');
                        var projectid=url[2];
                        var aliasesname=$("#update_tablename :selected").data("aliases");
                      
                        $.ajax({
                          type:'POST',
                          url:"/ajaxwhere_tablelist/",
                          async:false,
                          data:{'projectid':projectid,'tableid':tableid},
                          datatype:'json',
                          success : function(data){ 
                            $('#select_updatecolumns').empty();
                            $('#select_updatecolumns').append('<option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>');
                            $('#select_updatecolumns').append('<option data-datatype ="serial" value="id">id</option>');
                            $('#select_updatecolumns').append('<option data-datatype ="int4"value="status">status</option>');
                            $('#select_updatecolumns').append('<option value="createdon">createdon</option>');
                            $('#select_updatecolumns').append('<option value="createdby">createdby</option>');
                            $('#select_updatecolumns').append('<option value="modifiedon">modifiedon</option>');
                            $('#select_updatecolumns').append('<option value="modifiedby">modifiedby</option>'); 
                            $.each(data.where_get_columnname, function(idx2,kvalue){ 
                              $('#select_updatecolumns').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
                            });
                            $('#select_updatecolumns').find('option').not(':selected').each(function(k,v){
                              if(col_nam==v.text){   
                                finalvalue = JSON.stringify(v.value)  
                                $('#select_updatecolumns option[value='+finalvalue+']').prop('selected', true)               
                              }
                            });
                            var urllist = window.location.pathname;
                            var url=urllist.split('/');
                            var projectid=url[2];
                            var tablename =  $("#selectupdate :selected").text();
                            var column_name=  $("#select_updatecolumns :selected").text();
                            var column_id=  $("#select_updatecolumns :selected").val();
                            var tableid =  $("#selectupdate :selected").val();
                            var column_values = column_valstr
                            $.ajax({
                                type:'POST',
                                url:"/ajaxwhere_columndata/",
                                async:false,
                                data:{'projectid':projectid,'tableid':tableid,'column_id':column_id,'column_name':column_name,'tablename':tablename},
                                datatype:'json',
                                success : function(data){
                                  if(column_name =='status'){
                                    $('#select_updatecolumnsvalues').empty();
                                    $('#select_updatecolumnsvalues').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                                    $.each(data.status_values, function(idx21,value){ 
                                      $('#select_updatecolumnsvalues').append('<option value="'+value+'">'+value+'</option>');
                                    });
                                  }else{
                                  $('#select_updatecolumnsvalues').empty();
                                  $('#select_updatecolumnsvalues').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                                    $.each(data.get_columnvalues, function(idx2,kvalue){ 
                                      $.each(kvalue, function(idx21,kvalue1){ 
                                        $('#select_updatecolumnsvalues').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
                                      });
                                    });          
                                  }
                                  $('#select_updatecolumnsvalues option[value='+column_values+']').prop('selected', true);
                                }
                                
                            });
                          }
                        });
                        var column_values = column_values
                        var update_column = $('#select_updatecolumns').val()
                        if (update_column != '' || update_column != empty){
                          $('#get_updatecolumvalues').show();
                          $('#defaultvaluesupdate').prop('checked', true);
                        }else{
                          $('#get_updatecolumvalues').hide();
                          $('#defaultvaluesupdate').prop('checked', false);
                        } 
                      } 
                    });    
              $.ajax({
              url :"/column_list/",
              type : 'POST',
              async: false,
              data:{'projectid':projectid,'tableid':tableid},
              dataType : 'json',
              success : function(data){
                $('#selectpicker1').empty();
                $('#selectpicker1').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                $('#selectpicker1').append('<option value="id">id</option>');
                $('#selectpicker1').append('<option value="status">status</option>');
                $('#selectpicker1').append('<option value="createdon">createdon</option>');
                $('#selectpicker1').append('<option value="createdby">createdby</option>');
                $('#selectpicker1').append('<option value="modifiedon">modifiedon</option>');
                $('#selectpicker1').append('<option value="modifiedby">modifiedby</option>');
                $.each(data.get_columnname, function(idx2,kvalue) { 
                  $('#selectpicker1').append('<option value="'+kvalue.id+'" name = "'+kvalue.id+'">'+kvalue.columnname+'</option>');
                  $("#columnquery").html(data.columnquery);
                });
                for (var i = 0; i < tablecol1.length; i++){        
                $('#selectpicker1').find('option').not(':selected').each(function(k,v){
                    if(tablecol1[i]==v.text){        
                      $('#selectpicker1 option[value='+v.value+']').prop('selected', true);
                    }
                  });
                }
              }
            });
            $('#selectpicker1').selectpicker('refresh')
            $("[id=wheredisplay],[id=wheredisplay1]").css("display","block");  
          }
          var urllist = window.location.pathname;
          var url=urllist.split('/');
          var projectid=url[2];
          var tableid =  $("#selectupdate :selected").val();
          var column_id=  $("#select_updatecolumns :selected").val();
          var wherecolumndata = $("#select_updatecolumnsvalues").val();
          var columndatas1=$("#select_updatecolumnsvalues :selected").map((_, e) => e.value).get();
          var columndatas= JSON.stringify(columndatas1);
          var checkcondition =$("#where_check_updatecondition").val();
          var condition=  $("#whereupdatecondition :selected").val();
          var aliasesname=$("#update_tablename :selected").data("aliases");
          var columndatastext=$('#text_select_columnsvalues').val();     
          var column_datatype = $("#select_updatecolumns :selected").data("datatype");
          var tablename =  $("#selectupdate :selected").text();
          var column_name=  $("#select_updatecolumns :selected").text();
          $.ajax({
                  type:'POST',
                  url:"/ajaxwhere_columndataviews/",
                  async:false,
                  data:{'projectid':projectid,'tableid':tableid,'column_id':column_id,'columndatas':columndatas,'checkcondition':checkcondition,'condition':condition,'aliasesname':aliasesname,'columndatastext':columndatastext,'column_datatype':column_datatype,'tablename':tablename,'column_name':column_name},
                  datatype:'json',
                  success : function(data){
                      if((condition =="AND") || (condition =='OR')){
                        $("#or_optionupdate").show();
                        $("#and_optionupdate").show();
                      }else{
                        $("#or_optionupdate").show();
                        $("#and_optionupdate").show();
                        $("#or_optionupdate").removeAttr("disabled");
                        $("#and_optionupdate").removeAttr("disabled");
                        $("#where_optionupdate").prop('disabled', 'disabled')
                      }
                    }
                });
          if(groupby != -1){
              var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
              column_data = value
              string = JSON.stringify(column_data);
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =  $("#update_tablename").val();
              var aliasesname=$("#update_tablename :selected").data("aliases");
                    $.ajax({
                        url :"/ajax_option/",
                        type : 'POST',
                        async: false,
                        data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname},
                        dataType : 'json',
                        success : function(data){
                          var val = $("#querycontent_data").val()
                          var join_check = val.search("JOIN")
                          if(join_check == -1){
                            $("#selectqueryupdate").html(data.query); 
                          }    
                          $('#groupby_updatecolumnlist').empty();
                          $('#groupby_updatecolumnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
                          $.each(data.string_val3, function(idx2,kvalue){ 
                              $("#groupby_updatecolumnlist").append('<option value="'+aliasesname+'.'+kvalue+'" selected>'+aliasesname+'.'+kvalue+'</option>');
                          });
                        }
                      });
                      $('#groupby_updatecolumnlist').selectpicker('refresh')
                      $('#groupby_updatecolumnlist').trigger("change")  
                    }else{
                      var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
                      column_data = value
                      string = JSON.stringify(column_data);
                      var urllist = window.location.pathname;
                      var url=urllist.split('/');
                      var projectid=url[2];
                      var tableid =  $("#update_tablename").val();
                      var aliasesname=$("#update_tablename :selected").data("aliases");
                    $.ajax({
                        url :"/ajax_option/",
                        type : 'POST',
                        async: false,
                        data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname},
                        dataType : 'json',
                        success : function(data) {
                          var val = $("#querycontent_data").val()
                          var join_check = val.search("JOIN")
                          if(join_check == -1){
                            $("#selectqueryupdate").html(data.query); 
                          }    
                          $('#groupby_updatecolumnlist').empty();
                          $('#groupby_updatecolumnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
                          $.each(data.string_val3, function(idx2,kvalue){ 
                              $("#groupby_updatecolumnlist").append('<option value="'+aliasesname+'.'+kvalue+'">'+aliasesname+'.'+kvalue+'</option>');
                            });
                        }
                      });
                      $('#groupby_updatecolumnlist').selectpicker('refresh')
                    };
              wherequery_text = $('#wherequeryupdate').text()
              if(asteric_check != "No"){
                $('#groupby_updatehideshow').hide();
                $('#selectpicker1 option').prop('selected', true);
                $( "#selectpicker1 option:first-child" ).prop('selected', false);
                $('#selectpicker1').selectpicker('refresh')
                $("#selectqueryupdate").html(splitmain[0])
              }
              $("#condition_updateexecuted").trigger("click")
              $("#select_updatecolumnsvalues").val(wherecolumndata)
        }
             
//##########WHERE CONDITION ENDS##################
//##########LEFT JOIN CONDITION###################
          if (joins1 != -1 && join_count == 1){
              $('[id=singlejoin]').show()
              $('#carouselExampleIndicators').show()
              $('#carousel-item-main').show()
              for(var i = 0; i<join_count; i++){
                y = 0
                y++
                $('.card-btm').parent().parentsUntil('section').find('.card-btm').append("<span id='dynamicjoin' style='list-style: none;display: inline-flex;'><h6 class='panel-title'>JOIN "+y+"</h6><label class='switch'><input type='checkbox' id ='samplecheckbox'><span class='slider round'></span></label></span>")
              }
              $("#samplecheckbox").prop('checked', true)
              joinfunction_toggle()
              $('#fromjoin_updateexecute').val("")
              if(joincon != -1){
                     $('#joinupdateon').show();
                     //$("#joinupdateon").removeAttr("disabled")
                     $('#joinupdatecondition option[value="ON"]').prop('selected', true);
                     $('#joinupdateor').prop("disabled",true)
                     $('#joinupdateand').prop("disabled",true)
              }else{
                $("#joinupdateon").prop("disabled",true);
                $("#joinupdateor").pro("disabled",false);
                $("#joinupdateand").prop("disabled",false);
              }
              $("#jointypesfunctions").css("display", "block");
              $("[id=wheredisplay],[id=wheredisplay1]").css("display", "none");
              $('#joinupdatetypes option[value="LEFT JOIN"]').prop('selected', true);
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =$("#update_tablename :selected").val();
              var aliasesname=$("#update_tablename :selected").data("aliases");
              $.ajax({
                url :"/column_list/",
                type : 'POST',
                async: false,
                data:{'projectid':projectid,'tableid':tableid},
                dataType : 'json',
                success : function(data){
                  $('#aggregatefunctionsupdate').empty();
                  $('#aggregatefunctionsupdate').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
                  $.each(data.get_columnname, function(idx2,kvalue) { 
                    $('#aggregatefunctionsupdate').append('<option value="'+ aliasesname +'.'+kvalue.columnname+'">'+ aliasesname +'.'+kvalue.columnname+'</option>');
                  });
                }
              });
              var searchstragg = text.search("STRING_AGG")
              var searcharragg = text.search("ARRAY_AGG")
              if(searchstragg != -1){
                $('#groupbyconditionupdate option[value="STRING_AGG"]').prop('selected', true)
                 
                 var val = text.replaceAll("(","[").replaceAll(")","]")
                 var finalvalue = Array.from(val.matchAll(/\[([^\][]*)]/g), x => x[1])
                 var arr = []
                 for(var i = 0; i < finalvalue.length; i++){
                   var strval = JSON.stringify(finalvalue[i])
                   $('#aggregatefunctionsupdate option[value='+strval+']').prop('selected', true)
                 }
                 $("#aggregatefunctionsupdate").selectpicker('refresh')
              }
              if(searcharragg != -1){
                $('#groupbyconditionupdate option[value="ARRAY_AGG"]').prop('selected', true)
                 
                var val = text.replaceAll("(","[").replaceAll(")","]")
                var finalvalue = Array.from(val.matchAll(/\[([^\][]*)]/g), x => x[1])
                var arr = []
                for(var i = 0; i < finalvalue.length; i++){
                  var strval = JSON.stringify(finalvalue[i])
                  $('#aggregatefunctionsupdate option[value='+strval+']').prop('selected', true)
                }
                $("#aggregatefunctionsupdate").selectpicker('refresh')
                      }

              var asplit = text.replaceAll("a.","").replaceAll("a_","");
              var jointableval1 = text.split(" LEFT JOIN ")
              var splitval = jointableval1[1]
              var finalsplit = splitval.split(" as ")
              var jointable_columnval = finalsplit[0]
              var fromsplit = asplit.split("a1.");
              var arr = fromsplit[0];
              var selectsplit = arr.split("select").splice(1);
              var selectstr = selectsplit.toString()
              var asreplace = selectstr.replaceAll("as ","")
              var query = asreplace.toString()
              var comaquery = query.replaceAll(" ",",").substring(1)
              value = Array.from(new Set(comaquery.split(','))).toString();
              var finalvalue = value.split(",");
              finalvalue.splice(-1);
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =$("#update_tablename :selected").val();
              $.ajax({
              url :"/column_list/",
              type : 'POST',
              async: false,
              data:{'projectid':projectid,'tableid':tableid},
              dataType : 'json',
              success : function(data){
                $('#selectpicker1').empty();
                $('#selectpicker1').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                $('#selectpicker1').append('<option value="id">id</option>');
                $('#selectpicker1').append('<option value="status">status</option>');
                $('#selectpicker1').append('<option value="createdon">createdon</option>');
                $('#selectpicker1').append('<option value="createdby">createdby</option>');
                $('#selectpicker1').append('<option value="modifiedon">modifiedon</option>');
                $('#selectpicker1').append('<option value="modifiedby">modifiedby</option>');
                $.each(data.get_columnname, function(idx2,kvalue) { 
                  $('#selectpicker1').append('<option value="'+kvalue.id+'" name = "'+kvalue.id+'">'+kvalue.columnname+'</option>');
                  $("#columnquery").html(data.columnquery);
                });
                for (var i = 0; i < finalvalue.length; i++){        
                $('#selectpicker1').find('option').not(':selected').each(function(k,v){
                    if(finalvalue[i]==v.text){        
                      $('#selectpicker1 option[value='+v.value+']').prop('selected', true)               
                    }
                  });
                }
              }
          });
            $('#selectpicker1').selectpicker('refresh')
            var finalval1 = $('#update_tablename :selected').val()
            var finalval = JSON.stringify(finalval1)
            $.ajax({
                    type : 'POST',
                    url :"/ajaxwhere_tablelist/",
                    async: false,
                    data:{'projectid':projectid,'tableid':tableid},
                    dataType : 'json',
                    success : function(data){
                      $('#joinfromupdatetablelist').empty();
                      $('#joinfromupdatetablelist').append('<option value="" selected disabled>{{ get_chache_selectjointableerror}}</option>');
                      $.each(data.table_data, function(idx2,kvalue){ 
                        $('#joinfromupdatetablelist').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');        
                      });
                      $('#joinfromupdatetablelist option[value='+finalval+']').prop('selected', true)
                    }
                  }); 
              $('#joinfromupdatetablelist option[value='+finalval+']').prop('selected', true)    
              let lastElement = "a_"+finalvalue[finalvalue.length - 1]
              var value = JSON.stringify(lastElement)
              //here
              var fromsplit2 = asplit.split(" LEFT JOIN ");
              var arr2 = fromsplit2[0]
              var selectsplit2 = arr2.split(JSON.stringify(lastElement)).splice(1);
              var arr3 = fromsplit2[1]
              var leftsplit = asplit.split("LEFT JOIN ");
              var value11 = leftsplit[1]
              var value = value11.split("ON a1.");
              var sampletxt = asplit.split(" ON ")
              var sampletxtval = sampletxt[1]
              var sampletxtwhere = sampletxtval.search( "WHERE")
              if(sampletxtwhere != -1){
                var cond_che1 = sampletxt[1].split(" WHERE ")
                var cond_che = cond_che1[0]
              }else{
                var cond_che = sampletxt[1]
              }
              var cond_check_and = cond_che.search("AND")
              var cond_check_or = cond_che.search("OR")
              if(cond_check_and != -1){
                var last_and = cond_che.lastIndexOf("AND")
                var val_ll = cond_che.slice(last_and, cond_che.length).replaceAll("a1.", "").replaceAll("NOT IN", "=").replaceAll("IS NULL", "=").replaceAll("IS NOT NULL", "=")
                var split_and2 = val_ll.split(" ")
                var joincon = split_and2[0]
                var id1 = split_and2[1]
                var join_condition = split_and2[2]
                var id2 = split_and2[3]
                $('#join_updatecheck_condition option[value ='+JSON.stringify(join_condition)+']').prop('selected', true); 
                $('#joinupdatecondition option[value ='+JSON.stringify(joincon)+']').prop('selected', true); 
                var join_con_not_it = val_ll.search("NOT IN")
                var join_con_is_null = val_ll.search("IS NULL")
                var join_con_is_not_null = val_ll.search("IS NOT NULL")
                if(join_con_not_it != -1){
                  $('#join_updatecheck_condition option[value ="NOT IN"]').prop('selected', true); 
                }
                if(join_con_is_null != -1){
                  $('#join_updatecheck_condition option[value ="IS NULL"]').prop('selected', true); 
                }
                if(join_con_is_not_null != -1){
                  $('#join_updatecheck_condition option[value ="IS NOT NULL"]').prop('selected', true); 
                }
              }
              if(cond_check_or != -1){
                var last_and = cond_che.lastIndexOf("OR")
                var val_ll = cond_che.slice(last_and, cond_che.length).replaceAll("a1.", "").replaceAll("NOT IN", "=").replaceAll("IS NULL", "=").replaceAll("IS NOT NULL", "=")
                var split_and2 = val_ll.split(" ")
                var joincon = split_and2[0]
                var id1 = split_and2[1]
                var join_condition = split_and2[2]
                var id2 = split_and2[3]
                $('#join_updatecheck_condition option[value ='+JSON.stringify(join_condition)+']').prop('selected', true); 
                $("#joinupdateor").show().prop('selected', true);
                $('#joinupdatecondition option[value ='+JSON.stringify(joincon)+']').prop('selected', true); 
                var join_con_not_it = val_ll.search("NOT IN")
                var join_con_is_null = val_ll.search("IS NULL")
                var join_con_is_not_null = val_ll.search("IS NOT NULL")
                if(join_con_not_it != -1){
                  $('#join_updatecheck_condition option[value ="NOT IN"]').prop('selected', true); 
                }
                if(join_con_is_null != -1){
                  $('#join_updatecheck_condition option[value ="IS NULL"]').prop('selected', true); 
                }
                if(join_con_is_not_null != -1){
                  $('#join_updatecheck_condition option[value ="IS NOT NULL"]').prop('selected', true); 
                }
              }
              if(cond_check_and == -1 && cond_check_or == -1){
                var cond = JSON.stringify(cond_che)
                var con1 = cond.split(" ");
                var cond_check = JSON.stringify(con1[1])
                $("#join_updatecheck_condition option[value ="+cond_check+"]").prop('selected', true);
                var ids = cond_che.split(" "+con1[1]+" ")
                var id1 = ids[0].replace("a1.","")
                var id2 = ids[1]
                var check_id2 = JSON.stringify(id2)
                var check_id2cast = check_id2.split("cast(")
                if(check_id2cast.length > 1){
                  var splitval = check_id2cast[1]
                  var finalsplit = splitval.split(" as ")
                  var id2 = finalsplit[0]
                }
                var id3 = ids[2]
                var value22 = id2     
              }
              var columnvalues = Number.isInteger(Number(id2))
              var boolean = columnvalues
              newarr = []
              for(var x = 0; x < fromsplit.length; x++){
                if(fromsplit[x].indexOf("a1_") != -1){
                  newarr.push(fromsplit[x])    
                }
              }
              
              if(newarr.length != 0){
                let lastElement2 = newarr[newarr.length - 1]
                var lastval = lastElement2.split(" from ");
                var lastvalue = lastval[0];
                var tablen = lastval[1].split(" as a LEFT JOIN ")
                var tablename2 = tablen[0]
                var jointable=  lastval[1].split(" as a1 ON")
                var jointablee = jointable[0]
                var jointablename = jointable[0].split(" as a LEFT JOIN ")
                var jointablename = jointable_columnval
                var lastval = lastvalue.split(" as a1_") 
                var lastvalppend = lastval[0]
                newarr.pop()
                newarray = newarr.toString() 
                var asreplace1 = newarray.replaceAll("as ","")
                var query2 = asreplace1.replaceAll("a1_","")
                var query2main = query2.replaceAll(",,",",").replaceAll(" ",",")
                value2 = Array.from(new Set(query2main.split(','))).toString();
                var finalvalue2 = value2.split(",");
                finalvalue2.splice(-1)
                finalvalue2.push(lastvalppend)
                var projectid = $('#projectid').val();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                var tableid =$("#update_tablename :selected").val();
                var valueid = value22
                
                var pagename =$('#pagename').val();
                var array = pagename.split(",");
                var pageid =(array[2]);  
              }else{
                var jointablename = text.split(" as a LEFT JOIN ")
                var split_for_selectqueryid = text.split(" LEFT JOIN")
                $("#selectqueryupdate").html(split_for_selectqueryid[0])
                var lastval = jointablename[1].split(" as a1") 
                var lastvalppend = lastval[0]
                var projectid = $('#projectid').val();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                var tableid =$("#update_tablename :selected").val();
                var jointablename =  lastval[0]
                var valueid = value22        
                var pagename =$('#pagename').val();
                var array = pagename.split(",");
                var pageid =(array[2]);
                $('#selectpicker1 option').prop('selected', true);
                $("#selectpicker1 option:first-child").prop('selected', false);
                $('#selectpicker1').selectpicker('refresh')
              }
              
   
              $.ajax({
                    type : 'POST',
                    url :"/ajax_tanlename/",
                    async: false,
                    data:{'projectid':projectid,'pageid':pageid},
                    success : function(data) {
                      $('#joinupdatetables').empty();
                      $('#joinupdatetables').append('<option value=""selected disabled>{{ get_chache_selectjointableerror }}</option>');
                      $.each(data.tablename, function(idx2,kvalue) { 
                        $('#joinupdatetables').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');
                      });
                $('#joinupdatetables').find('option').not(':selected').each(function(k,v){
                          if(v.text == jointablename){
                            $('#joinupdatetables option[value='+v.value+']').prop('selected', true)       
                          }
                        });
              var get_aliasesname=$("#joinupdatetables :selected").data("aliases");
              $('#outputupdate1').html(function(i, val) { return val*1+1 });
              get_randomnum =$("#outputupdate1").html();
              var aliasesname_colval = get_aliasesname
              var tableidd = $("#joinupdatetables :selected").val();
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              $.ajax({
                url :"/column_list/",
                type : 'POST',
                async: false,
                data:{'projectid':projectid,'tableid':tableidd},
                dataType : 'json',
                success : function(data) {
                  $.each(data.get_columnname, function(idx2,kvalue) {   
                    $('#aggregatefunctionsupdate').append('<option value="'+aliasesname_colval+'.'+kvalue.columnname+'">'+aliasesname_colval+'.'+kvalue.columnname+'</option>');
                  }); 
                }
              }); 
              $('#aggregatefunctionsupdate').selectpicker('refresh')          
              var boolean_val = boolean        
              var tableid1 = $("#joinupdatetables :selected").val();
              var tablename = $("#joinupdatetables :selected").text();
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              $.ajax({
                  url :"/column_list/",
                  type : 'POST',
                  async: false,
                  data:{'projectid':projectid,'tableid':tableid1},
                  dataType : 'json',
                  success : function(data) {                         
                    $('#joinupdatecolumns').empty();
                    $('#joinupdatecolumns').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>');
                    $('#joinupdatecolumns').append('<option data-datatype="serial" value="id">id</option>');
                    $('#joinupdatecolumns').append('<option data-datatype="int4" value="status">status</option>')
                    $('#joinupdatecolumns').append('<option value="createdon">createdon</option>');
                    $('#joinupdatecolumns').append('<option value="createdby">createdby</option>');
                    $('#joinupdatecolumns').append('<option value="modifiedon">modifiedon</option>');
                    $('#joinupdatecolumns').append('<option value="modifiedby">modifiedby</option>');  
                  $.each(data.get_columnname, function(idx2,kvalue){   
                    $('#joinupdatecolumns').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
                  });             
                  $('#joinupdatecolumns').find('option').not(':selected').each(function(k,v){if(v.text == id1){      
                            $('#joinupdatecolumns option[value='+v.value+']').prop('selected', true)       
                          }
                  });
                  $('#Joinupdatecolumnname').empty();
                  $('#Joinupdatecolumnname').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                  $('#Joinupdatecolumnname').append('<option value="id">id</option>');
                  $('#Joinupdatecolumnname').append('<option value="status">status</option>');       
                  $('#Joinupdatecolumnname').append('<option value="createdon">createdon</option>');
                  $('#Joinupdatecolumnname').append('<option value="createdby">createdby</option>');
                  $('#Joinupdatecolumnname').append('<option value="modifiedon">modifiedon</option>');
                  $('#Joinupdatecolumnname').append('<option value="modifiedby">modifiedby</option>'); 
                  $.each(data.get_columnname, function(idx2,kvalue) {   
                    $('#Joinupdatecolumnname').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
                  });                   
                  for (var i = 0; i < finalvalue2.length; i++) {        
                      $('#Joinupdatecolumnname').find('option').not(':selected').each(function(k,v){
                          if(finalvalue2[i]==v.text){
                            $('#Joinupdatecolumnname option[value='+v.value+']').prop('selected', true)       
                          }
                          });
                      }
                    }
                  });  
                $('#Joinupdatecolumnname').selectpicker('refresh')
                
                $('#Joinupdatecolumnname').trigger("change")
                if (boolean_val == true){
                var colum_values = id2
                $('[id=from_column_show_updatedata] [id=from_table_show_updatedata]').hide();
                $('#from_updatejoincheck').css("display","block");
                $('#joinupdatecheck').prop('selected', true); 
                $('#joincolumnvalues_updatedata').show();
                $('#joinfromupdatetablelist option[value=""]').prop('selected', true); 
                $('#joinfromupdatecolumns').empty();
                $('#joinupdatecheck').prop('checked', true);
                $("#from_table_show_updatedata").hide();
                $("#from_column_show_updatedata").hide();
                $('#joinupdatedynamic').trigger("click");
                $('#joinupdatedynamic').trigger("click");
                var tableid = $("#joinupdatetables :selected").text();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                var column_id = $("#joinupdatecolumns :selected").text();
                
                $.ajax({
                  type:'POST',
                  url:"/join_columnvalues/",
                  async:false,
                  data:{'projectid':projectid,'tableid':tableid,'column_id':column_id},
                  datatype:'json',
                  success : function(data) {
                    if(column_id =='status'){
                      $('#joincolumnupdatevalues').empty();
                      $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                      $.each(data.status_values, function(idx21,value){ 
                        $('#joincolumnupdatevalues').append('<option value="'+value+'">'+value+'</option>');
                      });                    
                    }else{
                      $('#joincolumnupdatevalues').empty();
                      $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                      $.each(data.column_values, function(idx2,kvalue){ 
                        $.each(kvalue, function(idx21,kvalue1){ 
                          $('#joincolumnupdatevalues').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
                        });
                      });
                        }
                      column_val = JSON.stringify(colum_values)
                      $('#joincolumnupdatevalues option[value='+column_val+']').prop('selected', true);
                      $('#joincolumnupdatevalues').selectpicker('refresh');      
                      }
                    });

               
              }else{
                $('#joincolumnupdatevalues').empty();
                $('#joinupdatedynamic').prop('checked', true);
                $('#joincolumnvalues_updatedata').hide();
                $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                $('#joincolumnupdatevalues').selectpicker('refresh')  
                $('#joinupdatecheck').prop('checked', false);
                $('#from_column_show_updatedata').show();
                $("#from_table_show_updatedata").show();
                if(groupby != 1){
                  var id2split = id2.split(" GROUP BY")
                  var colu = JSON.stringify(id2split[0])
                }else{
                  var colu = JSON.stringify(id2).replace(" ","")
                }
                var tableid = $("#joinfromupdatetablelist :selected").val();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                $.ajax({
                    url :"/column_list/",
                    type : 'POST',
                    async: false,
                    data:{'projectid':projectid,'tableid':tableid},
                    dataType : 'json',
                    success : function(data){
                      $('#joinfromupdatecolumns').empty();
                      $('#joinfromupdatecolumns').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                      $('#joinfromupdatecolumns').append('<option value="id">id</option>');
                      $('#joinfromupdatecolumns').append('<option value="status">status</option>');
                      $('#joinfromupdatecolumns').append('<option value="createdon">createdon</option>');
                      $('#joinfromupdatecolumns').append('<option value="createdby">createdby</option>');
                      $('#joinfromupdatecolumns').append('<option value="modifiedon">modifiedon</option>');
                      $('#joinfromupdatecolumns').append('<option value="modifiedby">modifiedby</option>');  
                      
                      $.each(data.get_columnname, function(idx2,kvalue) { 
                        $('#joinfromupdatecolumns').append('<option value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
                      });   
                      $('#joinfromupdatecolumns').find('option').not(':selected').each(function(k,v){
                          if(v.text == colu){
                            $('#joinfromupdatecolumns option[value='+v.value+']').prop('selected', true)       
                          }
                        });
                         
                      $('#joinfromupdatecolumns option[value='+colu+']').prop('selected', true)      
                    }
                  }); 
                  $('#joincolumnvalues_updatedata').hide();
                }       
              }
          });
            
            var splitfromjoint = $('#querycontent_data').val(); //fromjoin_updateexecute
            var splitfromjoint1 = splitfromjoint.split("ON ");
            var splitfromjoint2 = "ON "+splitfromjoint1[1];
            if (wherecon != -1){
              var splitfromjoint21 = splitfromjoint2.split(" WHERE ")
              var splitfromjointt = splitfromjoint21[0]
              var finalval = splitfromjointt.replaceAll("  "," ")
              $('#fromjoin_updateexecute').val(finalval);
              wherecondition()
            }else{
              if(groupby != -1){
                var finalvall = splitfromjoint2.split("GROUP BY")
                var finalval = finalvall[0]
              $('#fromjoin_updateexecute').val(finalval);
              }else{
                var finalval = splitfromjoint2.replaceAll("  "," ")
                var finalval_checkand = finalval.search("AND")
                var finalval_checkor = finalval.search("OR")
                $("#joinupdateand").show();
                $("#joinupdateor").show();
                $('#joinupdateand').removeAttr('disabled');
                $('#joinupdateor').removeAttr('disabled');
                $('#joinupdateon').prop('disabled', 'disabled'); 
                if(finalval_checkand != -1){
                  $('#joinupdatecondition option[value="AND"]').prop('selected', true);                 
                }
                if(finalval_checkand == -1 && finalval_checkor == -1){
                  $('#joinupdatecondition option[value ="ON"]').prop('selected', true);
                }
                $('#fromjoin_updateexecute').val(finalval);
              }
            }
            $("#join_updatego").trigger("click");
            if(groupby != -1){
              var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
              column_data = value
              string = JSON.stringify(column_data);
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =  $("#update_tablename").val();
              var aliasesname=$("#update_tablename :selected").data("aliases");
                    $.ajax({
                        url :"/ajax_option/",
                        type : 'POST',
                        async: false,
                        data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname},
                        dataType : 'json',
                        success : function(data) {
                          $('#groupby_updatecolumnlist').empty();
                          $('#groupby_updatecolumnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
                          $.each(data.string_val3, function(idx2,kvalue){ 
                              $("#groupby_updatecolumnlist").append('<option value="'+aliasesname+'.'+kvalue+'" selected>'+aliasesname+'.'+kvalue+'</option>');
                            });
                        }
                      });
                      $('#groupby_updatecolumnlist').selectpicker('refresh')
                      $('#Joinupdatecolumnname').trigger("change")  
                      var split_grp = text.split("GROUP BY ")
                      var split_grp_2 = split_grp[1]
                      value = Array.from(new Set(split_grp_2.split(','))).toString();
                      var tablecol1 = value.split(",");     
                      for(i=0; i < tablecol1.length; i++){
                        $('#groupby_updatecolumnlist option[value="'+tablecol1[i]+'"]').prop('selected', true)
                        $('#groupby_updatecolumnlist').selectpicker('refresh')
                      }                  
                      $("#groupby_updatecolumnlist").trigger("change");
                    }else{
                      $("#groupby_updatehideshow").hide()
                      var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
                      column_data = value
                      string = JSON.stringify(column_data);
                      var urllist = window.location.pathname;
                      var url=urllist.split('/');
                      var projectid=url[2];
                      var tableid =  $("#update_tablename").val();
                      var aliasesname=$("#update_tablename :selected").data("aliases");
                    $.ajax({
                        url :"/ajax_option/",
                        type : 'POST',
                        async: false,
                        data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname},
                        dataType : 'json',
                        success : function(data) {
                          $('#groupby_updatecolumnlist').empty();
                          $('#groupby_updatecolumnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                          $.each(data.string_val3, function(idx2,kvalue){ 
                              $("#groupby_updatecolumnlist").append('<option value="'+aliasesname+'.'+kvalue+'">'+aliasesname+'.'+kvalue+'</option>');
                          });
                        }
                      });
                      $('#groupby_updatecolumnlist').selectpicker('refresh')
                      $('#Joinupdatecolumnname').trigger("change")  
                    };
                if(newarr.length == 0){
                  $('#selectpicker1 option').prop('selected', true);
                  $("#selectpicker1 option:first-child").prop('selected', false);
                  $('#selectpicker1').selectpicker('refresh')
                }        
              }
          // RIGHT JOIN CONDITION  
          if (joins2 != -1 && join_count == 1){
              $('[id=singlejoin]').show()
              $('#carouselExampleIndicators').show()
              $('#carousel-item-main').show()
              for(var i = 0; i<join_count; i++){
                y = 0
                y++
                $('.card-btm').parent().parentsUntil('section').find('.card-btm').append("<span id='dynamicjoin' style='list-style: none;display: inline-flex;'><h6 class='panel-title'>JOIN "+y+"</h6><label class='switch'><input type='checkbox' id ='samplecheckbox'><span class='slider round'></span></label></span>")
              }
              $("#samplecheckbox").prop('checked', true)
              joinfunction_toggle()
              $('#fromjoin_updateexecute').val("")
              if(joincon != -1){
                     $('#joinupdateon').show();
                     $('#joinupdatecondition option[value="ON"]').prop('selected', true);
                     $('#joinupdateor').prop("disabled",true)
                     $('#joinupdateand').prop("disabled",true)
              }else{
                $("#joinupdateon").prop("disabled",true);
                $("#joinupdateor").pro("disabled",false);
                $("#joinupdateand").prop("disabled",false);
              }
              $("#jointypesfunctions").css("display", "block");
              $("[id=wheredisplay],[id=wheredisplay1]").css("display", "none");
              $('#joinupdatetypes option[value="RIGHT JOIN"]').prop('selected', true);
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =$("#update_tablename :selected").val();
              var aliasesname=$("#update_tablename :selected").data("aliases");
              $.ajax({
                url :"/column_list/",
                type : 'POST',
                async: false,
                data:{'projectid':projectid,'tableid':tableid},
                dataType : 'json',
                success : function(data){
                  $('#aggregatefunctionsupdate').empty();
                  $('#aggregatefunctionsupdate').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
                  $.each(data.get_columnname, function(idx2,kvalue) { 
                    $('#aggregatefunctionsupdate').append('<option value="'+ aliasesname +'.'+kvalue.columnname+'">'+ aliasesname +'.'+kvalue.columnname+'</option>');
                  });
                }
              });
              var searchstragg = text.search("STRING_AGG")
              var searcharragg = text.search("ARRAY_AGG")
              if(searchstragg != -1){
                $('#groupbyconditionupdate option[value="STRING_AGG"]').prop('selected', true)
                 
                 var val = text.replaceAll("(","[").replaceAll(")","]")
                 var finalvalue = Array.from(val.matchAll(/\[([^\][]*)]/g), x => x[1])
                 var arr = []
                 for(var i = 0; i < finalvalue.length; i++){
                   var strval = JSON.stringify(finalvalue[i])
                   $('#aggregatefunctionsupdate option[value='+strval+']').prop('selected', true)
                 }
                 $("#aggregatefunctionsupdate").selectpicker('refresh')
              }
              if(searcharragg != -1){
                $('#groupbyconditionupdate option[value="ARRAY_AGG"]').prop('selected', true)
                 
                var val = text.replaceAll("(","[").replaceAll(")","]")
                var finalvalue = Array.from(val.matchAll(/\[([^\][]*)]/g), x => x[1])
                var arr = []
                for(var i = 0; i < finalvalue.length; i++){
                  var strval = JSON.stringify(finalvalue[i])
                  $('#aggregatefunctionsupdate option[value='+strval+']').prop('selected', true)
                }
                $("#aggregatefunctionsupdate").selectpicker('refresh')
                      }

              var asplit = text.replaceAll("a.","").replaceAll("a_","");
              var jointableval1 = text.split(" RIGHT JOIN ")
              var splitval = jointableval1[1]
              var finalsplit = splitval.split(" as ")
              var jointable_columnval = finalsplit[0]
              var fromsplit = asplit.split("a1.");
              var arr = fromsplit[0];
              var selectsplit = arr.split("select").splice(1);
              var selectstr = selectsplit.toString()
              var asreplace = selectstr.replaceAll("as ","")
              var query = asreplace.toString()
              var comaquery = query.replaceAll(" ",",").substring(1)
              value = Array.from(new Set(comaquery.split(','))).toString();
              var finalvalue = value.split(",");
              finalvalue.splice(-1);
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =$("#update_tablename :selected").val();
              $.ajax({
              url :"/column_list/",
              type : 'POST',
              async: false,
              data:{'projectid':projectid,'tableid':tableid},
              dataType : 'json',
              success : function(data){
                $('#selectpicker1').empty();
                $('#selectpicker1').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                $('#selectpicker1').append('<option value="id">id</option>');
                $('#selectpicker1').append('<option value="status">status</option>');
                $('#selectpicker1').append('<option value="createdon">createdon</option>');
                $('#selectpicker1').append('<option value="createdby">createdby</option>');
                $('#selectpicker1').append('<option value="modifiedon">modifiedon</option>');
                $('#selectpicker1').append('<option value="modifiedby">modifiedby</option>');
                $.each(data.get_columnname, function(idx2,kvalue) { 
                  $('#selectpicker1').append('<option value="'+kvalue.id+'" name = "'+kvalue.id+'">'+kvalue.columnname+'</option>');
                  $("#columnquery").html(data.columnquery);
                });
                for (var i = 0; i < finalvalue.length; i++){        
                $('#selectpicker1').find('option').not(':selected').each(function(k,v){
                    if(finalvalue[i]==v.text){        
                      $('#selectpicker1 option[value='+v.value+']').prop('selected', true)               
                    }
                  });
                }
              }
          });
            $('#selectpicker1').selectpicker('refresh')
            var finalval1 = $('#update_tablename :selected').val()
            var finalval = JSON.stringify(finalval1)
            $.ajax({
                    type : 'POST',
                    url :"/ajaxwhere_tablelist/",
                    async: false,
                    data:{'projectid':projectid,'tableid':tableid},
                    dataType : 'json',
                    success : function(data){
                      $('#joinfromupdatetablelist').empty();
                      $('#joinfromupdatetablelist').append('<option value="" selected disabled>{{ get_chache_selectjointableerror}}</option>');
                      $.each(data.table_data, function(idx2,kvalue){ 
                        $('#joinfromupdatetablelist').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');        
                      });
                      $('#joinfromupdatetablelist option[value='+finalval+']').prop('selected', true)
                    }
                  }); 
              $('#joinfromupdatetablelist option[value='+finalval+']').prop('selected', true)    
              let lastElement = "a_"+finalvalue[finalvalue.length - 1]
              var value = JSON.stringify(lastElement)
              var fromsplit2 = asplit.split(" RIGHT JOIN ");
              var arr2 = fromsplit2[0]
              var selectsplit2 = arr2.split(JSON.stringify(lastElement)).splice(1);
              var arr3 = fromsplit2[1]
              var leftsplit = asplit.split("RIGHT JOIN ");
              var value11 = leftsplit[1]
              var value = value11.split("ON a1.");
              var sampletxt = asplit.split(" ON ")
              var sampletxtval = sampletxt[1]
              var sampletxtwhere = sampletxtval.search( "WHERE")
              if(sampletxtwhere != -1){
                var cond_che1 = sampletxt[1].split(" WHERE ")
                var cond_che = cond_che1[0] 
              }else{
                var cond_che = sampletxt[1]
              }
              var cond_check_and = cond_che.search("AND")
              var cond_check_or = cond_che.search("OR")
              if(cond_check_and != -1){
                var last_and = cond_che.lastIndexOf("AND")
                var val_ll = cond_che.slice(last_and, cond_che.length).replaceAll("a1.", "").replaceAll("NOT IN", "=").replaceAll("IS NULL", "=").replaceAll("IS NOT NULL", "=")
                var split_and2 = val_ll.split(" ")
                var joincon = split_and2[0]
                var id1 = split_and2[1]
                var join_condition = split_and2[2]
                var id2 = split_and2[3]
                $('#join_updatecheck_condition option[value ='+JSON.stringify(join_condition)+']').prop('selected', true); 
                $('#joinupdatecondition option[value ='+JSON.stringify(joincon)+']').prop('selected', true); 
                var join_con_not_it = val_ll.search("NOT IN")
                var join_con_is_null = val_ll.search("IS NULL")
                var join_con_is_not_null = val_ll.search("IS NOT NULL")
                if(join_con_not_it != -1){
                  $('#join_updatecheck_condition option[value ="NOT IN"]').prop('selected', true); 
                }
                if(join_con_is_null != -1){
                  $('#join_updatecheck_condition option[value ="IS NULL"]').prop('selected', true); 
                }
                if(join_con_is_not_null != -1){
                  $('#join_updatecheck_condition option[value ="IS NOT NULL"]').prop('selected', true); 
                }
              }
              if(cond_check_or != -1){
                var last_and = cond_che.lastIndexOf("OR")
                var val_ll = cond_che.slice(last_and, cond_che.length).replaceAll("a1.", "").replaceAll("NOT IN", "=").replaceAll("IS NULL", "=").replaceAll("IS NOT NULL", "=")
                var split_and2 = val_ll.split(" ")
                var joincon = split_and2[0]
                var id1 = split_and2[1]
                var join_condition = split_and2[2]
                var id2 = split_and2[3]
                $('#join_updatecheck_condition option[value ='+JSON.stringify(join_condition)+']').prop('selected', true); 
                $("#joinupdateor").show().prop('selected', true);
                $('#joinupdatecondition option[value ='+JSON.stringify(joincon)+']').prop('selected', true); 
                var join_con_not_it = val_ll.search("NOT IN")
                var join_con_is_null = val_ll.search("IS NULL")
                var join_con_is_not_null = val_ll.search("IS NOT NULL")
                if(join_con_not_it != -1){
                  $('#join_updatecheck_condition option[value ="NOT IN"]').prop('selected', true); 
                }
                if(join_con_is_null != -1){
                  $('#join_updatecheck_condition option[value ="IS NULL"]').prop('selected', true); 
                }
                if(join_con_is_not_null != -1){
                  $('#join_updatecheck_condition option[value ="IS NOT NULL"]').prop('selected', true); 
                }
              }
              if(cond_check_and == -1 && cond_check_or == -1){
                var cond = JSON.stringify(cond_che)
                var con1 = cond.split(" ");
                var cond_check = JSON.stringify(con1[1])
                $("#join_updatecheck_condition option[value ="+cond_check+"]").prop('selected', true);
                var ids = cond_che.split(" "+con1[1]+" ")
                var id1 = ids[0].replace("a1.","")
                var id2 = ids[1]
                var check_id2 = JSON.stringify(id2)
                var check_id2cast = check_id2.split("cast(")
                if(check_id2cast.length > 1){
                  var splitval = check_id2cast[1]
                  var finalsplit = splitval.split(" as ")
                  var id2 = finalsplit[0]
                }
                var id3 = ids[2]
                var value22 = id2     
              }
              var columnvalues = Number.isInteger(Number(id2))
              var boolean = columnvalues
              newarr = []
              for(var x = 0; x < fromsplit.length; x++){
                if(fromsplit[x].indexOf("a1_") != -1){
                  newarr.push(fromsplit[x])    
                }
              }
              if(newarr.length != 0){
                let lastElement2 = newarr[newarr.length - 1]
                var lastval = lastElement2.split(" from ");
                var lastvalue = lastval[0];
                var tablen = lastval[1].split(" as a RIGHT JOIN ")
                var tablename2 = tablen[0]
                var jointable=  lastval[1].split(" as a1 ON")
                var jointablee = jointable[0]
                var jointablename = jointable[0].split(" as a RIGHT JOIN ")
                var jointablename = jointable_columnval
                var lastval = lastvalue.split(" as a1_") 
                var lastvalppend = lastval[0]
                newarr.pop()
                newarray = newarr.toString() 
                var asreplace1 = newarray.replaceAll("as ","")
                var query2 = asreplace1.replaceAll("a1_","")
                var query2main = query2.replaceAll(",,",",").replaceAll(" ",",")
                value2 = Array.from(new Set(query2main.split(','))).toString();
                var finalvalue2 = value2.split(",");
                finalvalue2.splice(-1)
                finalvalue2.push(lastvalppend)
                var projectid = $('#projectid').val();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                var tableid =$("#update_tablename :selected").val();
                var valueid = value22          
                var pagename =$('#pagename').val();
                var array = pagename.split(",");
                var pageid =(array[2]);  
              }else{
                var jointablename = text.split(" as a RIGHT JOIN ")
                var split_for_selectqueryid = text.split(" RIGHT JOIN")
                $("#selectqueryupdate").html(split_for_selectqueryid[0])
                var lastval = jointablename[1].split(" as a1") 
                var lastvalppend = lastval[0]
                var projectid = $('#projectid').val();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                var tableid =$("#update_tablename :selected").val();
                var jointablename =  lastval[0]
                var valueid = value22
                $('#selectpicker1 option').prop('selected', true);
                $("#selectpicker1 option:first-child").prop('selected', false);
                $('#selectpicker1').selectpicker('refresh')
                var pagename =$('#pagename').val();
                var array = pagename.split(",");
                var pageid =(array[2]);  
              }
   
              $.ajax({
                    type : 'POST',
                    url :"/ajax_tanlename/",
                    async: false,
                    data:{'projectid':projectid,'pageid':pageid},
                    success : function(data) {
                      $('#joinupdatetables').empty();
                      $('#joinupdatetables').append('<option value=""selected disabled>{{ get_chache_selectjointableerror }}</option>');
                      $.each(data.tablename, function(idx2,kvalue) { 
                        $('#joinupdatetables').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');
                      });
                $('#joinupdatetables').find('option').not(':selected').each(function(k,v){
                          if(v.text == jointablename){
                            $('#joinupdatetables option[value='+v.value+']').prop('selected', true)       
                          }
                        });
              var get_aliasesname=$("#joinupdatetables :selected").data("aliases");
              $('#outputupdate1').html(function(i, val) { return val*1+1 });
              get_randomnum =$("#outputupdate1").html();
              var aliasesname_colval = get_aliasesname
              var tableidd = $("#joinupdatetables :selected").val();
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              $.ajax({
                url :"/column_list/",
                type : 'POST',
                async: false,
                data:{'projectid':projectid,'tableid':tableidd},
                dataType : 'json',
                success : function(data) {
                  $.each(data.get_columnname, function(idx2,kvalue) {   
                    $('#aggregatefunctionsupdate').append('<option value="'+aliasesname_colval+'.'+kvalue.columnname+'">'+aliasesname_colval+'.'+kvalue.columnname+'</option>');
                  }); 
                }
              }); 
              $('#aggregatefunctionsupdate').selectpicker('refresh')          
              var boolean_val = boolean           
              var tableid1 = $("#joinupdatetables :selected").val();
              var tablename = $("#joinupdatetables :selected").text();
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              $.ajax({
                  url :"/column_list/",
                  type : 'POST',
                  async: false,
                  data:{'projectid':projectid,'tableid':tableid1},
                  dataType : 'json',
                  success : function(data) {                         
                    $('#joinupdatecolumns').empty();
                    $('#joinupdatecolumns').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>');
                    $('#joinupdatecolumns').append('<option data-datatype="serial" value="id">id</option>');
                    $('#joinupdatecolumns').append('<option data-datatype="int4" value="status">status</option>');
                    $('#joinupdatecolumns').append('<option value="createdon">createdon</option>');
                    $('#joinupdatecolumns').append('<option value="createdby">createdby</option>');
                    $('#joinupdatecolumns').append('<option value="modifiedon">modifiedon</option>');
                    $('#joinupdatecolumns').append('<option value="modifiedby">modifiedby</option>');  
                  $.each(data.get_columnname, function(idx2,kvalue){   
                    $('#joinupdatecolumns').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
                  });             
                  $('#joinupdatecolumns').find('option').not(':selected').each(function(k,v){if(v.text == id1){      
                            $('#joinupdatecolumns option[value='+v.value+']').prop('selected', true)       
                          }
                  });
                  $('#Joinupdatecolumnname').empty();
                  $('#Joinupdatecolumnname').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                  $('#Joinupdatecolumnname').append('<option value="id">id</option>');
                  $('#Joinupdatecolumnname').append('<option value="status">status</option>');       
                  $('#Joinupdatecolumnname').append('<option value="createdon">createdon</option>');
                  $('#Joinupdatecolumnname').append('<option value="createdby">createdby</option>');
                  $('#Joinupdatecolumnname').append('<option value="modifiedon">modifiedon</option>');
                  $('#Joinupdatecolumnname').append('<option value="modifiedby">modifiedby</option>');        
                  $.each(data.get_columnname, function(idx2,kvalue) {
                    $('#Joinupdatecolumnname').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
                  });                   
                  for (var i = 0; i < finalvalue2.length; i++) {        
                      $('#Joinupdatecolumnname').find('option').not(':selected').each(function(k,v){
                          if(finalvalue2[i]==v.text){
                            $('#Joinupdatecolumnname option[value='+v.value+']').prop('selected', true)       
                          }
                          });
                      }
                    }
                  });  
                $('#Joinupdatecolumnname').selectpicker('refresh')
                
                $('#Joinupdatecolumnname').trigger("change")
                if (boolean_val == true){
                var colum_values = id2
                $('[id=from_column_show_updatedata] [id=from_table_show_updatedata]').hide();
                $('#from_updatejoincheck').css("display","block");
                $('#joinupdatecheck').prop('selected', true); 
                $('#joincolumnvalues_updatedata').show();
                $('#joinfromupdatetablelist option[value=""]').prop('selected', true); 
                $('#joinfromupdatecolumns').empty();
                $('#joinupdatecheck').prop('checked', true);
                $("#from_table_show_updatedata").hide();
                $("#from_column_show_updatedata").hide();
                $('#joinupdatedynamic').trigger("click");
                $('#joinupdatedynamic').trigger("click");
                var tableid = $("#joinupdatetables :selected").text();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                var column_id = $("#joinupdatecolumns :selected").text();
                
                $.ajax({
                  type:'POST',
                  url:"/join_columnvalues/",
                  async:false,
                  data:{'projectid':projectid,'tableid':tableid,'column_id':column_id},
                  datatype:'json',
                  success : function(data) {
                    if(column_id =='status'){
                      $('#joincolumnupdatevalues').empty();
                      $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                      $.each(data.status_values, function(idx21,value){ 
                        $('#joincolumnupdatevalues').append('<option value="'+value+'">'+value+'</option>');
                      });                    
                    }else{
                      $('#joincolumnupdatevalues').empty();
                      $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                      $.each(data.column_values, function(idx2,kvalue){ 
                        $.each(kvalue, function(idx21,kvalue1){ 
                          $('#joincolumnupdatevalues').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
                        });
                      });
                        }
                      column_val = JSON.stringify(colum_values)
                      $('#joincolumnupdatevalues option[value='+column_val+']').prop('selected', true);
                      $('#joincolumnupdatevalues').selectpicker('refresh');      
                      }
                    });

               
              }else{
                $('#joincolumnupdatevalues').empty();
                $('#joinupdatedynamic').prop('checked', true);
                $('#joincolumnvalues_updatedata').hide();
                $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                $('#joincolumnupdatevalues').selectpicker('refresh')  
                $('#joinupdatecheck').prop('checked', false);
                $('#from_column_show_updatedata').show();
                $("#from_table_show_updatedata").show();
                if(groupby != 1){
                  var id2split = id2.split(" GROUP BY")
                  var colu = JSON.stringify(id2split[0])
                }else{
                  var colu = JSON.stringify(id2).replace(" ","")
                }
                var tableid = $("#joinfromupdatetablelist :selected").val();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                $.ajax({
                    url :"/column_list/",
                    type : 'POST',
                    async: false,
                    data:{'projectid':projectid,'tableid':tableid},
                    dataType : 'json',
                    success : function(data){
                      $('#joinfromupdatecolumns').empty();
                      $('#joinfromupdatecolumns').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                      $('#joinfromupdatecolumns').append('<option value="id">id</option>');
                      $('#joinfromupdatecolumns').append('<option value="status">status</option>');
                      $('#joinfromupdatecolumns').append('<option value="createdon">createdon</option>');
                      $('#joinfromupdatecolumns').append('<option value="createdby">createdby</option>');
                      $('#joinfromupdatecolumns').append('<option value="modifiedon">modifiedon</option>');
                      $('#joinfromupdatecolumns').append('<option value="modifiedby">modifiedby</option>');  
                      
                      $.each(data.get_columnname, function(idx2,kvalue) { 
                        $('#joinfromupdatecolumns').append('<option value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
                      });   
                      $('#joinfromupdatecolumns').find('option').not(':selected').each(function(k,v){
                          if(v.text == colu){
                            $('#joinfromupdatecolumns option[value='+v.value+']').prop('selected', true)       
                          }
                        });
                         
                      $('#joinfromupdatecolumns option[value='+colu+']').prop('selected', true)      
                    }
                  }); 
                  $('#joincolumnvalues_updatedata').hide();
                }       
              }
          });
            
            var splitfromjoint = $('#querycontent_data').val(); //fromjoin_updateexecute
            var splitfromjoint1 = splitfromjoint.split("ON ");
            var splitfromjoint2 = "ON "+splitfromjoint1[1];
            if (wherecon != -1){
              var splitfromjoint21 = splitfromjoint2.split(" WHERE ")
              var splitfromjointt = splitfromjoint21[0]
              var finalval = splitfromjointt.replaceAll("  "," ")
              $('#fromjoin_updateexecute').val(finalval);
              wherecondition()
            }else{
              if(groupby != -1){
                var finalvall = splitfromjoint2.split("GROUP BY")
                var finalval = finalvall[0]
              $('#fromjoin_updateexecute').val(finalval);
              }else{
                var finalval = splitfromjoint2.replaceAll("  "," ")
                var finalval_checkand = finalval.search("AND")
                var finalval_checkor = finalval.search("OR")
                $("#joinupdateand").show();
                $("#joinupdateor").show();
                $('#joinupdateand').removeAttr('disabled');
                $('#joinupdateor').removeAttr('disabled');
                $('#joinupdateon').prop('disabled', 'disabled'); 
                if(finalval_checkand != -1){
                  $('#joinupdatecondition option[value="AND"]').prop('selected', true);                 
                }
                if(finalval_checkand == -1 && finalval_checkor == -1){
                  $('#joinupdatecondition option[value ="ON"]').prop('selected', true);
                }
                $('#fromjoin_updateexecute').val(finalval);
              }
            }
            $("#join_updatego").trigger("click");
            if(groupby != -1){
              var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
              column_data = value
              string = JSON.stringify(column_data);
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =  $("#update_tablename").val();
              var aliasesname=$("#update_tablename :selected").data("aliases");
                    $.ajax({
                        url :"/ajax_option/",
                        type : 'POST',
                        async: false,
                        data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname},
                        dataType : 'json',
                        success : function(data) {
                          $('#groupby_updatecolumnlist').empty();
                          $('#groupby_updatecolumnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
                          $.each(data.string_val3, function(idx2,kvalue){ 
                              $("#groupby_updatecolumnlist").append('<option value="'+aliasesname+'.'+kvalue+'" selected>'+aliasesname+'.'+kvalue+'</option>');
                            });
                        }
                      });
                      $('#groupby_updatecolumnlist').selectpicker('refresh')
                      $('#Joinupdatecolumnname').trigger("change")  
                      var split_grp = text.split("GROUP BY ")
                      var split_grp_2 = split_grp[1]
                      value = Array.from(new Set(split_grp_2.split(','))).toString();
                      var tablecol1 = value.split(",");     
                      for(i=0; i < tablecol1.length; i++){
                        $('#groupby_updatecolumnlist option[value="'+tablecol1[i]+'"]').prop('selected', true)
                        $('#groupby_updatecolumnlist').selectpicker('refresh')
                      }                  
                      $("#groupby_updatecolumnlist").trigger("change");
                    }else{
                      $("#groupby_updatehideshow").hide()
                      var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
                      column_data = value
                      string = JSON.stringify(column_data);
                      var urllist = window.location.pathname;
                      var url=urllist.split('/');
                      var projectid=url[2];
                      var tableid =  $("#update_tablename").val();
                      var aliasesname=$("#update_tablename :selected").data("aliases");
                    $.ajax({
                        url :"/ajax_option/",
                        type : 'POST',
                        async: false,
                        data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname},
                        dataType : 'json',
                        success : function(data) {
                          $('#groupby_updatecolumnlist').empty();
                          $('#groupby_updatecolumnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                          $.each(data.string_val3, function(idx2,kvalue){ 
                              $("#groupby_updatecolumnlist").append('<option value="'+aliasesname+'.'+kvalue+'">'+aliasesname+'.'+kvalue+'</option>');
                          });
                        }
                      });
                      $('#groupby_updatecolumnlist').selectpicker('refresh')
                      $('#Joinupdatecolumnname').trigger("change")  
                    };
                    if(newarr.length == 0){
                      $('#selectpicker1 option').prop('selected', true);
                      $("#selectpicker1 option:first-child").prop('selected', false);
                      $('#selectpicker1').selectpicker('refresh')
                    } 
              }
        
          //INNER JOIN CONDITION 
          if (joins3 != -1 && join_count == 1){
            
            $('[id=singlejoin]').show()
            $('#carouselExampleIndicators').show()
            $('#carousel-item-main').show()
            for(var i = 0; i<join_count; i++){
                y = 0
                y++
                $('.card-btm').parent().parentsUntil('section').find('.card-btm').append("<span id='dynamicjoin' style='list-style: none;display: inline-flex;'><h6 class='panel-title'>JOIN "+y+"</h6><label class='switch'><input type='checkbox' id ='samplecheckbox'><span class='slider round'></span></label></span>")
              }
              $("#samplecheckbox").prop('checked', true)
              joinfunction_toggle()
              $('#fromjoin_updateexecute').val("")
              if(joincon != -1){
                     $('#joinupdateon').show();
                     //$("#joinupdateon").removeAttr("disabled")
                     $('#joinupdatecondition option[value="ON"]').prop('selected', true);
                     $('#joinupdateor').prop("disabled",true)
                     $('#joinupdateand').prop("disabled",true)
              }else{
                $("#joinupdateon").prop("disabled",true);
                $("#joinupdateor").pro("disabled",false);
                $("#joinupdateand").prop("disabled",false);
              }
              $("#jointypesfunctions").css("display", "block");
              $("[id=wheredisplay],[id=wheredisplay1]").css("display", "none");
              $('#joinupdatetypes option[value="INNER JOIN"]').prop('selected', true);
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =$("#update_tablename :selected").val();
              var aliasesname=$("#update_tablename :selected").data("aliases");
              $.ajax({
                url :"/column_list/",
                type : 'POST',
                async: false,
                data:{'projectid':projectid,'tableid':tableid},
                dataType : 'json',
                success : function(data){
                  $('#aggregatefunctionsupdate').empty();
                  $('#aggregatefunctionsupdate').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
                  $.each(data.get_columnname, function(idx2,kvalue) { 
                    $('#aggregatefunctionsupdate').append('<option value="'+ aliasesname +'.'+kvalue.columnname+'">'+ aliasesname +'.'+kvalue.columnname+'</option>');
                  });
                }
              });
              var searchstragg = text.search("STRING_AGG")
              var searcharragg = text.search("ARRAY_AGG")
              if(searchstragg != -1){
                $('#groupbyconditionupdate option[value="STRING_AGG"]').prop('selected', true)
                 
                 var val = text.replaceAll("(","[").replaceAll(")","]")
                 var finalvalue = Array.from(val.matchAll(/\[([^\][]*)]/g), x => x[1])
                 var arr = []
                 for(var i = 0; i < finalvalue.length; i++){
                   var strval = JSON.stringify(finalvalue[i])
                   $('#aggregatefunctionsupdate option[value='+strval+']').prop('selected', true)
                 }
                 $("#aggregatefunctionsupdate").selectpicker('refresh')
              }
              if(searcharragg != -1){
                $('#groupbyconditionupdate option[value="ARRAY_AGG"]').prop('selected', true)
                 
                var val = text.replaceAll("(","[").replaceAll(")","]")
                var finalvalue = Array.from(val.matchAll(/\[([^\][]*)]/g), x => x[1])
                var arr = []
                for(var i = 0; i < finalvalue.length; i++){
                  var strval = JSON.stringify(finalvalue[i])
                  $('#aggregatefunctionsupdate option[value='+strval+']').prop('selected', true)
                }
                $("#aggregatefunctionsupdate").selectpicker('refresh')
                      }

              var asplit = text.replaceAll("a.","").replaceAll("a_","");
              var jointableval1 = text.split(" INNER JOIN ")
              var splitval = jointableval1[1]
              var finalsplit = splitval.split(" as ")
              var jointable_columnval = finalsplit[0]
              var fromsplit = asplit.split("a1.");
              var arr = fromsplit[0];
              var selectsplit = arr.split("select").splice(1);
              var selectstr = selectsplit.toString()
              var asreplace = selectstr.replaceAll("as ","")
              var query = asreplace.toString()
              var comaquery = query.replaceAll(" ",",").substring(1)
              value = Array.from(new Set(comaquery.split(','))).toString();
              var finalvalue = value.split(",");
              finalvalue.splice(-1);
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =$("#update_tablename :selected").val();
              $.ajax({
              url :"/column_list/",
              type : 'POST',
              async: false,
              data:{'projectid':projectid,'tableid':tableid},
              dataType : 'json',
              success : function(data){
                $('#selectpicker1').empty();
                $('#selectpicker1').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                $('#selectpicker1').append('<option value="id">id</option>');
                $('#selectpicker1').append('<option value="status">status</option>');
                $('#selectpicker1').append('<option value="createdon">createdon</option>');
                $('#selectpicker1').append('<option value="createdby">createdby</option>');
                $('#selectpicker1').append('<option value="modifiedon">modifiedon</option>');
                $('#selectpicker1').append('<option value="modifiedby">modifiedby</option>');
                $.each(data.get_columnname, function(idx2,kvalue) { 
                  $('#selectpicker1').append('<option value="'+kvalue.id+'" name = "'+kvalue.id+'">'+kvalue.columnname+'</option>');
                  $("#columnquery").html(data.columnquery);
                });
                for (var i = 0; i < finalvalue.length; i++){        
                $('#selectpicker1').find('option').not(':selected').each(function(k,v){
                    if(finalvalue[i]==v.text){        
                      $('#selectpicker1 option[value='+v.value+']').prop('selected', true)               
                    }
                  });
                }
              }
          });
            $('#selectpicker1').selectpicker('refresh')
            var finalval1 = $('#update_tablename :selected').val()
            var finalval = JSON.stringify(finalval1)
            $.ajax({
                    type : 'POST',
                    url :"/ajaxwhere_tablelist/",
                    async: false,
                    data:{'projectid':projectid,'tableid':tableid},
                    dataType : 'json',
                    success : function(data){
                      $('#joinfromupdatetablelist').empty();
                      $('#joinfromupdatetablelist').append('<option value="" selected disabled>{{ get_chache_selectjointableerror}}</option>');
                      $.each(data.table_data, function(idx2,kvalue){ 
                        $('#joinfromupdatetablelist').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');        
                      });
                      $('#joinfromupdatetablelist option[value='+finalval+']').prop('selected', true)
                    }
                  }); 
              $('#joinfromupdatetablelist option[value='+finalval+']').prop('selected', true)    
              let lastElement = "a_"+finalvalue[finalvalue.length - 1]
              var value = JSON.stringify(lastElement)
              var fromsplit2 = asplit.split(" INNER JOIN ");
              var arr2 = fromsplit2[0]
              var selectsplit2 = arr2.split(JSON.stringify(lastElement)).splice(1);
              var arr3 = fromsplit2[1]  
              var leftsplit = asplit.split("INNER JOIN ");
              var value11 = leftsplit[1]
              var value = value11.split("ON a1.");
              var sampletxt = asplit.split(" ON ")
              var sampletxtval = sampletxt[1]
              var sampletxtwhere = sampletxtval.search( "WHERE")
              if(sampletxtwhere != -1){
                var cond_che1 = sampletxt[1].split(" WHERE ")
                var cond_che = cond_che1[0]
              }else{
                var cond_che = sampletxt[1]
              }
              var cond_check_and = cond_che.search("AND")
              var cond_check_or = cond_che.search("OR")
              if(cond_check_and != -1){
                var last_and = cond_che.lastIndexOf("AND")
                var val_ll = cond_che.slice(last_and, cond_che.length).replaceAll("a1.", "").replaceAll("NOT IN", "=").replaceAll("IS NULL", "=").replaceAll("IS NOT NULL", "=")
                var split_and2 = val_ll.split(" ")
                var joincon = split_and2[0]
                var id1 = split_and2[1]
                var join_condition = split_and2[2]
                var id2 = split_and2[3]
                $('#join_updatecheck_condition option[value ='+JSON.stringify(join_condition)+']').prop('selected', true); 
                $('#joinupdatecondition option[value ='+JSON.stringify(joincon)+']').prop('selected', true); 
                var join_con_not_it = val_ll.search("NOT IN")
                var join_con_is_null = val_ll.search("IS NULL")
                var join_con_is_not_null = val_ll.search("IS NOT NULL")
                if(join_con_not_it != -1){
                  $('#join_updatecheck_condition option[value ="NOT IN"]').prop('selected', true); 
                }
                if(join_con_is_null != -1){
                  $('#join_updatecheck_condition option[value ="IS NULL"]').prop('selected', true); 
                }
                if(join_con_is_not_null != -1){
                  $('#join_updatecheck_condition option[value ="IS NOT NULL"]').prop('selected', true); 
                }
              }
              if(cond_check_or != -1){
                var last_and = cond_che.lastIndexOf("OR")
                var val_ll = cond_che.slice(last_and, cond_che.length).replaceAll("a1.", "").replaceAll("NOT IN", "=").replaceAll("IS NULL", "=").replaceAll("IS NOT NULL", "=")
                var split_and2 = val_ll.split(" ")
                var joincon = split_and2[0]
                var id1 = split_and2[1]
                var join_condition = split_and2[2]
                var id2 = split_and2[3]
                $('#join_updatecheck_condition option[value ='+JSON.stringify(join_condition)+']').prop('selected', true); 
                $("#joinupdateor").show().prop('selected', true);
                $('#joinupdatecondition option[value ='+JSON.stringify(joincon)+']').prop('selected', true); 
                var join_con_not_it = val_ll.search("NOT IN")
                var join_con_is_null = val_ll.search("IS NULL")
                var join_con_is_not_null = val_ll.search("IS NOT NULL")
                if(join_con_not_it != -1){
                  $('#join_updatecheck_condition option[value ="NOT IN"]').prop('selected', true); 
                }
                if(join_con_is_null != -1){
                  $('#join_updatecheck_condition option[value ="IS NULL"]').prop('selected', true); 
                }
                if(join_con_is_not_null != -1){
                  $('#join_updatecheck_condition option[value ="IS NOT NULL"]').prop('selected', true); 
                }
              }
              if(cond_check_and == -1 && cond_check_or == -1){
                var cond = JSON.stringify(cond_che)
                var con1 = cond.split(" ");
                var cond_check = JSON.stringify(con1[1])
                $("#join_updatecheck_condition option[value ="+cond_check+"]").prop('selected', true);
                var ids = cond_che.split(" "+con1[1]+" ")
                var id1 = ids[0].replace("a1.","")
                var id2 = ids[1]
                var check_id2 = JSON.stringify(id2)
                var check_id2cast = check_id2.split("cast(")
                if(check_id2cast.length > 1){
                  var splitval = check_id2cast[1]
                  var finalsplit = splitval.split(" as ")
                  var id2 = finalsplit[0]
                }
                var id3 = ids[2]
                var value22 = id2     
              }   
              var columnvalues = Number.isInteger(Number(id2))
              var boolean = columnvalues
              newarr = []
              for(var x = 0; x < fromsplit.length; x++){
                if(fromsplit[x].indexOf("a1_") != -1){
                  newarr.push(fromsplit[x])    
                }
              }
              if(newarr.length != 0){
                let lastElement2 = newarr[newarr.length - 1]
                var lastval = lastElement2.split(" from ");
                var lastvalue = lastval[0];
                var tablen = lastval[1].split(" as a INNER JOIN ")
                var tablename2 = tablen[0]
                var jointable=  lastval[1].split(" as a1 ON")
                var jointablee = jointable[0]
                var jointablename = jointable[0].split(" as a INNER JOIN ")
                var jointablename = jointable_columnval
                var lastval = lastvalue.split(" as a1_") 
                var lastvalppend = lastval[0]
                newarr.pop()
                newarray = newarr.toString() 
                var asreplace1 = newarray.replaceAll("as ","")
                var query2 = asreplace1.replaceAll("a1_","")
                var query2main = query2.replaceAll(",,",",").replaceAll(" ",",")
                value2 = Array.from(new Set(query2main.split(','))).toString();
                var finalvalue2 = value2.split(",");
                finalvalue2.splice(-1)
                finalvalue2.push(lastvalppend)
                var projectid = $('#projectid').val();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                var tableid =$("#update_tablename :selected").val();
                var valueid = value22
                
                var pagename =$('#pagename').val();
                var array = pagename.split(",");
                var pageid =(array[2]);  
              }else{
                var jointablename = text.split(" as a INNER JOIN ")
                var split_for_selectqueryid = text.split(" INNER JOIN")
                $("#selectqueryupdate").html(split_for_selectqueryid[0])
                var lastval = jointablename[1].split(" as a1") 
                var lastvalppend = lastval[0]
                var projectid = $('#projectid').val();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                var tableid =$("#update_tablename :selected").val();
                var jointablename =  lastval[0]
                var valueid = value22
                $('#selectpicker1 option').prop('selected', true);
                $("#selectpicker1 option:first-child").prop('selected', false);
                $('#selectpicker1').selectpicker('refresh')
                var pagename =$('#pagename').val();
                var array = pagename.split(",");
                var pageid =(array[2]);  
              } 
   
              $.ajax({
                    type : 'POST',
                    url :"/ajax_tanlename/",
                    async: false,
                    data:{'projectid':projectid,'pageid':pageid},
                    success : function(data) {
                      $('#joinupdatetables').empty();
                      $('#joinupdatetables').append('<option value=""selected disabled>{{ get_chache_selectjointableerror }}</option>');
                      $.each(data.tablename, function(idx2,kvalue) { 
                        $('#joinupdatetables').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');
                      });
                $('#joinupdatetables').find('option').not(':selected').each(function(k,v){
                          if(v.text == jointablename){
                            $('#joinupdatetables option[value='+v.value+']').prop('selected', true)       
                          }
                        });
              var get_aliasesname=$("#joinupdatetables :selected").data("aliases");
              $('#outputupdate1').html(function(i, val) { return val*1+1 });
              get_randomnum =$("#outputupdate1").html();
              var aliasesname_colval = get_aliasesname
              var tableidd = $("#joinupdatetables :selected").val();
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              $.ajax({
                url :"/column_list/",
                type : 'POST',
                async: false,
                data:{'projectid':projectid,'tableid':tableidd},
                dataType : 'json',
                success : function(data) {
                  $.each(data.get_columnname, function(idx2,kvalue) {   
                    $('#aggregatefunctionsupdate').append('<option value="'+aliasesname_colval+'.'+kvalue.columnname+'">'+aliasesname_colval+'.'+kvalue.columnname+'</option>');
                  }); 
                }
              }); 
              $('#aggregatefunctionsupdate').selectpicker('refresh')          
              var boolean_val = boolean          
              var tableid1 = $("#joinupdatetables :selected").val();
              var tablename = $("#joinupdatetables :selected").text();
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              $.ajax({
                  url :"/column_list/",
                  type : 'POST',
                  async: false,
                  data:{'projectid':projectid,'tableid':tableid1},
                  dataType : 'json',
                  success : function(data) {                         
                    $('#joinupdatecolumns').empty();
                    $('#joinupdatecolumns').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>');
                    $('#joinupdatecolumns').append('<option data-datatype="serial" value="id">id</option>');
                    $('#joinupdatecolumns').append('<option data-datatype="int4" value="status">status</option>')
                    $('#joinupdatecolumns').append('<option value="createdon">createdon</option>');
                    $('#joinupdatecolumns').append('<option value="createdby">createdby</option>');
                    $('#joinupdatecolumns').append('<option value="modifiedon">modifiedon</option>');
                    $('#joinupdatecolumns').append('<option value="modifiedby">modifiedby</option>');  
                  $.each(data.get_columnname, function(idx2,kvalue){   
                    $('#joinupdatecolumns').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
                  });             
                  $('#joinupdatecolumns').find('option').not(':selected').each(function(k,v){if(v.text == id1){      
                            $('#joinupdatecolumns option[value='+v.value+']').prop('selected', true)       
                          }
                        });
                        $('#Joinupdatecolumnname').empty();
                        $('#Joinupdatecolumnname').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                        $('#Joinupdatecolumnname').append('<option value="id">id</option>');
                        $('#Joinupdatecolumnname').append('<option value="status">status</option>');  
                        $('#Joinupdatecolumnname').append('<option value="createdon">createdon</option>');
                        $('#Joinupdatecolumnname').append('<option value="createdby">createdby</option>');
                        $('#Joinupdatecolumnname').append('<option value="modifiedon">modifiedon</option>');
                        $('#Joinupdatecolumnname').append('<option value="modifiedby">modifiedby</option>');   
                  $.each(data.get_columnname, function(idx2,kvalue) {   
                    $('#Joinupdatecolumnname').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
                  });                   
                  for (var i = 0; i < finalvalue2.length; i++) {        
                      $('#Joinupdatecolumnname').find('option').not(':selected').each(function(k,v){
                          if(finalvalue2[i]==v.text){
                            $('#Joinupdatecolumnname option[value='+v.value+']').prop('selected', true)       
                          }
                          });
                      }
                    }
                  });  
                $('#Joinupdatecolumnname').selectpicker('refresh')
                
                $('#Joinupdatecolumnname').trigger("change")
                if (boolean_val == true){
                var colum_values = id2
                $('[id=from_column_show_updatedata] [id=from_table_show_updatedata]').hide();
                $('#from_updatejoincheck').css("display","block");
                $('#joinupdatecheck').prop('selected', true); 
                $('#joincolumnvalues_updatedata').show();
                $('#joinfromupdatetablelist option[value=""]').prop('selected', true); 
                $('#joinfromupdatecolumns').empty();
                $('#joinupdatecheck').prop('checked', true);
                $("#from_table_show_updatedata").hide();
                $("#from_column_show_updatedata").hide();
                $('#joinupdatedynamic').trigger("click");
                $('#joinupdatedynamic').trigger("click");
                var tableid = $("#joinupdatetables :selected").text();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                var column_id = $("#joinupdatecolumns :selected").text();
                
                $.ajax({
                  type:'POST',
                  url:"/join_columnvalues/",
                  async:false,
                  data:{'projectid':projectid,'tableid':tableid,'column_id':column_id},
                  datatype:'json',
                  success : function(data) {
                    if(column_id =='status'){
                      $('#joincolumnupdatevalues').empty();
                      $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                      $.each(data.status_values, function(idx21,value){ 
                        $('#joincolumnupdatevalues').append('<option value="'+value+'">'+value+'</option>');
                      });                    
                    }else{
                      $('#joincolumnupdatevalues').empty();
                      $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                      $.each(data.column_values, function(idx2,kvalue){ 
                        $.each(kvalue, function(idx21,kvalue1){ 
                          $('#joincolumnupdatevalues').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
                        });
                      });
                        }
                      column_val = JSON.stringify(colum_values)
                      $('#joincolumnupdatevalues option[value='+column_val+']').prop('selected', true);
                      $('#joincolumnupdatevalues').selectpicker('refresh');      
                      }
                    });

               
              }else{
                $('#joincolumnupdatevalues').empty();
                $('#joinupdatedynamic').prop('checked', true);
                $('#joincolumnvalues_updatedata').hide();
                $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                $('#joincolumnupdatevalues').selectpicker('refresh')  
                $('#joinupdatecheck').prop('checked', false);
                $('#from_column_show_updatedata').show();
                $("#from_table_show_updatedata").show();
                if(groupby != 1){
                  var id2split = id2.split(" GROUP BY")
                  var colu = JSON.stringify(id2split[0])
                }else{
                  var colu = JSON.stringify(id2).replace(" ","")
                }
                var tableid = $("#joinfromupdatetablelist :selected").val();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                $.ajax({
                    url :"/column_list/",
                    type : 'POST',
                    async: false,
                    data:{'projectid':projectid,'tableid':tableid},
                    dataType : 'json',
                    success : function(data){
                      $('#joinfromupdatecolumns').empty();
                      $('#joinfromupdatecolumns').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                      $('#joinfromupdatecolumns').append('<option value="id">id</option>');
                      $('#joinfromupdatecolumns').append('<option value="status">status</option>');
                      $('#joinfromupdatecolumns').append('<option value="createdon">createdon</option>');
                      $('#joinfromupdatecolumns').append('<option value="createdby">createdby</option>');
                      $('#joinfromupdatecolumns').append('<option value="modifiedon">modifiedon</option>');
                      $('#joinfromupdatecolumns').append('<option value="modifiedby">modifiedby</option>');  
                      
                      $.each(data.get_columnname, function(idx2,kvalue) { 
                        $('#joinfromupdatecolumns').append('<option value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
                      });   
                      $('#joinfromupdatecolumns').find('option').not(':selected').each(function(k,v){
                          if(v.text == colu){
                            $('#joinfromupdatecolumns option[value='+v.value+']').prop('selected', true)       
                          }
                        });
                         
                      $('#joinfromupdatecolumns option[value='+colu+']').prop('selected', true)      
                    }
                  }); 
                  $('#joincolumnvalues_updatedata').hide();
                }       
              }
          });
            
            var splitfromjoint = $('#querycontent_data').val(); //fromjoin_updateexecute
            var splitfromjoint1 = splitfromjoint.split("ON ");
            var splitfromjoint2 = "ON "+splitfromjoint1[1];
            if (wherecon != -1){
              var splitfromjoint21 = splitfromjoint2.split(" WHERE ")
              var splitfromjointt = splitfromjoint21[0]
              var finalval = splitfromjointt.replaceAll("  "," ")
              $('#fromjoin_updateexecute').val(finalval);
              wherecondition()
            }else{
              if(groupby != -1){
                var finalvall = splitfromjoint2.split("GROUP BY")
                var finalval = finalvall[0]
              $('#fromjoin_updateexecute').val(finalval);
              }else{
                var finalval = splitfromjoint2.replaceAll("  "," ")
                var finalval_checkand = finalval.search("AND")
                var finalval_checkor = finalval.search("OR")
                $("#joinupdateand").show();
                $("#joinupdateor").show();
                $('#joinupdateand').removeAttr('disabled');
                $('#joinupdateor').removeAttr('disabled');
                $('#joinupdateon').prop('disabled', 'disabled'); 
                if(finalval_checkand != -1){
                  $('#joinupdatecondition option[value="AND"]').prop('selected', true);                 
                }
                if(finalval_checkand == -1 && finalval_checkor == -1){
                  $('#joinupdatecondition option[value ="ON"]').prop('selected', true);
                }
                $('#fromjoin_updateexecute').val(finalval);
              }
            }
            $("#join_updatego").trigger("click");
            if(groupby != -1){
              var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
              column_data = value
              string = JSON.stringify(column_data);
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var tableid =  $("#update_tablename").val();
              var aliasesname=$("#update_tablename :selected").data("aliases");
                    $.ajax({
                        url :"/ajax_option/",
                        type : 'POST',
                        async: false,
                        data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname},
                        dataType : 'json',
                        success : function(data) {
                          $('#groupby_updatecolumnlist').empty();
                          $('#groupby_updatecolumnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
                          $.each(data.string_val3, function(idx2,kvalue){ 
                              $("#groupby_updatecolumnlist").append('<option value="'+aliasesname+'.'+kvalue+'" selected>'+aliasesname+'.'+kvalue+'</option>');
                            });
                        }
                      });
                      $('#groupby_updatecolumnlist').selectpicker('refresh')
                      $('#Joinupdatecolumnname').trigger("change")  
                      var split_grp = text.split("GROUP BY ")
                      var split_grp_2 = split_grp[1]
                      value = Array.from(new Set(split_grp_2.split(','))).toString();
                      var tablecol1 = value.split(",");     
                      for(i=0; i < tablecol1.length; i++){
                        $('#groupby_updatecolumnlist option[value="'+tablecol1[i]+'"]').prop('selected', true)
                        $('#groupby_updatecolumnlist').selectpicker('refresh')
                      }                  
                      $("#groupby_updatecolumnlist").trigger("change");
                    }else{
                      $("#groupby_updatehideshow").hide()
                      var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
                      column_data = value
                      string = JSON.stringify(column_data);
                      var urllist = window.location.pathname;
                      var url=urllist.split('/');
                      var projectid=url[2];
                      var tableid =  $("#update_tablename").val();
                      var aliasesname=$("#update_tablename :selected").data("aliases");
                    $.ajax({
                        url :"/ajax_option/",
                        type : 'POST',
                        async: false,
                        data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname},
                        dataType : 'json',
                        success : function(data) {
                          $('#groupby_updatecolumnlist').empty();
                          $('#groupby_updatecolumnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                          $.each(data.string_val3, function(idx2,kvalue){ 
                              $("#groupby_updatecolumnlist").append('<option value="'+aliasesname+'.'+kvalue+'">'+aliasesname+'.'+kvalue+'</option>');
                          });
                        }
                      });
                      $('#groupby_updatecolumnlist').selectpicker('refresh')
                      $('#Joinupdatecolumnname').trigger("change")  
                    }; 
                    if(newarr.length == 0){
                      $('#selectpicker1 option').prop('selected', true);
                      $("#selectpicker1 option:first-child").prop('selected', false);
                      $('#selectpicker1').selectpicker('refresh')
                    }                                 
                  }
          if (join_count > 1){
               // MORE LEFT JOIN 
              var asteric_c=  text
              var asteric_cvalue = "*";
              var asteric_check = asteric_c.includes(asteric_cvalue) ? "Yes" : "No";
               $('[id=singlejoin]').hide();
               $('#carouselExampleIndicators').show()
               $('#jointypesfunctions').show();
               var aliasesname=$("#update_tablename :selected").data("aliases");
               var urllist = window.location.pathname;
               var url=urllist.split('/');
               var projectid=url[2];
               var tableid =$("#update_tablename :selected").val();
               y = 0
               $.ajax({
                url :"/column_list/",
                type : 'POST',
                async: false,
                data:{'projectid':projectid,'tableid':tableid},
                dataType : 'json',
                success : function(data) {
                $('#selectpicker1').empty();
                $('#selectpicker1').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                $('#selectpicker1').append('<option value="id">id</option>');
                $('#selectpicker1').append('<option value="status">status</option>');
                $('#selectpicker1').append('<option value="createdon">createdon</option>');
                $('#selectpicker1').append('<option value="createdby">createdby</option>');
                $('#selectpicker1').append('<option value="modifiedon">modifiedon</option>');
                $('#selectpicker1').append('<option value="modifiedby">modifiedby</option>');
                  $.each(data.get_columnname, function(idx2,kvalue) { 
                    $('#selectpicker1').append('<option value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
                    $("#columnquery").html(data.columnquery);
                  });
                  $('#aggregatefunctionsupdate').empty();
                  $('#aggregatefunctionsupdate').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
                  $.each(data.get_columnname, function(idx2,kvalue) {  
                    $('#aggregatefunctionsupdate').append('<option value="'+ aliasesname +'.'+kvalue.columnname+'">'+ aliasesname +'.'+kvalue.columnname+'</option>');
                  });
                }
            });
            $('#selectpicker1').selectpicker('refresh')
            $('#aggregatefunctionsupdate').selectpicker('refresh')   
            $("[id=wheredisplay],[id=wheredisplay1]").css("display", "none");
               var arr = {};         
                y=0
                var join_columns = []
                for(var i=0; i<=join_count; i++){
                  y++
                  var val_a = "a"+i+"."
                  var val_b = "a"+y+"."
                  var fromm = text.indexOf(" from");
                  var val_b_check = text.indexOf(val_b)
                  if(val_a == "a0."){
                    var val_a = "a."
                  }
                  var val_a_check =  text.indexOf(val_a)
                  if(val_b_check == -1){
                    join_columns.push(text.slice(val_a_check, fromm)+",")
                  }else{
                      join_columns.push(text.slice(val_a_check, val_b_check))
                    }
                      }
                var joincol_arr = []
                for(var i=0; i<=join_count; i++){
                  var joint_query = join_columns[i]
                  var val_a = "a"+i+"."
                  if(val_a == "a0."){
                    var val_a = "a."
                  }
                  var val_ai = "a"+i+"_"
                  if(val_ai == "a0_"){
                    var val_ai = "a_"
                  }
                  var joint_query_replace = joint_query.replaceAll(val_a,"").replaceAll(" as "," ").replaceAll(val_ai,"").replaceAll(" ",",")
                  value = Array.from(new Set(joint_query_replace.split(','))).toString();
                  var finalvalue = value.split(",");
                  finalvalue.pop()
                  joincol_arr.push(finalvalue)
                }
                var select_val = joincol_arr[0]
                for(var arr_cout = 0; arr_cout < select_val.length; arr_cout++){
                  $('#selectpicker1').find('option').not(':selected').each(function(k,v){
                    var sele_pick = select_val[arr_cout]
                  if(v.text == sele_pick){
                    $('#selectpicker1 option[value='+v.value+']').prop('selected', true)       
                    }
                  });
                  }
                $('#selectpicker1').selectpicker("refresh")  
                joinallquery = []
                y = 0
                var val = 0
                var Join_arr = []
                var removejoin_id = []
                var join_count1 = join_count - 1
                for(let count = 0; count < join_count1; count++){
                   val_count = count + 1
                   if (count == 0){
                    $('#selectquery1update').after('<span id="selectquery1update1"></span>');
                   }else{
                    $('#selectquery1update'+count+'').after('<span id="selectquery1update'+val_count+'"></span>');
                  }
                   $('.carousel-inner').append('<div class="carousel-item" id="carousel-item-main2"><div class="row form-btm-space"><div class="col-md-3"><label>{{ get_chache_jointypes }}</label><select name="element1" id="joinupdatetypes'+val_count+'" class="form-control" type="text"><option value="" selected disabled>{{ get_chache_selectjoins }}</option><option value="INNER JOIN">{{ get_chache_innerjoin }}</option><option value="LEFT JOIN">{{ get_chache_leftjoin }}</option><option value="RIGHT JOIN">{{ get_chache_rightjoin }}</option></select></div><div class="col-md-3"><label>{{ get_chache_jointable }}</label><select name="element1" id="joinupdatetables'+val_count+'" class="form-control" type="text"><option value=""selected disabled>{{ get_chache_selectjointableerror }}</option></select></div><div class="col-md-3" id="selectcolumn_alisename'+val_count+'"><label>Joincolumnname</label><select class="selectpicker" id="Joinupdatecolumnname'+val_count+'" name="columnid[]" multiple data-live-search="true" tabindex="-98"><option value="" disabled>{{ get_chache_selectcolumnerror }}</option></select></div><div id="column_alisename" style="display:none;"></div><div class="col-md-3"><label>{{ get_chache_joincondition }}</label><select name="element1" id="joinupdatecondition'+val_count+'" class="form-control" type="text"><option value="{{ get_chache_selectcondition }}" disabled selected>{{ get_chache_selectcondition }}</option><option value="ON" id ="joinupdateon'+val_count+'">{{ get_chache_on }}</option><option value="AND" id="joinupdateand'+val_count+'" style="display:none">{{ get_chache_and }}</option><option values="OR" id="joinupdateor'+val_count+'" style="display:none">{{ get_chache_or }}</option></select></div><div class="col-md-3"><label>{{ get_chache_joincols }}</label><select name="joinupdatecolumns'+val_count+'" id="joinupdatecolumns'+val_count+'" class="form-control" type="text"><option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option></select></div></div><div class="row form-btm form-btm-space" style="margin-top: -12px;"><div class="col-md-3"><label>{{ get_chache_conditionaloper }}</label><select name="element1" id="join_updatecheck_condition'+val_count+'" class="form-control" type="text"><option value="" selected disabled>{{ get_chache_selectcondition }}</option><option value="=">=</option><option value="IN">IN</option><option value="NOT IN">NOT IN</option><option value="<>"><></option><option value="!=">!=</option><option value=">">></option><option value=">=">>=</option><option value="<"><</option><option value="<="><=</option><option value="NOT">NOT</option><option value="BETWEEN">BETWEEN</option><option value="IS NULL">IS NULL</option><option value="IS NOT NULL">IS NOT NULL</option><option value="LIKE">LIKE</option><option value="EXISTS">EXISTS</option></select></div><div class="col-md-3" id ="from_table_show_updatedata'+val_count+'" style="display: none;"><label>{{ get_chache_joinfromtbl }}</label><select name="element11" id="joinfromupdatetablelist'+val_count+'" class="form-control" type="text"><option value="" selected disabled>{{ get_chache_selectjointableerror}}</option></select></div><div class="col-md-3" id ="from_column_show_updatedata'+val_count+'" style="display: none;"><label>{{ get_chache_joinfromcol }}</label><select name="element1" id="joinfromupdatecolumns'+val_count+'" class="form-control" type="text"></select></div><div class="col-md-3" id="from_updatejoincheck'+val_count+'" style="display: none;" ><input type="checkbox" id="joinupdatecheck'+val_count+'" name="joinupdatecheck" value="1"><label style="margin-top: 30px;">isparent textinput</label></div><div class="col-md-3" id ="joincolumnvalues_updatedata'+val_count+'" style="display: none;"><label>{{ get_chache_joincolvalues }}:</label><select class="selectpicker" id="joincolumnupdatevalues'+val_count+'" name="joincolumnupdatevalues'+val_count+'" multiple data-live-search="true"   required><option value="" disabled >{{ get_chache_selectcolumnerror }}</option></select></div><div class="col-md-3" id="joinupdatedynamic_checkbox'+val_count+'"><span><input type="checkbox" id="joinupdatedynamic'+val_count+'" name="joinupdatedynamic'+val_count+'" value="1"><label style="margin-top: 30px;">{{ get_chache_isparenttable }}</label><button class="btn join-btn" style="background-color:#99B0CE;" id="joincolumn_updatego'+val_count+'">Go</button></span><div id="outputupdate1'+val_count+'" style="display: none;"></div></div></div><div class="row join_complited_go'+val_count+'" style="margin-top: -10px;"><div class="col-md-3"><label for="exampleFormControlTextarea1" class="form-label">{{ get_chache_fromjointext }} </label><textarea name="element7" class="form-control input-lg" id="fromjoin_updateexecute'+val_count+'" rows="3"></textarea></div><div class="col-md-3" style="margin-top:70px;"><button class="btn join-btn" style="background-color:#99B0CE;" id="join_updatego'+val_count+'">{{ get_chache_go }}</button><div id="outputupdate'+val_count+'" style="display:none;"></div></div></div></div>')

                   var joinquery_set_check = $('#querysetupdate').find("#joincolumnquery1").html()
                   if(joinquery_set_check == undefined){
                    $('#querysetupdate').find("#joincolumnquery").after('<span id="joinqueryupdate'+val_count+'"></span><span id="joincolumnquery'+val_count+'"></span>');
                   }else{
                    var ii = val_count - 1
                    $('#querysetupdate').find("#joincolumnquery"+ii+"").after('<span id="joinqueryupdate'+val_count+'"></span><span id="joincolumnquery'+val_count+'"></span>');
                   } 
                   $('#Joinupdatecolumnname'+val_count).selectpicker("refresh") 
                }
                for(let i = 0; i < join_count; i++){
                  var value = 'hariharan'+i
                  removejoin_id.push(value)
                  var first_join = text.indexOf("JOIN", val+1)
                  var len_qury = first_join - 10
                  var valfirst_q = text.slice(len_qury, first_join+4)
                  var search_join_left = valfirst_q.search("LEFT JOIN")
                  var search_join_right = valfirst_q.search("RIGHT JOIN")
                  var search_join_inner = valfirst_q.search("INNER JOIN")
                if(search_join_left != -1){
                    var first_index = text.indexOf("LEFT JOIN", val)
                    var second_index = text.indexOf("JOIN", first_index+10)
                    var len_qury = second_index - 10
                    var valsecond_q = text.slice(len_qury, second_index+4)
                    if(second_index == -1){
                        var final_joint = text.slice(first_index, text.length)
                        Join_arr.push(final_joint)
                    }
                    var search_join_left1 = valsecond_q.search("LEFT JOIN")
                    var search_join_right1 = valsecond_q.search("RIGHT JOIN")
                    var search_join_inner1 = valsecond_q.search("INNER JOIN")
                    if(search_join_left1 != -1){
                        var indexofnext = text.indexOf("LEFT JOIN", len_qury)
                        var first_join1 = text.slice()
                        var second_join1 = text.slice(first_index, indexofnext-1)
                        Join_arr.push(second_join1)
                        var val = indexofnext-1
                    }
                    if(search_join_right1 != -1){
                        var indexofnext = text.indexOf("RIGHT JOIN", len_qury)
                        var first_join1 = text.slice()
                        var second_join1 = text.slice(first_index, indexofnext-1)
                        Join_arr.push(second_join1)
                        var val = indexofnext-1
                    }
                    if(search_join_inner1 != -1){
                        var indexofnext = text.indexOf("INNER JOIN", len_qury)
                        var first_join1 = text.slice()
                        var second_join1 = text.slice(first_index, indexofnext-1)
                        Join_arr.push(second_join1)
                        var val = indexofnext-1
                    }
                }
     
                if(search_join_right != -1){
                    var first_index = text.indexOf("RIGHT JOIN", val)
                    var second_index = text.indexOf("JOIN", first_index+10)
                    var len_qury = second_index - 10
                    var valsecond_q = text.slice(len_qury, second_index+4)
                    if(second_index == -1){
                        var final_joint = text.slice(first_index, text.length)
                        Join_arr.push(final_joint)
                      }
                    var search_join_left1 = valsecond_q.search("LEFT JOIN")
                    var search_join_right1 = valsecond_q.search("RIGHT JOIN")
                    var search_join_inner1 = valsecond_q.search("INNER JOIN")
                    if(search_join_left1 != -1){
                        var indexofnext = text.indexOf("LEFT .", len_qury)
                        var first_join1 = text.slice()
                        var second_join1 = text.slice(first_index, indexofnext-1)
                        Join_arr.push(second_join1)
                        var val = indexofnext-1
                      }
                    if(search_join_right1 != -1){
                        var indexofnext = text.indexOf("RIGHT JOIN", len_qury)
                        var first_join1 = text.slice()
                        var second_join1 = text.slice(first_index, indexofnext-1)
                        Join_arr.push(second_join1)
                        var val = indexofnext-1
                      }
                    if(search_join_inner1 != -1){
                        var indexofnext = text.indexOf("INNER JOIN", len_qury)
                        var first_join1 = text.slice()
                        var second_join1 = text.slice(first_index, indexofnext-1)
                        Join_arr.push(second_join1)
                        var val = indexofnext-1
                      }
                }
     
                if(search_join_inner != -1){
                    var first_index = text.indexOf("INNER JOIN", val)
                    var second_index = text.indexOf("JOIN", first_index+10)
                    var len_qury = second_index - 10
                    var valsecond_q = text.slice(len_qury, second_index+4)
                    if(second_index == -1){
                        var final_joint = text.slice(first_index, text.length)
                        Join_arr.push(final_joint)
                    }
                    var search_join_left1 = valsecond_q.search("LEFT JOIN")
                    var search_join_right1 = valsecond_q.search("RIGHT JOIN")
                    var search_join_inner1 = valsecond_q.search("INNER JOIN")
                    if(search_join_left1 != -1){
                        var indexofnext = text.indexOf("LEFT JOIN", len_qury)
                        var first_join1 = text.slice()
                        var second_join1 = text.slice(first_index, indexofnext-1)
                        Join_arr.push(second_join1)
                        var val = indexofnext-1
                    }
                    if(search_join_right1 != -1){
                        var indexofnext = text.indexOf("RIGHT JOIN", len_qury)
                        var first_join1 = text.slice()
                        var second_join1 = text.slice(first_index, indexofnext-1)
                        Join_arr.push(second_join1)
                        var val = indexofnext-1
                    }
                    if(search_join_inner1 != -1){
                        var indexofnext = text.indexOf("INNER JOIN", len_qury)
                        var first_join1 = text.slice()
                        var second_join1 = text.slice(first_index, indexofnext-1)
                        Join_arr.push(second_join1)
                        var val = indexofnext-1
                    }
                }
              }
    y = 0  
    for(var n = 0; n<Join_arr.length; n++){
      var find_join = Join_arr[n]
      var find_join_left = find_join.indexOf("LEFT JOIN");
      var find_join_right = find_join.indexOf("RIGHT JOIN");
      var find_join_inner = find_join.indexOf("INNER JOIN");
      y++
      if(n == 0){
        var n = ""
        $('.card-btm').parent().parentsUntil('section').find('.card-btm').append("<span id='dynamicjoin' style='list-style: none;display: inline-flex;'><h6 class='panel-title'>JOIN "+y+"</h6><label class='switch'><input type='checkbox' id ='samplecheckbox"+n+"' checked><span class='slider round'></span></label></span>")
      }else{
      $('.card-btm').parent().parentsUntil('section').find('.card-btm').append("<span id='dynamicjoin' style='list-style: none;display: inline-flex;'><h6 class='panel-title'>JOIN "+y+"</h6><label class='switch'><input type='checkbox' id ='samplecheckbox"+n+"' checked><span class='slider round'></span></label></span>")  
      }       
    }
    joinfunction_toggle()
    for(var countt1 = 0; countt1 < join_count; countt1++){
        if(countt1 > 0){
          joinfunction_toggle1(countt1);
        }    
    }
    for(var countt = 0; countt < join_count; countt++){
      if(countt == 0){
        var val = Join_arr[countt];
        var left_check = val.search("LEFT JOIN")
        var right_check = val.search("RIGHT JOIN")
        var inner_check = val.search("INNER JOIN")
        if(left_check != -1){
          $('#joinupdatetypes option[value ="LEFT JOIN"]').prop('selected', true); 
        }
        if(right_check != -1){
          $('#joinupdatetypes option[value ="RIGHT JOIN"]').prop('selected', true); 
        }
        if(inner_check != -1){
          $('#joinupdatetypes option[value ="INNER JOIN"]').prop('selected', true); 
        }
        var val_count = countt + 1
        var joincol_nameval = joincol_arr[val_count]
        var split_a = val.split("ON ")
        var join_split_a = val.split("JOIN ")
        var join_split_a2 = join_split_a[1].split(" as ")
        var join_name = join_split_a2[0]
        var split_b = "a"+val_count+" ON "
        var joincol_split = join_split_a2[1].split(split_b);
        var joincol_splait_val = joincol_split[1]
        var joincoli_split_2 = joincol_splait_val.replaceAll("a"+val_count+".","").replaceAll("a.","");
        var join_ids = joincoli_split_2.split(" ");
        var join_condition = join_ids[1];
        var join_col1 = join_ids[0];
        var join_col2  = join_ids[2];
        var on_find = val.search(" ON")
        var on_val = val.slice(on_find, val.length)
        const result3 = {};
        const count3 = on_val.split(' ');
          for(let word of count3) {
              if(result3[word]) {         
                result3[word]++;
              } else {
               
                result3[word] = 1;
              }
                  }
        var check_id2_and = result3["AND"]
        var check_id2_or = result3["OR"]
        $('#fromjoin_updateexecute').val(on_val);        
        var val = 0
        if(check_id2_and != undefined){
          var last_and = on_val.lastIndexOf("AND")
          var val_ll = on_val.slice(last_and, on_val.length).replaceAll("a1.", "").replaceAll("NOT IN", "=").replaceAll("IS NULL", "=").replaceAll("IS NOT NULL", "=")
          var split_and2 = val_ll.split(" ")
          var joincon = split_and2[0]
          var join_col1 = split_and2[1]
          var join_condition = split_and2[2]
          var join_col2 = split_and2[3]
          $('#join_updatecheck_condition option[value ='+JSON.stringify(join_condition)+']').prop('selected', true); 
          $('#joinupdatecondition option[value ='+JSON.stringify(joincon)+']').prop('selected', true); 
          var join_con_not_it = val_ll.search("NOT IN")
          var join_con_is_null = val_ll.search("IS NULL")
          var join_con_is_not_null = val_ll.search("IS NOT NULL")
          if(join_con_not_it != -1){
            $('#join_updatecheck_condition option[value ="NOT IN"]').prop('selected', true); 
          }
          if(join_con_is_null != -1){
            $('#join_updatecheck_condition option[value ="IS NULL"]').prop('selected', true); 
          }
          if(join_con_is_not_null != -1){
            $('#join_updatecheck_condition option[value ="IS NOT NULL"]').prop('selected', true); 
          }
        }
        var val = 0
        if(check_id2_or != undefined){
          var last_and = on_val.lastIndexOf("OR")
          var val_ll = on_val.slice(last_and, on_val.length).replaceAll("a1.", "").replaceAll("NOT IN", "=").replaceAll("IS NULL", "=").replaceAll("IS NOT NULL", "=")
          var split_and2 = val_ll.split(" ")
          var joincon = split_and2[0]
          var join_col1 = split_and2[1]
          var join_condition = split_and2[2]
          var join_col2 = split_and2[3]
          $('#join_updatecheck_condition option[value ='+JSON.stringify(join_condition)+']').prop('selected', true); 
          $('#joinupdatecondition option[value ='+JSON.stringify(joincon)+']').prop('selected', true); 
          var join_con_not_it = val_ll.search("NOT IN")
          var join_con_is_null = val_ll.search("IS NULL")
          var join_con_is_not_null = val_ll.search("IS NOT NULL")
          if(join_con_not_it != -1){
            $('#join_updatecheck_condition option[value ="NOT IN"]').prop('selected', true); 
          }
          if(join_con_is_null != -1){
            $('#join_updatecheck_condition option[value ="IS NULL"]').prop('selected', true); 
          }
          if(join_con_is_not_null != -1){
            $('#join_updatecheck_condition option[value ="IS NOT NULL"]').prop('selected', true); 
          }
        }
        
        if(check_id2_and == undefined && check_id2_or == undefined){
          $('#joinupdatecondition option[value ="ON"]').prop('selected', true);
          $('#join_updatecheck_condition option[value ='+JSON.stringify(join_condition)+']').prop('selected', true); 
          var check_id2 = JSON.stringify(join_col2)
          var check_id2cast = join_col2.split("cast(")
          if(check_id2cast.length > 1){
            var splitval = check_id2cast[1]
            var finalsplit = splitval.split(" ")
            var join_col2 = finalsplit[0]
          }
        }
        var columnvalues = Number.isInteger(Number(join_col2))
        var boolean = columnvalues
        var projectid = $('#projectid').val();
        var urllist = window.location.pathname;
        var url=urllist.split('/');
        var projectid=url[2];
        var tableid =$("#update_tablename :selected").val();
        var valueid = value22       
        var pagename =$('#pagename').val();
        var array = pagename.split(",");
        var pageid =(array[2]);  

        $.ajax({
              type : 'POST',
              url :"/ajax_tanlename/",
              async: false,
              data:{'projectid':projectid,'pageid':pageid},
              success : function(data) {
                $('#joinupdatetables').empty();
                $('#joinupdatetables').append('<option value=""selected disabled>{{ get_chache_selectjointableerror }}</option>');
                $.each(data.tablename, function(idx2,kvalue){ 
                  $('#joinupdatetables').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');
                });
          $('#joinupdatetables').find('option').not(':selected').each(function(k,v){
                    if(v.text == join_name){      
                      var join_colval = JSON.stringify(v.value)
                      $('#joinupdatetables option[value='+join_colval+']').prop('selected', true)       
                    }
                  });
              var get_aliasesname=$("#joinupdatetables :selected").data("aliases");
              $('#outputupdate1').html(function(i, val) { return val*1+1 });
              get_randomnum =$("#outputupdate1").html();
              var aliasesname_colval = get_aliasesname
              var tableidd = $("#joinupdatetables :selected").val();
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var id1 = join_col1
              $.ajax({
                url :"/column_list/",
                type : 'POST',
                async: false,
                data:{'projectid':projectid,'tableid':tableidd},
                dataType : 'json',
                success : function(data) {
                  $.each(data.get_columnname, function(idx2,kvalue) {   
                    $('#aggregatefunctionsupdate').append('<option value="'+aliasesname_colval+'.'+kvalue.columnname+'">'+aliasesname_colval+'.'+kvalue.columnname+'</option>');
                  }); 
                }
              }); 
              $('#aggregatefunctionsupdate').selectpicker('refresh')          
              var boolean_val = boolean           
              var tableid1 = $("#joinupdatetables :selected").val();
              var tablename = $("#joinupdatetables :selected").text();
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
            
              $.ajax({
                  url :"/column_list/",
                  type : 'POST',
                  async: false,
                  data:{'projectid':projectid,'tableid':tableid1},
                  dataType : 'json',
                  success : function(data) {                         
                    $('#joinupdatecolumns').empty();
                    $('#joinupdatecolumns').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>');
                    $('#joinupdatecolumns').append('<option data-datatype="serial" value="id">id</option>');
                    $('#joinupdatecolumns').append('<option data-datatype="int4" value="status">status</option>');
                    $('#joinupdatecolumns').append('<option value="createdon">createdon</option>');
                    $('#joinupdatecolumns').append('<option value="createdby">createdby</option>');
                    $('#joinupdatecolumns').append('<option value="modifiedon">modifiedon</option>');
                    $('#joinupdatecolumns').append('<option value="modifiedby">modifiedby</option>');  
                  $.each(data.get_columnname, function(idx2,kvalue){   
                    $('#joinupdatecolumns').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
                  });             
                  $('#joinupdatecolumns').find('option').not(':selected').each(function(k,v){
                       if(v.text == id1){
                        $('#joinupdatecolumns option[value='+v.value+']').prop('selected', true)       
                      }
                    });
                    $('#Joinupdatecolumnname').empty();
                    $('#Joinupdatecolumnname').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                    $('#Joinupdatecolumnname').append('<option value="id">id</option>');
                    $('#Joinupdatecolumnname').append('<option value="status">status</option>');       
                    $('#Joinupdatecolumnname').append('<option value="createdon">createdon</option>');
                    $('#Joinupdatecolumnname').append('<option value="createdby">createdby</option>');
                    $('#Joinupdatecolumnname').append('<option value="modifiedon">modifiedon</option>');
                    $('#Joinupdatecolumnname').append('<option value="modifiedby">modifiedby</option>');  
                  $.each(data.get_columnname, function(idx2,kvalue){
                    $('#Joinupdatecolumnname').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
                  });                   
                  for (var i = 0; i < joincol_nameval.length; i++){        
                    $('#Joinupdatecolumnname').find('option').not(':selected').each(function(k,v){
                        if(joincol_nameval[i]==v.text){
                          $('#Joinupdatecolumnname option[value='+v.value+']').prop('selected', true)       
                        }
                      });
                  }
                    }
                  });  
                $('#Joinupdatecolumnname').selectpicker('refresh')
                if (boolean_val == true){
                var colum_values = join_col2
                $('[id=from_column_show_updatedata] [id=from_table_show_updatedata]').hide();
                $('#from_updatejoincheck').css("display","block");
                $('#joinupdatecheck').prop('selected', true); 
                $('#joinupdatedynamic').prop('checked', false);
                $('#joincolumnvalues_updatedata').show();
                $('#joinfromupdatetablelist option[value=""]').prop('selected', true); 
                $('#joinfromupdatecolumns').empty();
                $('#joinupdatecheck').prop('checked', true);
                $("#from_table_show_updatedata").hide();
                $("#from_column_show_updatedata").hide();
                $('#joinupdatedynamic').trigger("click");
                $('#joinupdatedynamic').trigger("click");

                var tableid = $("#joinupdatetables :selected").text();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                var column_id = $("#joinupdatecolumns :selected").text();
                
                $.ajax({
                  type:'POST',
                  url:"/join_columnvalues/",
                  async:false,
                  data:{'projectid':projectid,'tableid':tableid,'column_id':column_id},
                  datatype:'json',
                  success : function(data) {
                    if(column_id =='status'){
                      $('#joincolumnupdatevalues').empty();
                      $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                      $.each(data.status_values, function(idx21,value){ 
                        $('#joincolumnupdatevalues').append('<option value="'+value+'">'+value+'</option>');
                      });                    
                    }else{
                      $('#joincolumnupdatevalues').empty();
                      $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                      $.each(data.column_values, function(idx2,kvalue){ 
                        $.each(kvalue, function(idx21,kvalue1){ 
                          $('#joincolumnupdatevalues').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
                        });
                      });
                        }
                      column_val = JSON.stringify(colum_values)
                      $('#joincolumnupdatevalues option[value='+column_val+']').prop('selected', true);
                      $('#joincolumnupdatevalues').selectpicker('refresh');      
                      }
                    });
               
              }else{
                $('#joincolumnupdatevalues').empty();
                $('#joinupdatedynamic').prop('checked', true);
                $('#joincolumnvalues_updatedata').hide();
                $('#joincolumnupdatevalues').selectpicker('refresh')  
                $('#joinupdatecheck').prop('checked', false);
                $('#from_column_show_updatedata').show();
                $("#from_table_show_updatedata").show();
                $('#joinupdatecondition option[value="ON"]').prop('selected', true);
                var tableid =$("#update_tablename").val();
                var projectid = $('#projectid').val();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                tableidd = tableid
                $.ajax({
                      type : 'POST',
                      url :"/ajaxwhere_tablelist/",
                      async: false,
                      data:{'projectid':projectid,'tableid':tableidd},
                      dataType : 'json',
                      success : function(data) {
                        $('#joinfromupdatetablelist').empty();
                        $('#joinfromupdatetablelist').append('<option value="" disabled>{{ get_chache_selectjointableerror}}</option>');
                        $.each(data.table_data, function(idx2,kvalue){ 
                          $('#joinfromupdatetablelist').append('<option value="'+kvalue.id+'" data-aliases ="a1" selected>'+kvalue.tablename+'</option>');
                        });
                        
                      }
                    });  
                var tableid = $("#joinfromupdatetablelist").val();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                $.ajax({
                    url :"/column_list/",
                    type : 'POST',
                    async: false,
                    data:{'projectid':projectid,'tableid':tableid},
                    dataType : 'json',
                    success : function(data){
                      $('#joinfromupdatecolumns').empty();
                      $('#joinfromupdatecolumns').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                      $('#joinfromupdatecolumns').append('<option value="id">id</option>');
                      $('#joinfromupdatecolumns').append('<option value="status">status</option>');
                      $('#joinfromupdatecolumns').append('<option value="createdon">createdon</option>');
                      $('#joinfromupdatecolumns').append('<option value="createdby">createdby</option>');
                      $('#joinfromupdatecolumns').append('<option value="modifiedon">modifiedon</option>');
                      $('#joinfromupdatecolumns').append('<option value="modifiedby">modifiedby</option>');  
                      
                      $.each(data.get_columnname, function(idx2,kvalue) { 
                        $('#joinfromupdatecolumns').append('<option value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
                      });   
                      var joinfromupdatetablelist = JSON.stringify(join_col2) 
                      $('#joinfromupdatecolumns option[value='+joinfromupdatetablelist+']').prop('selected', true)    
                    }
                  }); 
                  $('#joincolumnvalues_updatedata').hide();
                }       
              }
          });
      }else{
        var val_count = countt + 1
        var val = Join_arr[countt];
        var wherecon = val.search(" WHERE")
        var groupby = val.search("GROUP BY")
        if(wherecon != -1 ){
          var val1 = val.slice(wherecon, val.length)
          var val = val.replaceAll(val1, "")
        }
        if(groupby != -1 && where_con == -1){
          var val1 = val.slice(groupby, val.length)
          var val = val.replaceAll(val1, "")
        }
        var val_count = countt + 1
        var left_check = val.search("LEFT JOIN")
        var right_check = val.search("RIGHT JOIN")
        var inner_check = val.search("INNER JOIN")
        var joincol_nameval = joincol_arr[val_count]
        
        if(left_check != -1){
          $('#joinupdatetypes'+countt+' option[value ="LEFT JOIN"]').prop('selected', true); 
        }
        if(right_check != -1){
          $('#joinupdatetypes'+countt+' option[value ="RIGHT JOIN"]').prop('selected', true); 
        }
        if(inner_check != -1){
          $('#joinupdatetypes'+countt+' option[value ="INNER JOIN"]').prop('selected', true); 
        }
    


        var split_a = val.split("ON ")
        var join_split_a = val.split("JOIN ")
        var join_split_a2 = join_split_a[1].split(" as ")
        var join_name = join_split_a2[0]
        var split_b = "a"+val_count+" ON "
        var joincol_split = join_split_a2[1].split(split_b);
        var joincol_splait_val = joincol_split[1]
        var joincoli_split_2 = joincol_splait_val.replaceAll("a"+val_count+".","").replaceAll("a.","");
        var join_ids = joincoli_split_2.split(" ");
        var join_condition = join_ids[1];
        var join_col1 = join_ids[0];
        var join_col2  = join_ids[2];
        var on_find = val.search(" ON")
        var on_val = val.slice(on_find, val.length)
        const result4 = {};
        const count4 = on_val.split(' ');
          for(let word of count4) {
              if(result4[word]) {         
                result4[word]++;
              } else {
               
                result4[word] = 1;
              }
                  }         
        var on_val_where = on_val.search(" WHERE ")
        var on_val_groupby = on_val.search("GROUP BY")
        if (on_val_where != -1){
          var splitfromjoint21 = on_val.split(" WHERE ")
          var splitfromjointt = splitfromjoint21[0]
          var finalval = splitfromjointt.replaceAll("  "," ")
          $("#fromjoin_updateexecute"+countt+"").val(finalval);
        }else{
          if(on_val_groupby != -1){
            var finalvall = on_val.split("GROUP BY")
            var finalval1 = finalvall[0]
            $("#fromjoin_updateexecute"+countt+"").val(finalval1);
          }else{
            $("#fromjoin_updateexecute"+countt+"").val(on_val);
            }
        }
       
        var check_id2_and = result4["AND"]
        var check_id2_or = result4["OR"]
        var val = 0
        if(check_id2_and != undefined){
          var last_and = on_val.lastIndexOf("AND")
          var val_ll = on_val.slice(last_and, on_val.length).replaceAll("a"+val_count+".", "").replaceAll("NOT IN", "=").replaceAll("IS NULL", "=").replaceAll("IS NOT NULL", "=")
          var split_and2 = val_ll.split(" ")
          var joincon = split_and2[0]
          var join_col1 = split_and2[1]
          var join_condition = split_and2[2]
          var join_col2 = split_and2[3]
          $('#join_updatecheck_condition'+countt+' option[value ='+JSON.stringify(join_condition)+']').prop('selected', true); 
          $('#joinupdatecondition'+countt+' option[value ='+JSON.stringify(joincon)+']').prop('selected', true); 
          var join_con_not_it = val_ll.search("NOT IN")
          var join_con_is_null = val_ll.search("IS NULL")
          var join_con_is_not_null = val_ll.search("IS NOT NULL")
          if(join_con_not_it != -1){
            $('#join_updatecheck_condition'+countt+' option[value ="NOT IN"]').prop('selected', true); 
          }
          if(join_con_is_null != -1){
            $('#join_updatecheck_condition'+countt+' option[value ="IS NULL"]').prop('selected', true); 
          }
          if(join_con_is_not_null != -1){
            $('#join_updatecheck_condition'+countt+' option[value ="IS NOT NULL"]').prop('selected', true); 
          }
        }
        var val = 0
        if(check_id2_or != undefined){
          var last_and = on_val.lastIndexOf("OR")
          var val_ll = on_val.slice(last_and, on_val.length).replaceAll("a"+val_count+".", "").replaceAll("NOT IN", "=").replaceAll("IS NULL", "=").replaceAll("IS NOT NULL", "=")
          var split_and2 = val_ll.split(" ")
          var joincon = split_and2[0]
          var join_col1 = split_and2[1]
          var join_condition = split_and2[2]
          var join_col2 = split_and2[3]
          $('#join_updatecheck_condition'+countt+' option[value ='+JSON.stringify(join_condition)+']').prop('selected', true); 
          $('#joinupdatecondition'+countt+' option[value ='+JSON.stringify(joincon)+']').prop('selected', true); 
          var join_con_not_it = val_ll.search("NOT IN")
          var join_con_is_null = val_ll.search("IS NULL")
          var join_con_is_not_null = val_ll.search("IS NOT NULL")
          if(join_con_not_it != -1){
            $('#join_updatecheck_condition'+countt+' option[value ="NOT IN"]').prop('selected', true); 
          }
          if(join_con_is_null != -1){
            $('#join_updatecheck_condition'+countt+' option[value ="IS NULL"]').prop('selected', true); 
          }
          if(join_con_is_not_null != -1){
            $('#join_updatecheck_condition'+countt+' option[value ="IS NOT NULL"]').prop('selected', true); 
          }
        }
        if(check_id2_and == undefined && check_id2_or == undefined){
          $('#join_updatecheck_condition'+countt+' option[value ='+JSON.stringify(join_condition)+']').prop('selected', true); 
          $('#joinupdatecondition'+countt+' option[value ="ON"]').prop('selected', true);
          var check_id2 = JSON.stringify(join_col2)
          var check_id2cast = join_col2.split("cast(")
          if(check_id2cast.length > 1){
            var splitval = check_id2cast[1]
            var finalsplit = splitval.split(" ")
            var join_col2 = finalsplit[0]
          }
        }
        var columnvalues = Number.isInteger(Number(join_col2))
        var boolean = columnvalues
        var join_colname = JSON.stringify(join_name)
        var projectid = $('#projectid').val();
        var urllist = window.location.pathname;
        var url=urllist.split('/');
        var projectid=url[2];
        var tableid =$("#update_tablename :selected").val();   
        var pagename =$('#pagename').val();
        var array = pagename.split(",");
        var pageid =(array[2]);  
   
        $.ajax({
              type : 'POST',
              url :"/ajax_tanlename/",
              async: false,
              data:{'projectid':projectid,'pageid':pageid},
              success : function(data) {
                $('#joinupdatetables'+countt+'').empty();
                $('#joinupdatetables'+countt+'').append('<option value=""selected disabled>{{ get_chache_selectjointableerror }}</option>');
                $.each(data.tablename, function(idx2,kvalue){ 
                  $('#joinupdatetables'+countt+'').append('<option value="'+kvalue.id+'" data-aliases ="a'+val_count+'">'+kvalue.tablename+'</option>');
                });
          $('#joinupdatetables'+countt+'').find('option').not(':selected').each(function(k,v){
                    if(v.text == join_name){
                      var join_colval = JSON.stringify(v.value)
                      $('#joinupdatetables'+countt+' option[value='+join_colval+']').prop('selected', true)       
                    }
                  });
        var get_aliasesname=$("#joinupdatetables"+countt+" :selected").data("aliases");
        $('#outputupdate1'+countt+'').html(function(i, val) { return val*1+1 });
        get_randomnum =$("#outputupdate1"+countt+"").html();
        var aliasesname_colval = get_aliasesname
        var tableidd = $("#joinupdatetables"+countt+" :selected").val();
        var urllist = window.location.pathname;
        var url=urllist.split('/');
        var projectid=url[2];
        $.ajax({
          url :"/column_list/",
          type : 'POST',
          async: false,
          data:{'projectid':projectid,'tableid':tableidd},
          dataType : 'json',
          success : function(data){
            $.each(data.get_columnname, function(idx2,kvalue){   
              $('#aggregatefunctionsupdate').append('<option value="'+aliasesname_colval+'.'+kvalue.columnname+'">'+aliasesname_colval+'.'+kvalue.columnname+'</option>');
            }); 
          }
        }); 
        $('#aggregatefunctionsupdate').selectpicker('refresh')          
        var boolean_val = boolean          
        var tableid1 = $("#joinupdatetables"+countt+" :selected").val();
        var tablename = $("#joinupdatetables"+countt+" :selected").text();
        var urllist = window.location.pathname;
        var url=urllist.split('/');
        var projectid=url[2];
        var id1 = join_col1;
        $.ajax({
              url :"/column_list/",
              type : 'POST',
              async: false,
              data:{'projectid':projectid,'tableid':tableid1},
              dataType : 'json',
              success : function(data) {                         
                $('#joinupdatecolumns'+countt+'').empty();
                $('#joinupdatecolumns'+countt+'').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>');
                $('#joinupdatecolumns'+countt+'').append('<option data-datatype="serial" value="id">id</option>');
                $('#joinupdatecolumns'+countt+'').append('<option data-datatype="int4" value="status">status</option>');       
                $('#joinupdatecolumns'+countt+'').append('<option value="createdon">createdon</option>');
                $('#joinupdatecolumns'+countt+'').append('<option value="createdby">createdby</option>');
                $('#joinupdatecolumns'+countt+'').append('<option value="modifiedon">modifiedon</option>');
                $('#joinupdatecolumns'+countt+'').append('<option value="modifiedby">modifiedby</option>'); 
              $.each(data.get_columnname, function(idx2,kvalue){   
                $('#joinupdatecolumns'+countt+'').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
              });             
              $('#joinupdatecolumns'+countt+'').find('option').not(':selected').each(function(k,v){
                       if(v.text == id1){
                        $('#joinupdatecolumns'+countt+' option[value='+v.value+']').prop('selected', true)       
                      }
                    });
                    $('#Joinupdatecolumnname'+countt+'').empty();
                    $('#Joinupdatecolumnname'+countt+'').append('<option value="id">id</option>');
                    $('#Joinupdatecolumnname'+countt+'').append('<option value="status">status</option>');       
                    $('#Joinupdatecolumnname'+countt+'').append('<option value="createdon">createdon</option>');
                    $('#Joinupdatecolumnname'+countt+'').append('<option value="createdby">createdby</option>');
                    $('#Joinupdatecolumnname'+countt+'').append('<option value="modifiedon">modifiedon</option>');
                    $('#Joinupdatecolumnname'+countt+'').append('<option value="modifiedby">modifiedby</option>');  
              $.each(data.get_columnname, function(idx2,kvalue){
                $('#Joinupdatecolumnname'+countt+'').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
              });                   
              for (var i = 0; i < joincol_nameval.length; i++){        
                  $('#Joinupdatecolumnname'+countt+'').find('option').not(':selected').each(function(k,v){
                      if(joincol_nameval[i]==v.text){
                        $('#Joinupdatecolumnname'+countt+' option[value='+v.value+']').prop('selected', true)       
                      }
                    });
                  }
                }
              });  
            $('#Joinupdatecolumnname'+countt+'').selectpicker('refresh')
              if (boolean_val == true){
              var colum_values = join_col2
              $('[id=from_column_show_updatedata'+countt+'] [id=from_table_show_updatedata]').hide();
              $('#from_updatejoincheck'+countt+'').css("display","block")
              $('#joinupdatecheck'+countt+'').prop('selected', true) 
              $('#joinupdatedynamic').prop('checked', false);
              $('#joincolumnvalues_updatedata'+countt+'').show();
              $('#joinfromupdatetablelist'+countt+' option[value=""]').prop('selected', true) 
              $('#joinfromupdatecolumns'+countt+'').empty()
              $('#joinupdatecheck'+countt+'').prop('checked', true);
              $("#from_table_show_updatedata"+countt+"").hide();
              $("#from_column_show_updatedata"+countt+"").hide();
              $('#joinupdatedynamic'+countt+'').trigger( "click" );
              $('#joinupdatedynamic'+countt+'').trigger( "click" );
              
              var tableid = $("#joinupdatetables"+countt+" :selected").text();
              var urllist = window.location.pathname;
              var url=urllist.split('/');
              var projectid=url[2];
              var column_id = $("#joinupdatecolumns"+countt+" :selected").text();
              
              $.ajax({
                type:'POST',
                url:"/join_columnvalues/",
                async:false,
                data:{'projectid':projectid,'tableid':tableid,'column_id':column_id},
                datatype:'json',
                success : function(data) {
                  if(column_id =='status'){
                    $('#joincolumnupdatevalues'+countt+'').empty();
                    $('#joincolumnupdatevalues'+countt+'').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                    $.each(data.status_values, function(idx21,value){ 
                      $('#joincolumnupdatevalues'+countt+'').append('<option value="'+value+'">'+value+'</option>');
                    });                    
                  }else{
                    $('#joincolumnupdatevalues'+countt+'').empty();
                    $('#joincolumnupdatevalues'+countt+'').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                    $.each(data.column_values, function(idx2,kvalue){ 
                      $.each(kvalue, function(idx21,kvalue1){ 
                        $('#joincolumnupdatevalues'+countt+'').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
                      });
                    });
                      }
                    column_val = JSON.stringify(colum_values.replace(" ",""))
                    $('#joincolumnupdatevalues'+countt+' option[value='+column_val+']').prop('selected', true);
                    $('#joincolumnupdatevalues'+countt+'').selectpicker('refresh');      
                    }
                  });
            }else{
                var tableid =$("#update_tablename").val();
                $('#joincolumnupdatevalues'+countt+'').empty();
                $('#joincolumnupdatevalues'+countt+'').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
                $('#joinupdatedynamic'+countt+'').prop('checked', true);
                $('#joincolumnvalues_updatedata'+countt+'').hide();
                $('#joincolumnupdatevalues'+countt+'').selectpicker('refresh')  
                $('#joinupdatecheck'+countt+'').prop('checked', false);
                $('#from_column_show_updatedata'+countt+'').show();
                $("#from_table_show_updatedata"+countt+"").show();
                var projectid = $('#projectid').val();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                tableidd1 = tableid
                $.ajax({
                  type : 'POST',
                  url :"/ajaxwhere_tablelist/",
                  async: false,
                  data:{'projectid':projectid,'tableid':tableidd1},
                  dataType : 'json',
                  success : function(data) {
                    $('#joinfromupdatetablelist'+countt+'').empty();
                    $('#joinfromupdatetablelist'+countt+'').append('<option value="" disabled>{{ get_chache_selectjointableerror}}</option>');
                    $.each(data.table_data, function(idx2,kvalue){ 
                      $('#joinfromupdatetablelist'+countt+'').append('<option value="'+kvalue.id+'" data-aliases ="a'+val_count+'" selected>'+kvalue.tablename+'</option>');
                    });              
                  }
                    });  
                var tableid = $("#joinfromupdatetablelist"+countt+"").val();
                var urllist = window.location.pathname;
                var url=urllist.split('/');
                var projectid=url[2];
                $.ajax({
                    url :"/column_list/",
                    type : 'POST',
                    async: false,
                    data:{'projectid':projectid,'tableid':tableid},
                    dataType : 'json',
                    success : function(data){
                      $('#joinfromupdatecolumns'+countt+'').empty();
                      $('#joinfromupdatecolumns'+countt+'').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
                      $('#joinfromupdatecolumns'+countt+'').append('<option value="id">id</option>');
                      $('#joinfromupdatecolumns'+countt+'').append('<option value="status">status</option>')
                      $('#joinfromupdatecolumns'+countt+'').append('<option value="createdon">createdon</option>');
                      $('#joinfromupdatecolumns'+countt+'').append('<option value="createdby">createdby</option>');
                      $('#joinfromupdatecolumns'+countt+'').append('<option value="modifiedon">modifiedon</option>');
                      $('#joinfromupdatecolumns'+countt+'').append('<option value="modifiedby">modifiedby</option>');  
                      
                      $.each(data.get_columnname, function(idx2,kvalue){ 
                        $('#joinfromupdatecolumns'+countt+'').append('<option value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
                      });      
                      var joinfromupdatetablelist = JSON.stringify(join_col2)
                      $('#joinfromupdatecolumns'+countt+' option[value='+joinfromupdatetablelist+']').prop('selected', true)    
                    }
                  }); 
                  $('#joincolumnvalues_updatedata'+countt+'').hide();
                }       
              }
            });
          }
        }  
    
    
    var splitfromjoint = $('#querycontent_data').val(); //fromjoin_updateexecute
    var splitfromjoint1 = splitfromjoint.split("ON ");
    var splitfromjoint2 = "ON "+splitfromjoint1[1];
    if (wherecon != -1){
      wherecondition()
    }else{
      if(groupby != -1){
        var finalvall = splitfromjoint2.split("GROUP BY")
        var finalval = finalvall[0]
      }else{
        var finalval = splitfromjoint2.replaceAll("  "," ")
      }
    }    
    joinupdateclickfunction(join_count)  
    if(groupby != -1){
      for(var i = 0; i <= join_count; i++){
          if(i == 0){
            $("#selectpicker1").trigger("change"); 
            $("#Joinupdatecolumnname").trigger("change");
          }else{
            $("#Joinupdatecolumnname"+i+"").trigger("change");
          }
        }
      var split_grp = text.split("GROUP BY ")
      var split_grp_2 = split_grp[1]
      value = Array.from(new Set(split_grp_2.split(','))).toString();
      var tablecol1 = value.split(",");     
      for(i=0; i < tablecol1.length; i++){
        $('#groupby_updatecolumnlist option[value="'+tablecol1[i]+'"]').prop('selected', true)
        $('#groupby_updatecolumnlist').selectpicker('refresh')
      }         
      $("#groupby_updatecolumnlist").trigger("change");
    }else{
      $("#groupby_updatehideshow").hide()
      for(var i = 0; i <= join_count; i++){
        if(i == 0){
          $("#selectpicker1").trigger("change"); 
          $("#Joinupdatecolumnname").trigger("change");
        }else{
          $("#Joinupdatecolumnname"+i+"").trigger("change");
        }
      } 
    };
    if(asteric_check != "No"){
        $('#selectpicker1 option').prop('selected', true);
        $( "#selectpicker1 option:first-child" ).prop('selected', false);
        $('#selectpicker1').selectpicker('refresh')
        $('#selectqueryupdate').html(selectqueryvaluid)
        $('#selectquery2update').html("")
        $('#groupby_updatehideshow').hide();
      }   
    for(var countt1 = 0; countt1 < join_count; countt1++){
        if(countt1 == 0){
          $('#joinupdateand').show();
          $('#joinupdateor').show();
          $('#joinupdateand').removeAttr('disabled');
          $('#joinupdateor').removeAttr('disabled');
          $('#joinupdateon').prop('disabled', 'disabled');
        }else{
          $('#joinupdateand'+countt1+'').show();
          $('#joinupdateor'+countt1+'').show();
          $('#joinupdateand'+countt1+'').removeAttr('disabled');
          $('#joinupdateor'+countt1+'').removeAttr('disabled');
          $('#joinupdateon'+countt1+'').prop('disabled', 'disabled');
        }    
    }
    if(asteric_check != "No"){
        var find_left = Join_arr[0].search("LEFT JOIN")
        var find_right = Join_arr[0].search("RIGHT JOIN")
        var find_inner = Join_arr[0].search("INNER JOIN")
        if(find_left != -1){
          var get_index = text.indexOf("LEFT") - 2
          var slice_data = text.slice(0, get_index)
          $('#selectqueryupdate').html(slice_data) 
        }
        if(find_right != -1){
          var get_index = text.indexOf("RIGHT") - 2
          var slice_data = text.slice(0, get_index)
          $('#selectqueryupdate').html(slice_data)
        }
        if(find_inner != -1){
          var get_index = text.indexOf("INNER") - 2
          var slice_data = text.slice(0, get_index)
          $('#selectqueryupdate').html(slice_data)
        }
      var q = $('#querysetupdate').text();
      var ans1 = $.trim(q.replace(/\s/g, ' '))
      var ans = ans1.replace(/ +/g, " ")
      $('#querycontent_data').val(ans); 

    }
  }

//######################IF CONDITION IN JOIN ENDS HERE##########################
// +++++++++++++CONDITIONAL OPERTATORS+++++++++++++++++++++ 
                }
            });
                }
              }
            });
            $.ajax({
                type : 'POST',
                url :"/ajax_tanlename/",
                data:{'projectid':projectid,'pageid':pageid},
                success : function(data) {
                  $('#update_tablename').empty();
                  $('#update_tablename').append('<option value="" disabled>{{ get_chache_selecttableerrormsg }}</option>');
                  $.each(data.tablename, function(idx2,kvalue){ 
                      $('#update_tablename').append('<option value="'+kvalue.id+'" data-aliases ="a">'+kvalue.tablename+'</option>');
                  });
                }
            });
  
  
 
  var notSelected = $("#update_tablename").find('option').not(':selected');
  var array = notSelected.map(function () {
      return this.value;
  }).get();
  value = [];
  
}
function joinupdateclickfunction(join_count){
  for(var countt12 = 0; countt12 < join_count; countt12++){
      $("#join_updatego").triggerHandler("click") 
      if(countt12 > 0){
        $("#join_updatego"+countt12+"").triggerHandler("click")
      }
    }
}
//#####################################Manage~query~join~table##############################
function getupdateval(){
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    var tableid =$("#update_tablename :selected").val();
    var aliasesname=$("#update_tablename :selected").data("aliases");

      $.ajax({
    type : 'POST',
    url :"/ajax_option/",
    async: false,
    data:{'projectid':projectid,'tableid':tableid,'string':1,'aliasesname':aliasesname},
    dataType : 'json',
    success : function(res){
        $("#selectqueryupdate").html(res.query);
        $("#joinsection").show();
      }
    });
    var pagename =$('#pagename').val();
    var array = pagename.split(",");
    var pageid =(array[2]); 
    var tableid =$("#update_tablename :selected").val();
    $.ajax({
        type : 'POST',
        url :"/ajax_tanlename/",
        async: false,
        data:{'projectid':projectid,'pageid':pageid},

        success : function(data) {
          $('#joinupdatetables').empty();
          $('#joinupdatetables').append('<option value="">{{ get_chache_selectjointableerror }}</option>');
          $.each(data.join_alltablename, function(idx2,kvalue) { 
            $('#joinupdatetables').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');
          });
        }
    }); 
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    var tableid =$("#update_tablename :selected").val();
    $.ajax({
      url :"/column_list/",
      type : 'POST',
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data) {
        $('#selectpicker1').empty();
        $('#selectpicker1').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
        $('#selectpicker1').append('<option value="id">id</option>');
        $('#selectpicker1').append('<option value="status">status</option>');
        $('#selectpicker1').append('<option value="createdon">createdon</option>');
        $('#selectpicker1').append('<option value="createdby">createdby</option>');
        $('#selectpicker1').append('<option value="modifiedon">modifiedon</option>');
        $('#selectpicker1').append('<option value="modifiedby">modifiedby</option>');
        $.each(data.get_columnname, function(idx2,kvalue) { 
          $('#selectpicker1').append('<option value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
          $("#columnquery").html(data.columnquery);
        });
        $('#aggregatefunctionsupdate').empty();
        $('#aggregatefunctionsupdate').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
        $.each(data.get_columnname, function(idx2,kvalue) { 
          $('#aggregatefunctionsupdate').append('<option value="'+ aliasesname +'.'+kvalue.columnname+'">'+ aliasesname +'.'+kvalue.columnname+'</option>');
        });
      }
  });
  $('#selectpicker1').selectpicker('refresh')
  $('#aggregatefunctionsupdate').selectpicker('refresh')   
    }

$("#join_updatecheck_condition").click(function(){
    var joincondition =$("#joinupdatecondition :selected").val();
    var join_check_condition =$("#join_updatecheck_condition :selected").val();
    if(joincondition =='ON'){
      $('#joinupdatedynamic').prop('checked', true);
      $("#from_table_show_updatedata").show();
      $("#from_column_show_updatedata").show();
      $("#from_updatejoincheck").hide();
      $("#joincolumnvalues_updatedata").hide();
      $("#joininput_data").hide();
    }else{
      $('#joinupdatedynamic').prop('checked', false);
      $('#joinupdatecheck').prop('checked', true);
      $("#from_table_show_updatedata").hide();
      $("#from_column_show_updatedata").hide();
      $("#joininput_data").hide();
      $("#from_updatejoincheck").show();
      $("#joincolumnvalues_updatedata").show();
    } 
  });
  $('#joinupdatecheck').click(function(){
    var datatype = $("#joinupdatecolumns :selected").data("datatype");
    data =$('#joinupdatecheck').val()
   
    if($(this).is(":checked")){
      $("#joincolumnvalues_updatedata").show();
      $("#joininput_data").hide();
    }else{
      $("#joincolumnvalues_updatedata").hide();
      $('#from_updatejoincheck').after('<div class="col-md-3" id ="joininput_data"><label>Column values</label><input type="text" id="text_joininputtypes" name="varchartext" required="true"></div>')
      if((datatype == "int")||(datatype =="int4")||(datatype =="int8")||(datatype =="bigint") || (datatype =="float4") || (datatype =="float8") ||(datatype =="decimal") ||(datatype =="serial") ){
        $("#text_joininputtypes").prop("type", "number");
      }
      else{
        $("#text_joininputtypes").prop("type", "text");
      }
    }
  });

  //#######Manage query check box################
  $("#joinupdatedynamic").click(function(){
    data =$("#joinupdatedynamic").val()
    var datatype = $("#joinupdatecolumns :selected").data("datatype");
    var joincondition =$("#joinupdatecondition :selected").val();
    
    if($(this).is(":checked")&&(joincondition !='AND')){
      $("#from_table_show_updatedata").show();
      $("#from_column_show_updatedata").show();
      $("#fromjoin_condition_col").show();
      $("#from_updatejoincheck").hide();
      $("#joincolumnvalues_updatedata").hide();
    }else{
      $("#from_table_show_updatedata").hide();
      $("#from_column_show_updatedata").hide();
      $("#from_updatejoincheck").show();
      $('#joinfromupdatetablelist option[value =""]').prop('selected', true);
      $('#joinfromupdatecolumns').empty();
      $('#joinfromupdatecolumns').append(' <option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>')
      var values=$('#joinupdatecheck').prop('checked', true);
      if($("#joinupdatecheck").is(":checked")){
        $("#joincolumnvalues_updatedata").show();
        $("#joininput_data").hide();
        var tableid = $("#joinupdatetables :selected").text();
        var urllist = window.location.pathname;
        var url=urllist.split('/');
        var projectid=url[2];
        var column_id = $("#joinupdatecolumns :selected").text();          
        $.ajax({
          type:'POST',
          url:"/join_columnvalues/",
          async:false,
          data:{'projectid':projectid,'tableid':tableid,'column_id':column_id},
          datatype:'json',
          success : function(data) {
            if(column_id =='status'){
              $('#joincolumnupdatevalues').empty();
              $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
              $.each(data.status_values, function(idx21,value) { 
                $('#joincolumnupdatevalues').append('<option value="'+value+'">'+value+'</option>');
              });                    
            }else{
              $('#joincolumnupdatevalues').empty();
              $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
              $.each(data.column_values, function(idx2,kvalue) { 
                $.each(kvalue, function(idx21,kvalue1){ 
                  $('#joincolumnupdatevalues').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
                });
              }); 
                }
                $('#joincolumnupdatevalues').selectpicker('refresh')   
              }
            });
  
      }else{
        $("#joininput_data").show();
        $("#joincolumnvalues_data").hide();
      } 
    }
  });
  
  //#########################Manage query 1st GO button##########################
  $(document).ready(function(){
  $("#joincolumn_updatego").click(function(){
    var fromtablevalues1 =$("#fromjoin_updateexecute").val();
    $('#joinupdatedynamic1').trigger( "click" );
    $('#joinupdatedynamic1').prop('checked', false); 
    $('#fromjoin_updateexecute').val("")
    var fromtablevalues =$("#fromjoin_updateexecute").val();
    var jointablename =  $("#joinupdatetables :selected").text();
    var joincolumns = $("#joinupdatecolumns :selected").text();
    var joinfromtable = $("#joinfromupdatetablelist :selected").text();
    var joinfromcolumns = $("#joinfromupdatecolumns :selected").text();
    var joincondition = $("#joinupdatecondition :selected").val();
    var join_condition_col = $("#join_condition_col :selected").text();
    var join_check_condition =$("#join_updatecheck_condition :selected").val();
    var colum_valus1 = $("#joincolumnupdatevalues :selected").map((_, e) => e.value).get();
    var Joinupdatecolumnname = $("#Joinupdatecolumnname :selected").map((_, e) => e.value).get();
    var colum_valus= JSON.stringify(colum_valus1);
    var column_datatype = $("#joinupdatecolumns :selected").data("datatype");
    var jointypes = $("#joinupdatetypes").val();
    var colum_valus_text = $("#text_joininputtypes").val();
    var from_joininput_text= $("#from_joininput_text").val();
    var aliasesname=$("#update_tablename :selected").data("aliases");
    colum_valus_len=(colum_valus1.length)
    var err_msg = $('#join_condition_error').remove(); 
    var get_aliasesname=$(" #joinupdatetables :selected").data("aliases");
    var joinfromcoltype =$("#joinfromupdatecolumns :selected").data("datatype");
    var val_arr = $("select#aggregatefunctionsupdate option").map(function() {return $(this).val();}).get()
    for(var i = 0; i < val_arr.length; i++){    
        if(val_arr[i].search('a1.') > -1){
        $('#aggregatefunctionsupdate').find('[value="'+val_arr[i]+'"]').remove()
        $('#aggregatefunctionsupdate').selectpicker("refresh");
      }
    }
    // var value =  $("#Joincolumnname :selected").map((_, e) => e.text).get();    
    $('#join_condition_error').remove();
    $('#join_tablename').remove();
    $('#join_columnnames').remove();
    $('#join_check_condition_error').remove();
    $('#joinfromtable_error').remove();
    $('#joinfromcolumns_error').remove();
    $('#Joinupdatecolumnname_error').remove();
    $('#jointypes_error').remove();
    var ermsg = 0;
    var jointypes_errormsg ="{{ get_chache_jointypeserror }}"
    if(jointypes =="{{ get_chache_selectjoineerror }}" || jointypes == null){
    jointypes_error = jointypes_errormsg 
    $('#joinupdatetypes').after("<span id='jointypes_error' class='error_msg'>"+jointypes_error+"</span>");
    ermsg = 1;
    }
    var Joinupdatecolumnname_errormsg = "select joincolumnname"
    if(Joinupdatecolumnname.length == 0){
    Joinupdatecolumnname_errormsgtypes_error = Joinupdatecolumnname_errormsg
    $('#Joinupdatecolumnname').after("<span id='Joinupdatecolumnname_error' class='error_msg'>"+Joinupdatecolumnname_errormsgtypes_error+"</span>");
    ermsg = 1;
    }
    var join_tablenameerrormsg ="{{ get_chache_jointablenameerrormsg }}"
    if(jointablename =="{{ get_chache_selectjointableerror }}"){
      join_tablename = join_tablenameerrormsg
      $('#joinupdatetables').after("<span id='join_tablename' class='error_msg'>"+join_tablename+"</span>");
      ermsg = 1;
    }
    var joincloumserrormsg ="{{ get_chache_joincolumnserrormsg }}"
    if(joincolumns =="{{ get_chache_selectcolumnerror }}"){
      join_columnnames= joincloumserrormsg
      $('#joinupdatecolumns').after("<span id='join_columnnames' class='error_msg'>"+join_columnnames+"</span>");
      ermsg = 1;
    }
    var joincheckconderrormsg ="{{ getcachejoincheckconditionerrormsg }}"
    if((join_check_condition =="{{ get_chache_selectconditionerror }}")||(join_check_condition =="sélectionner l'état" || join_check_condition == '')){
      join_check_condition_error= joincheckconderrormsg
      $('#join_updatecheck_condition').after("<span id='join_check_condition_error' class='error_msg'>"+join_check_condition_error+"</span>");
      ermsg = 1;
    }
    var joinfromcolumns_errormsg ="{{ get_chache_joinfromcolumnserrormsg }}"
    if(joinfromcolumns =="{{ get_chache_selectcolumnerror }}" && join_condition_col == "ON"){
      joinfromcolumns_error= joinfromcolumns_errormsg
      $('#joinfromupdatecolumns').after("<span id='joinfromcolumns_error' class='error_msg'>"+joinfromcolumns_error+"</span>");
      ermsg = 1;
    }
    var join_condition_errormsg ="{{ get_chache_joinconditionerrormsg }}"
    if(((joincondition =="ON") || (joincondition =='AND') || (joincondition =='OR'))&&(colum_valus_len > 1)&&((join_check_condition =='=')||(join_check_condition =='<>')||(join_check_condition =='!=')||(join_check_condition =='>')||(join_check_condition =='>=')||(join_check_condition =='<=')||(join_check_condition =='<'))){
      join_condition_error = join_condition_errormsg
      $('#joinupdatecondition').after("<span id='join_condition_error' class='error_msg'>"+join_condition_error+"</span>");
      ermsg = 1;
    }
    var joinfromtable_errormsg ="{{ get_chache_joinfromtableerrormsg }}"
    if(joinfromtable =="{{ get_chache_selecttableerrormsg }}" && colum_valus_len == 0){
      joinfromtable_error= joinfromtable_errormsg
      $('#joinfromupdatetablelist').after("<span id='joinfromtable_error' class='error_msg'>"+joinfromtable_error+"</span>");
      ermsg = 1;
    }  
    if(ermsg){
      return false
    }else{
      $("#joinupdateand").show();
      $("#joinupdateor").show();
      $('#joinupdateand').removeAttr('disabled');
      $('#joinupdateor').removeAttr('disabled');
      $('#joinupdateon').prop('disabled', 'disabled');
    }
    

    if($("#joinupdatedynamic").is(":checked")){
      if((joincondition =='ON')&&(joincolumns !="{{ get_chache_selectcolumnerror }}")&&(join_check_condition !="{{ get_chache_selectconditionerror }}")&&(joinfromtable !="{{ get_chache_selecttableerrormsg }}")&&(joinfromcolumns !="{{ get_chache_selectcolumnerror }}") &&(jointablename !="{{ get_chache_selectjointableerror }}")){
        var get_aliasesname=$("#joinupdatetables :selected").data("aliases");
        var aliasesname_col= get_aliasesname
        var alisejoin =$('#joincolumnsalisedata').html(aliasesname_col)//need to know
        }
    }
    else{
    $('#joinfromupdatetablelist option[value =""]').prop('selected', true);
    $('#joinfromupdatecolumns option[value=""]').prop('selected', true);
    if((joincondition =='ON')&&(joincolumns !="{{ get_chache_selectcolumnerror }}")&&(join_check_condition !="{{ get_chache_selectconditionerror }}")){
      var get_aliasesname=$(" #joinupdatetables :selected").data("aliases");
      $('#outputupdate1').html(function(i, val) { return val*1+1 });
      get_randomnum =$("#outputupdate1").html();
      var aliasesname_col=get_aliasesname 
      var alisejoin =$('#joincolumnsalisedata').html(aliasesname_col)
    }
  }
    var get_aliasesname=$(" #joinupdatetables :selected").data("aliases");  
    var aliasesname_col=get_aliasesname
    $.ajax({
      type:'POST',
      url:"/join_columnquery/",
      data:{'jointablename':jointablename,'joincolumns':joincolumns,'joinfromtable':joinfromtable,'joinfromcolumns':joinfromcolumns,'joincondition':joincondition,'join_condition_col':join_condition_col,'join_check_condition':join_check_condition,'colum_valus':colum_valus,'column_datatype':column_datatype,'colum_valus_text':colum_valus_text,'fromtablevalues':fromtablevalues,'aliasesname':aliasesname,'aliasesname_col':aliasesname_col,'joinfromcoltype':joinfromcoltype},
      success : function(data) {
        var fromtablevaluesend=fromtablevalues1+' '+data.query;
        $("#fromjoin_updateexecute").val(fromtablevaluesend);
        var fromtablevaluesafter =$("#fromjoin_updateexecute").val();
        if(fromtablevaluesafter.length){
          $("#joinupdateand").show();
          $("#joinupdateor").show();
          $('#joinupdateand').removeAttr('disabled');
          $('#joinupdateor').removeAttr('disabled');
          $('#joinupdateon').prop('disabled', 'disabled');
        }
      }
    });
   
 
    
   

    $("#joinupdatecondition").val([]);
    $("#joinfromupdatetablelist").val([]);
    $("#joinfromupdatecolumns").val([]);
    $("#join_condition_col").val([]);
    $('#fromjoin_updateexecute').val("")
    
    $("#text_joininputtypes").val([]);
    $("#joinupdatecolumns").val([]);
    $("#join_updatecheck_condition").val([]);
    $('#joincolumnupdatevalues').empty();
    $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
    $("#joincolumnupdatevalues").selectpicker('refresh'); 
    $("#Joinupdatecolumnname").selectpicker('refresh'); 

    if($("#joinupdatedynamic").is(":checked")){
      if((joincondition =='ON')&&(joincolumns !="{{ get_chache_selectcolumnerror }}")&&(join_check_condition !="{{ get_chache_selectconditionerror }}")&&(joinfromtable !="{{ get_chache_selecttableerrormsg }}")&&(joinfromcolumns !="{{ get_chache_selectcolumnerror }}") &&(jointablename !="{{ get_chache_selectjointableerror }}")){
        var get_aliasesname=$("#joinupdatetables :selected").data("aliases");
        aliasesname_col= get_aliasesname
        var alisejoin =$('#joincolumnsalisedata').html(aliasesname_col)// need to know
      }
    }
    else{
      $('#joinfromupdatetablelist option[value =""]').prop('selected', true);
      $('#joinfromupdatecolumns option[value=""]').prop('selected', true);
      if((joincondition =='ON')&&(joincolumns !="{{ get_chache_selectcolumnerror }}")&&(join_check_condition !="{{ get_chache_selectconditionerror }}")){
        var get_aliasesname=$(" #joinupdatetables :selected").data("aliases");
        $('#outputupdate1').html(function(i, val) { return val*1+1 });
        get_randomnum =$("#outputupdate1").html();
        aliasesname_col=get_aliasesname
        var alisejoin =$('#joincolumnsalisedata').html(aliasesname_col)
      }
    }
    
  var aliasesname_colval = aliasesname_col
  var tableid = $("#joinupdatetables :selected").val();
  var urllist = window.location.pathname;
  var url=urllist.split('/');
  var projectid=url[2];

  $.ajax({
    url :"/column_list/",
    type : 'POST',
    async: false,
    data:{'projectid':projectid,'tableid':tableid},
    dataType : 'json',
    success : function(data){
      $.each(data.get_columnname, function(idx2,kvalue){   
        $('#aggregatefunctionsupdate').append('<option value="'+aliasesname_colval+'.'+kvalue.columnname+'">'+aliasesname_colval+'.'+kvalue.columnname+'</option>');
          }); 
          }
      }); 
    $('#aggregatefunctionsupdate').selectpicker('refresh')
  });
});

$("#join_updatego").click(function(){
    var selectqueryvaluid =  $('#selectqueryupdate').html()
    var value = "*";
    var asteric_check = selectqueryvaluid.includes(value) ? "Yes" : "No";
    var jointypes = $("#joinupdatetypes").val();
    var jointablename = $("#joinupdatetables :selected").text();
    var joinfromsection = $('#fromjoin_updateexecute').val();
    var fromtablevalues =$("#fromjoin_updateexecute").val();
    var joincolumnupdatevalues = $("#joincolumnupdatevalues :selected").map((_, e) => e.text).get();
    if(joincolumnupdatevalues.length > 0){
      $("#joinfromupdatetablelist").val([]);
      $("#joinfromupdatecolumns").val([]);
      $("#join_condition_col").val([]);
      $("#joincolumnupdatevalues").selectpicker('refresh'); 
      $("#text_joininputtypes").val([]);
      // $("#joinupdatecolumns").val([]);
      // $("#join_updatecheck_condition").val([]);
      //$('#joincolumnupdatevalues').selectpicker('refresh'); 
      $("#joincolumnupdatevalues").val([]); 
    }
    var joinquery = $('#joinquery').val();
    $('#joinfromsection_error').remove()
    $('#jointypes_error').remove();
    
    var ermsg = 0;
    var jointypes_errormsg ="{{ get_chache_jointypeserror }}"
    if(jointypes =="{{ get_chache_selectjoineerror }}" || jointypes == null){
      jointypes_error = jointypes_errormsg
      $('#jointypes_error').remove();
      $('#joinupdatetypes').after("<span id='jointypes_error' class='error_msg'>"+jointypes_error+"</span>");
      ermsg = 1;
    }
    var joinfromsection_errormsg = "{{ get_chache_joinfromsectionerror }}"
    if(joinfromsection == ''){
      joinfromsection_error = joinfromsection_errormsg
      $('#joinfromsection_error').remove();
      $('#fromjoin_updateexecute').after("<span id='joinfromsection_error' class='error_msg'>"+joinfromsection_error+"</span>");
      ermsg = 1;
    }
    if(ermsg){
        return false
      }
    if((joinfromsection)&&(jointypes !="{{ get_chache_selectjoineerror }}")){
      var str = joinfromsection
      var split1 = str.replaceAll(" ON ","")
      var value = $('#joinupdatecolumns :selected').text()
      var val_str = value.toString()
      var split2 = split1.replace("."+val_str+"","")
      var checkcon = $('#join_updatecheck_condition :selected').val()
      var aliasesname = split2.split(" "+checkcon+" ")
      aliasesname_val = 'a1'
    }
    
   
    $.ajax({
      type:'POST',
      url:"/join_query/",
      async:false,
      data:{'jointypes':jointypes,'jointablename':jointablename,'joinfromsection':joinfromsection,'aliasesname_val':aliasesname_val},
      datatype:'json',
      success : function(data){
        $("#joinqueryupdate").html(data.query);
      }
    });
    var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
    string = JSON.stringify(value);
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    var tableid =  $("#update_tablename").val();
    var jointableselect_column_val =  $("#Joinupdatecolumnname :selected").map((_, e) => e.text).get();
    var joinselectcolumn_name= JSON.stringify(jointableselect_column_val);
    var aliasesname=$("#update_tablename :selected").data("aliases");
    var get_randomnum =$("#column_alisename").html();
    var joincolmun_aliasesname = aliasesname_val
    
   
    $.ajax({
      url :"/ajax_option/",
      type : 'POST',
      async: false,
      data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname,'joinselectcolumn_name':joinselectcolumn_name,'joincolmun_aliasesname':joincolmun_aliasesname},
      dataType : 'json',
      success : function(data){
        $("#selectqueryupdate").html(data.query1); 
        $("#selectquery1update").html(data.query2);
        $("#selectquery2update").html(data.query3);   
      }
    });
    var groupbycondition_val = $("#groupbyconditionupdate").val();
    var groupby_columnlist_string =$("#aggregatefunctionsupdate").val();
    var groupby_columnlist_val = JSON.stringify(groupby_columnlist_string);
    var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
    var groupby_updatecolumnlist = $("#groupby_updatecolumnlist :selected").map((_, e) => e.text).get();
    string = JSON.stringify(value);
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    var tableid =  $("#update_tablename").val();
    var aliasesname=$("#update_tablename :selected").data("aliases");
    var columnname =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
    var jointableselect_column_val =  $("#Joinupdatecolumnname :selected").map((_, e) => e.text).get();
    var joinselectcolumn_name= JSON.stringify(jointableselect_column_val);
    if(groupbycondition_val != '' && groupby_columnlist_string.length != 0){
      var stringvalarray = []
      $.ajax({
      type : 'POST',
      url :"/groupbycondition_query/",
      async: false,
      data:{'groupbycondition_val':groupbycondition_val,'groupby_columnlist_val':groupby_columnlist_val,'string':string,'projectid':projectid,'tableid':tableid,'aliasesname':aliasesname,'joinselectcolumn_name':joinselectcolumn_name},
      dataType : 'json',
      success : function(data){
        if(data.status =='success'){
          //pass
        }
        else{
          $("#groupbydataupdate").html(data.query);
        }
      }
    });   
  }  
  if(asteric_check != "No"){
        $('#selectqueryupdate').html(selectqueryvaluid)
        $('#selectquery2update').html("")
        $('#selectquery1update').html("")
        $('#groupby_updatehideshow').hide();
      }
    var q = $('#querysetupdate').text();
    var ans = $.trim(q.replace(/\s/g, ' '))
    var finalquery = ans.replace(/ +/g, " ")
    $('#querycontent_data').val(finalquery);   
    var querydata = $("#querycontent_data").val()
    const result3 = {};
            const count3 = querydata.split(' ');
            for(let word of count3) {
                if(result3[word]){         
                  result3[word]++;
                }else{
                  result3[word] = 1;
                }
                    }
    var join_count3 = result3["JOIN"]
    var val= 10
    for(var i = 0; i < val; i++){
      if(i == 0){
        $("#selectpicker1").trigger("change"); 
        $("#Joinupdatecolumnname").trigger("change");
        }else{              
          $("#Joinupdatecolumnname"+i+"").trigger("change");                             
        }
      }
  });

$("#joinfromupdatetablelist").click(function(){
    var tableid = $("#joinfromupdatetablelist :selected").val();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
  
    $.ajax({
      url :"/column_list/",
      type : 'POST',
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data) {
        $('#joinfromupdatecolumns').empty();
        $('#joinfromupdatecolumns').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
        $('#joinfromupdatecolumns').append('<option value="id">id</option>');
        $('#joinfromupdatecolumns').append('<option value="status">status</option>');
        $('#joinfromupdatecolumns').append('<option value="createdon">createdon</option>');
        $('#joinfromupdatecolumns').append('<option value="createdby">createdby</option>');
        $('#joinfromupdatecolumns').append('<option value="modifiedon">modifiedon</option>');
        $('#joinfromupdatecolumns').append('<option value="modifiedby">modifiedby</option>');
        
        $.each(data.get_columnname, function(idx2,kvalue){ 
          $('#joinfromupdatecolumns').append('<option value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
        });   
      }
    });
  });
$("#joinupdatetables").click(function(){

    var tableid = $("#joinupdatetables :selected").val();
    var tablename = $("#joinupdatetables :selected").text();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
  
    $.ajax({
      url :"/column_list/",
      type : 'POST',
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data) {
        $('#joinupdatecolumns').empty();
        $('#joinupdatecolumns').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>');
        $('#joinupdatecolumns').append('<option data-datatype="serial" value="id">id</option>');
        $('#joinupdatecolumns').append('<option data-datatype="int4" value="status">status</option>');
        $('#joinupdatecolumns').append('<option value="createdon">createdon</option>');
        $('#joinupdatecolumns').append('<option value="createdby">createdby</option>');
        $('#joinupdatecolumns').append('<option value="modifiedon">modifiedon</option>');
        $('#joinupdatecolumns').append('<option value="modifiedby">modifiedby</option>');  
        $.each(data.get_columnname, function(idx2,kvalue){   
          $('#joinupdatecolumns').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
        }); 
        $('#Joinupdatecolumnname').empty();
        $('#Joinupdatecolumnname').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
        $('#Joinupdatecolumnname').append('<option value="id">id</option>');
        $('#Joinupdatecolumnname').append('<option value="status">status</option>');       
        $('#Joinupdatecolumnname').append('<option value="createdon">createdon</option>');
        $('#Joinupdatecolumnname').append('<option value="createdby">createdby</option>');
        $('#Joinupdatecolumnname').append('<option value="modifiedon">modifiedon</option>');
        $('#Joinupdatecolumnname').append('<option value="modifiedby">modifiedby</option>');  
        $.each(data.get_columnname, function(idx2,kvalue){
          $('#Joinupdatecolumnname').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
        }); 
      }
    }); 
    $('#Joinupdatecolumnname').selectpicker('refresh')
    var queryvalue = $('#querysetupdate').text();
    var finalqueryy = queryvalue.replace(/^\s+|\s+$/g, '');
    var finalwherequery = finalqueryy.replaceAll("  "," ")
    $('#querycontent_data').val(finalwherequery);  
  });
//---------------------------join_query_linktable----------------------------------------

$('#selectqueryupdatebutton').click( function(){
  var tablename = $('#update_tablename :selected').text()
  var columnname =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
  var aliasesname = $("#update_tablename :selected").data("aliases");
  var stringvalarray = []
 
  if(tablename != null && tablename != '' && columnname != null && columnname != ''){
        for(var i = 0; i < columnname.length; i++){
            var strvalconvert=aliasesname+'.'+columnname[i]+' as '+aliasesname+'_'+columnname[i]
            stringvalarray.push(strvalconvert)
            var my_string = stringvalarray.join()
                  }  
        var data = "select "+my_string+" from "+ tablename +" as "+ aliasesname +"" 
        $("#selectqueryupdate").html(data); 
  }
  var q = $('#querysetupdate').text();
  var ans1 = $.trim(q.replace(/\s/g, ' '))
  var ans = ans1.replace(/ +/g, " ")
  $('#querycontent_data').val(ans); 
})
//------------Manage Query column update start-------------------------
$('#update_tablename').click(function()
{
  var text = $('#querycontent_data').val();
  const result3 = {};
  const count3 = text.split(' ');
  for(let word of count3) {
      if(result3[word]) {
        result3[word]++;
      } else {
        result3[word] = 1;
      }
          }
  var join_count = result3['JOIN']  
  for(var i = 0; i < join_count; i++){
     if(i != 0){
      var urllist = window.location.pathname;
      var url=urllist.split('/');
      var projectid=url[2];
      var pagename =$('#pagename').val();
      var array = pagename.split(",");
      var pageid =(array[2]);  
      var tableid =$("#update_tablename :selected").val();
      $.ajax({
        type : 'POST',
        url :"/ajax_tanlename/",
        async: false,
        data:{'projectid':projectid,'pageid':pageid},
        success : function(data){
          $('#joinupdatetables'+i+'').empty();
          $('#joinupdatetables'+i+'').append('<option value=""selected disabled>{{ get_chache_selectjointableerror }}</option>');
          $.each(data.tablename, function(idx2,kvalue){ 
            $('#joinupdatetables'+i+'').append('<option value="'+kvalue.id+'" data-aliases ="a'+i+'">'+kvalue.tablename+'</option>');
              });
            }
        });
        var projectid = $('#projectid').val();
        var urllist = window.location.pathname;
        var url=urllist.split('/');
        var projectid=url[2];
        $.ajax({
              type : 'POST',
              url :"/ajaxwhere_tablelist/",
              async: false,
              data:{'projectid':projectid,'tableid':tableid},
              dataType : 'json',
              success : function(data) {
                $('#joinfromupdatetablelist'+i+'').empty();
                $('#joinfromupdatetablelist'+i+'').append('<option value="" selected disabled>{{ get_chache_selectjointableerror}}</option>');
                $.each(data.table_data, function(idx2,kvalue){ 
                  $('#joinfromupdatetablelist'+i+'').append('<option value="'+kvalue.id+'" data-aliases ="a'+i+'" >'+kvalue.tablename+'</option>');
                });
              }
            });    
     }
  }

  $('#joinupdatecolumns').val([]);
  $('#Joinupdatecolumnname').val([]);
  var urllist = window.location.pathname;
  var url=urllist.split('/');
  var projectid=url[2];
  var tableid =$("#update_tablename :selected").val();
  var aliasesname=$("#update_tablename :selected").data("aliases");
  $('#groupby_updatecolumnlist').empty();
  $('#groupby_updatecolumnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
  $('#groupby_updatecolumnlist').selectpicker('refresh')
  
  $.ajax({
    type : 'POST',
    url :"/ajax_option/",
    async: false,
    data:{'projectid':projectid,'tableid':tableid,'string':1,'aliasesname':aliasesname},
    dataType : 'json',
    success : function(res){
      $("#selectquery").html(res.query);
      $("#joinsection").show();
    }
  });
  var urllist = window.location.pathname;
  var url=urllist.split('/');
  var projectid=url[2];
  var tableid =$("#update_tablename :selected").val();
  $.ajax({
      url :"/column_list/",
      type : 'POST',
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data) {
      $('#selectpicker1').empty();
      $('#selectpicker1').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
      $('#selectpicker1').append('<option value="" selected="true">id</option>');
      $('#selectpicker1').append('<option value="">status</option>');
      $('#selectpicker1').append('<option value="createdon">createdon</option>');
      $('#selectpicker1').append('<option value="createdby">createdby</option>');
      $('#selectpicker1').append('<option value="modifiedon">modifiedon</option>');
      $('#selectpicker1').append('<option value="modifiedby">modifiedby</option>');
        $.each(data.get_columnname, function(idx2,kvalue){ 
          $('#selectpicker1').append('<option value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
          $("#columnquery").html(data.columnquery);
        });
      }
  });
  $('#selectpicker1').selectpicker('refresh')

  $.ajax({
    type : 'POST',
    url :"/ajaxwhere_tablelist/",
    async: false,
    data:{'projectid':projectid,'tableid':tableid},
    dataType : 'json',
    success : function(data) {
      $('#selectupdate').empty();
      $('#selectupdate').append('<option value="" disabled>{{ get_chache_selecttableerrormsg }}</option>');
      $.each(data.table_data, function(idx2,kvalue){ 
        $('#selectupdate').append('<option value="'+kvalue.id+'">'+kvalue.tablename+'</option>');
      });
    }
  });
//---------------------------join_query_linktable----------------------------------------
  var pagename =$('#pagename').val();
  var array = pagename.split(",");
  var pageid =(array[2]);  
  // var urllist = window.location.pathname;
  // var url=urllist.split('/');
  // var projectid=url[2];
  // var tableid =$("#update_tablename :selected").val();
  $.ajax({
        type : 'POST',
        url :"/ajax_tanlename/",
        async: false,
        data:{'projectid':projectid,'pageid':pageid},
        success : function(data) {
          $('#joinupdatetables').empty();
          $('#joinupdatetables').append('<option value=""selected disabled>{{ get_chache_selectjointableerror }}</option>');
          $.each(data.tablename, function(idx2,kvalue) { 
            $('#joinupdatetables').append('<option value="'+kvalue.id+'" data-aliases ="a1">'+kvalue.tablename+'</option>');
          });
        }
    });// Main table
     


var projectid = $('#projectid').val();
var urllist = window.location.pathname;
var url=urllist.split('/');
var projectid=url[2];
$.ajax({
      type : 'POST',
      url :"/ajaxwhere_tablelist/",
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data) {
        $('#joinfromupdatetablelist').empty();
        $('#joinfromupdatetablelist').append('<option value="" selected disabled>{{ get_chache_selectjointableerror}}</option>');
        $.each(data.table_data, function(idx2,kvalue){ 
          $('#joinfromupdatetablelist').append('<option value="'+kvalue.id+'" data-aliases ="a1" >'+kvalue.tablename+'</option>');
        });
      }
    });  
var tableid = $("#joinfromupdatetablelist :selected").val();
var urllist = window.location.pathname;
var url=urllist.split('/');
var projectid=url[2];

$.ajax({
    url :"/column_list/",
    type : 'POST',
    async: false,
    data:{'projectid':projectid,'tableid':tableid},
    dataType : 'json',
    success : function(data){
      $('#joinfromupdatecolumns').empty();
      $('#joinfromupdatecolumns').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
      $('#joinfromupdatecolumns').append('<option value="id">id</option>');
      $('#joinfromupdatecolumns').append('<option value="status">status</option>');
      $('#joinfromupdatecolumns').append('<option value="createdon">createdon</option>');
      $('#joinfromupdatecolumns').append('<option value="createdby">createdby</option>');
      $('#joinfromupdatecolumns').append('<option value="modifiedon">modifiedon</option>');
      $('#joinfromupdatecolumns').append('<option value="modifiedby">modifiedby</option>');
      
      $.each(data.get_columnname, function(idx2,kvalue){ 
        $('#joinfromupdatecolumns').append('<option value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
        });
      }
    });        
  });  
  $('#joinupdatecolumns').click(function(){
    var tableid = $("#joinupdatetables :selected").text();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    var column_id = $("#joinupdatecolumns :selected").text();
    
    $.ajax({
      type:'POST',
      url:"/join_columnvalues/",
      async:false,
      data:{'projectid':projectid,'tableid':tableid,'column_id':column_id},
      datatype:'json',
      success : function(data) {
        if(column_id =='status'){
          $('#joincolumnupdatevalues').empty();
          $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
          $.each(data.status_values, function(idx21,value) { 
             $('#joincolumnupdatevalues').append('<option value="'+value+'">'+value+'</option>');
          });
        
        }else{
          $('#joincolumnupdatevalues').empty();
          $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
          $.each(data.column_values, function(idx2,kvalue) { 
            $.each(kvalue, function(idx21,kvalue1){ 
              $('#joincolumnupdatevalues').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
            });
          });
        }
      }
    });
    $('#joincolumnupdatevalues').selectpicker('refresh')
  });  
  $('#joincolumnupdatevalues').click(function(){
    var tableid = $("#joinupdatetables :selected").text();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    var column_id = $("#joinupdatecolumns :selected").text();
    
    $.ajax({
      type:'POST',
      url:"/join_columnvalues/",
      async:false,
      data:{'projectid':projectid,'tableid':tableid,'column_id':column_id},
      datatype:'json',
      success : function(data) {
        if(column_id =='status'){
          $('#joincolumnupdatevalues').empty();
          $('#joincolumnupdatevalues').append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>');
          $.each(data.status_values, function(idx21,value) { 
             $('#joincolumnupdatevalues').append('<option value="'+value+'">'+value+'</option>');
          });
        
        }else{
          $('#joincolumnupdatevalues').empty();
          $.each(data.column_values, function(idx2,kvalue) { 
            $.each(kvalue, function(idx21,kvalue1) { 
              $('#joincolumnupdatevalues').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
            });
          });
        }
      }
    });
    $('#joincolumnupdatevalues').selectpicker('refresh');
  }); 
  //--------------------select_wherecondition-----------------------------------------
  $("#selectupdate").click(function(){
    var tableid =  $("#selectupdate :selected").val();
    var urllist = window.location.pathname;
    var url=urllist.split('/'); 
    var projectid=url[2];
  
    var aliasesname=$("#update_tablename :selected").data("aliases");
   
    $.ajax({
      type:'POST',
      url:"/ajaxwhere_tablelist/",
      async:false,
      data:{'projectid':projectid,'tableid':tableid},
      datatype:'json',
      success : function(data){ 
        $('#select_updatecolumns').empty();
        $('#select_updatecolumns').append('<option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>');
        $('#select_updatecolumns').append('<option data-datatype ="serial" value="id">id</option>');
        $('#select_updatecolumns').append('<option data-datatype ="int4"value="status">status</option>');
        $('#select_updatecolumns').append('<option value="createdon">createdon</option>');
        $('#select_updatecolumns').append('<option value="createdby">createdby</option>');
        $('#select_updatecolumns').append('<option value="modifiedon">modifiedon</option>');
        $('#select_updatecolumns').append('<option value="modifiedby">modifiedby</option>'); 
        $.each(data.where_get_columnname, function(idx2,kvalue){ 
          $('#select_updatecolumns').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
        });
      $('#select_updatecolumns option[value=""]').prop('selected', true)  
      }
    });
  });
  $("#select_updatecolumns").click(function(){
      $('#defaultvaluesupdate').prop('checked', true);
      var tableid =  $("#selectupdate :selected").val();
      var column_id=  $("#select_updatecolumns :selected").val();
      var column_name=  $("#select_updatecolumns :selected").text();
      var urllist = window.location.pathname;
      var url=urllist.split('/');
      var projectid=url[2];
      
      dynamicupdatefunction(projectid,tableid,column_id);
      $("#get_columvalues").show();      
  });
  $('#defaultvaluesupdate').click(function(){
    var datatype = $("#select_updatecolumns :selected").data("datatype");
    var tableid =  $("#selectupdate :selected").val();
    var column_id=  $("#select_updatecolumns :selected").val();
  
    var column_name=  $("#select_updatecolumns :selected").text();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    if($(this).is(":checked")){
      $("#get_updatecolumvalues").show();
      $("#defaultinputbox").hide();
      dynamicupdatefunction(projectid,tableid,column_id);

    }else{
      $("#get_updatecolumvalues").hide();
      $('#dynamicupdate').prepend('<div class="col-md-3" id="defaultinputbox"><label>Column values:</label><input type="text" id="text_select_columnsvalues" name="varchartext" required="true"></div>')  
      if((datatype == "int")||(datatype =="int4")||(datatype =="int8")||(datatype =="bigint") || (datatype =="float4") || (datatype =="float8") ||(datatype =="decimal") ){
        $("#text_select_columnsvalues").prop("type", "number");
      }
      else{
        $("#text_select_columnsvalues").prop("type", "textdisabled");
      }
    }
  });
  function dynamicupdatefunction(projectid,tableid,column_id){
    var tablename =  $("#selectupdate :selected").text();
    var column_name=  $("#select_updatecolumns :selected").text();
  
    $.ajax({
        type:'POST',
        url:"/ajaxwhere_columndata/",
        async:false,
        data:{'projectid':projectid,'tableid':tableid,'column_id':column_id,'column_name':column_name,'tablename':tablename},
        datatype:'json',
        success : function(data) {
          if(column_name =='status'){
            $('#select_updatecolumnsvalues').empty();
            $('#select_updatecolumnsvalues').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
            $.each(data.status_values, function(idx21,value){ 
               $('#select_updatecolumnsvalues').append('<option value="'+value+'">'+value+'</option>');
            });
          }else{
          $('#select_updatecolumnsvalues').empty();
          $('#select_updatecolumnsvalues').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
            $.each(data.get_columnvalues, function(idx2,kvalue){ 
              $.each(kvalue, function(idx21,kvalue1){ 
                $('#select_updatecolumnsvalues').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
              });
            });
          }
        }
    });
  }
  $("#condition_updateexecuted").click(function(){ 
    var querycontent_data = $('#querycontent_data').val();
    var selectqueryvaluid =  $('#selectqueryupdate').html()
    var value = "*";
    var asteric_check = selectqueryvaluid.includes(value) ? "Yes" : "No";
    var querycontent_data_check = querycontent_data.search("WHERE")
    var tablename = $('#update_tablename :selected').text()
    var columnname =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
    var aliasesname = $("#update_tablename :selected").data("aliases");
    var joinupdatetables = $('#joinupdatetables :selected').text()
    var stringvalarray = []
    var checkcondition1 =$("#where_check_updatecondition").val();
    var column_datatype = $("#select_updatecolumns :selected").data("datatype");
    var tableid =  $("#selectupdate :selected").val();
    var column_id=  $("#select_updatecolumns").val();
    var tablename =  $("#selectupdate :selected").text();
    var column_name=  $("#select_updatecolumns :selected").text();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    var key =  $("#select_updatecolumnsvalues :selected").map((_, e) => e.value).get();
    var value =  $("#select_updatecolumnsvalues :selected").map((_, e) => e.text).get();
    column_data = value
    colum_valus =(column_data.length)
    var bla = $('#text_select_columnsvalues').val();
    var condition=  $("#whereupdatecondition :selected").val();
    var aliasesname=$("#update_tablename :selected").data("aliases");
    var columnsample = $("#select_updatecolumnsvalues :selected").val()
    var columndatas1=$("#select_updatecolumnsvalues :selected").map((_, e) => e.value).get();
    var columndatas= JSON.stringify(columndatas1);
    var columndatastext=$('#text_select_columnsvalues').val();
    var jointypes = $('#joinupdatetypes').val();
    $('#tablename_error').remove();
    $('#column_name_error').remove();
    $('#checkcondition_error').remove();
    $('#condition_error').remove();
    $("#select_updatecolumns_error").remove();
    $("#select_updatecolumnsvalues_error").remove();
      var ermsg = 0;
      var column_valerr = "Please select column values" 
      if(colum_valus == 0){
          column_valerror = column_valerr
          $("#columnvaluename_error").remove();
          $("#select_updatecolumnsvalues").after("<span id='columnvaluename_error' class='error_msg'>"+column_valerror+"</span>");
          ermsg = 1;
        }
      var wheretable_errormsg ="{{ get_chache_jointablenameerrormsg }}"
      if(tablename =="{{ get_chache_selecttableerrormsg }}"){
        tablename_error = wheretable_errormsg;
        $('#tablename_error').remove();
        $('#selectupdate').after("<span id='tablename_error' class='error_msg'>"+tablename_error+"</span>");
        ermsg = 1;
      }
      var columnname_errormsg = "{{ get_chache_joincolumnserrormsg }}"
      if(column_name =="{{ get_chache_selectcolumnerror }}"){
        var column_name_error = columnname_errormsg;
        $('#checkcondition_error').remove();
        $('#select_updatecolumns').after("<span id='column_name_error' class='error_msg'>"+column_name_error+"</span>");
        ermsg = 1;
      }else{
        $("#columnvaluename_error").remove();
      }
      var checkconditionerrormsg = "{{ get_chache_wherecheckconditionerrormsg }}"
      if((checkcondition1 =="{{ get_chache_selectconditionerror }}")||(checkcondition1 =="sélectionner l'état")|| checkcondition1 == null){
        checkcondition_error = checkconditionerrormsg
        $('#checkcondition_error').remove();
        $('#where_check_updatecondition').after("<span id='checkcondition_error' class='error_msg'>"+checkcondition_error+"</span>");
        ermsg = 1;
      }
      var select_updatecolumnserr = "Please select joincondition"
      if(column_id == null){
        select_updatecolumnserror_name = select_updatecolumnserr
        $("#select_updatecolumns_error").remove();
        $('#select_updatecolumns').after("<span id='select_updatecolumns_error' class='error_msg'>"+select_updatecolumnserror_name+"</span>");
      }
      var select_updatecolumnvaluesserr = "Please select columnvalues"
      if(value.length == 0){
        select_updatecolumnvalueserror_name = select_updatecolumnvaluesserr
        $("#select_updatecolumnsvalues_error").remove();
        $("#select_updatecolumnsvalues").after("<span id='select_updatecolumnsvalues_error' class='error_msg'>"+select_updatecolumnvalueserror_name+"</span>");
      }
      if(ermsg){
        print(ermsg,"ermsg")
        return false
      }
      
      if (checkcondition1 ==null){
        checkcondition =1
      }else{
        checkcondition=checkcondition1 
      }
      var conditionerrormsg ="{{ get_chache_wherecheckequal }}"
      var multiselect=$("#selectpicker1 :selected").text();
      $.ajax({
        type:'POST',
        url:"/ajaxwhere_columndataviews/",
        async:false,
        data:{'projectid':projectid,'tableid':tableid,'column_id':column_id,'columndatas':columndatas,'checkcondition':checkcondition,'condition':condition,'aliasesname':aliasesname,'columndatastext':columndatastext,'column_datatype':column_datatype,'tablename':tablename,'column_name':column_name},
        datatype:'json',
        success : function(data) {
          $("#select_updatecolumns_error").remove();
            var dataquery = data.query
            var wherequeryupdate = JSON.stringify($('#wherequeryupdate').text())
            var where_check_wherequeryupdate = wherequeryupdate.search(dataquery)
            if((condition =="AND") || (condition =='OR')){
              if(where_check_wherequeryupdate == -1){
                $("#wherequeryupdate").append(" "+data.query);
              }        
              $("#or_optionupdate").show();
              $("#and_optionupdate").show();
            }else{
            $("#wherequeryupdate").html(data.query);
            $("#or_optionupdate").show();
            $("#and_optionupdate").show();
            $("#or_optionupdate").removeAttr("disabled");
            $("#and_optionupdate").removeAttr("disabled");
            $("#where_optionupdate").prop('disabled', 'disabled')
            }
          }
      });
        $("#defaultvaluesupdate").val([]);
        $("#select_updatecolumnsvalues").val([]);
        $("#text_select_columnsvalues").val('');
        $("#multi_values").val([]);
      var tablename = $('#update_tablename :selected').text()
      var columnname =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
      var aliasesname = $("#update_tablename :selected").data("aliases");
      var aggregatefunctions = $('#aggregatefunctionsupdate').val();
      var stringvalarray = [];
      var jointypes = $('#joinupdatetypes').val();
      var aggregatefunctions = $('#aggregatefunctionsupdate').val()
    
      if(tablename != null && tablename != '' && columnname != null && columnname != '' && jointypes == '' && aggregatefunctions == []){
            for(var i = 0; i < columnname.length; i++){
                var strvalconvert=aliasesname+'.'+columnname[i]+' as '+aliasesname+'_'+columnname[i]
                stringvalarray.push(strvalconvert)
                var my_string = stringvalarray.join()
                      }      
            var data = "select "+my_string+" from "+ tablename +" as "+ aliasesname +"" 
            $("#selectqueryupdate").html(data);         
            //$('#querycontent_data').val(data+" "+dataquery);    querycontent_data
      }
      var fromjoin_updateexecute = $('#fromjoin_updateexecute').val();
      if (fromjoin_updateexecute.length > 1){
        $('#join_updatego').trigger( "click" );
      }else{
        $('#selectqueryupdatebutton').trigger( "click" );
      }
      if(asteric_check != "No"){
        $('#groupby_updatehideshow').hide();
        $('#selectqueryupdate').html(selectqueryvaluid)
      }
     
      var q = $('#querysetupdate').text();
      var ans1 = $.trim(q.replace(/\s/g, ' '))
      var ans = ans1.replace(/ +/g, " ")
      $('#querycontent_data').val(ans); 
     
      
      
  });
function editquerydetails(){
  var projectid = $('#projectid').val();
  var query_content =$('#querycontent_data').val();
  const result3 = {};
  const count3 = query_content.split(' ');
  for(let word of count3) {
      if(result3[word]) {
        result3[word]++;
      } else {
        result3[word] = 1;
      }
          }
  var join_check = result3["JOIN"]
  var val = 10
  if(join_check == 1){
    for(i=0; i<=val; i++){
      var aliasesname_val = result3["a"+i+""]
      if(aliasesname_val == 1){
        var query_content =$('#querycontent_data').val();
        var val1 = "a"+i+""
        var query_contentval = query_content.replaceAll(val1, "a1")
        $('#exampleFormControlTextarea1').val(query_contentval);
        $('#selectquery').html(query_content)
        $("#querycontent_data").val(query_contentval)
        var query_content = query_contentval
      }
    }
  }else{
    $('#exampleFormControlTextarea1').val(query_content);
    $('#selectquery').html(query_content);
  }
  var queryid =$('#queryidappend').html();
  var query_name =$('#queryshortname_values').val();
  var pageid_get =$('#pagename').val();
  var pageid_val =pageid_get.split(',');
  var pageid =pageid_val[2];
    
  $.ajax({
    type:'POST',
    url : '/query_edit/',
    data : {'projectid':projectid,'query_content':query_content,'query_name':query_name,'queryid':queryid,'pageid':pageid},
    success : function(data){
      if(data.status =='success'){
        $('#querydatashortname'+queryid).text(query_name);
        $('#editqueryerror_msg').remove();
        $('#editboxshow').hide();
        $('#querydisplaymsg').after("<p id='editqueryerror_msg' style='color:green;margin-top:20px;text-align:center;'>"+data.message+"</p>")
        
      }else{
        $('#editqueryerror_msg').remove();
        $('#querydisplaymsg').after("<p id='editqueryerror_msg' style='color:red;margin-top:20px;text-align:center;'>"+data.message+"</p>")
      }
      setTimeout (function(){
            $('#editqueryerror_msg').remove();
          },2000)  
    }
  });   
}
$(document).ready(function(){
  $('#queryupdatebutton').click(function(e){
        closebutton()
  })
});
function closebutton(){
  $('#editboxshow').css("display","none");
  $('[id=dynamicjoin]').remove();
  $('#update_tablename option[value =""]').prop('selected', true);
  $('#join_updatecheck_condition option[value=""]').prop('selected', true);
  $("#joincolumnupdatevalues").empty();
  $("#joincolumnupdatevalues").append('<option value="" disabled >{{ get_chache_selectcolumnerror }}</option>')
  $("#joincolumnupdatevalues").selectpicker("refresh");
  $('#selectpicker1').empty();
  $('#selectpicker1').selectpicker('refresh')
  $("[id=joininput_data").remove();
  $("#joinqueryupdate").html("");
  $('#select_updatecolumns').empty();
  $('#select_updatecolumnsvalues').empty();
  $("#selectqueryupdate").html(""); 
  $("#selectquery1update").html("");
  $("#selectquery2update").html("");     
  $('#wherequeryupdate').html("");
  $('#wherequeryupdate').text('');
  $('#wherequeryupdate').html("");
  $('#groupbydataupdate').html("");
  $("#groupbyqueryupdate").empty();
  $('#Joinupdatecolumnname').empty();
  $('#Joinupdatecolumnname').selectpicker('refresh');
  $('#joinfromupdatetablelist').empty();
  $('#joinfromupdatecolumns').empty();
  $('#joinfromupdatecolumns').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>');
  $('#joinupdatecolumns').empty();
  $('#joinupdatecolumns').append('<option value="" selected disabled>{{ get_chache_selectcolumnerror }}</option>'); 
  $('#groupby_updatecolumnlist').empty();
  $('#groupby_updatecolumnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
  $('#groupby_updatecolumnlist').selectpicker('refresh')
  $('#aggregatefunctionsupdate').empty()
  $("#aggregatefunctionsupdate").selectpicker('refresh')
  $('#groupbyconditionupdate option[value=""]').prop('selected', true);
  $('#joinupdatecondition option[value="ON"]').prop('selected', true).removeAttr('disabled');
  $('#joinupdatecondition option[value="AND"]').prop('disabled', true);
  $('#joinupdateor').prop('disabled', true);
  $('#querycontent_readonlydata').val("");
  $('#fromjoin_updateexecute').val("")
  $('#outputupdate1').html("");
  $('[id=dynamicjoin]').remove();
  $("[id=where_optionupdate]").removeAttr('disabled');
  $("[id=carousel-item-main2]").remove();
  $("#carousel-item-main").addClass('active')
  $('#groupbyconditionupdate_error').remove()
  var joinquery_count = 10
  for(var i = 0; i < joinquery_count; i++){
      $("#joinqueryupdate"+i+"").remove()
      $("#joincolumnquery"+i+"").remove()
      $("#selectquery1update"+i+"").remove()
  }
  $("#samplecheckbox").trigger("click");
}
//---------------------- edit query end --------------------------------------------------------------

$('#rebackbutton').click(function(e){  
  $('#buttonrow').slideDown();
  $('#queryGrid').empty(); 
  $("#griddatashow").css("display","none");
  $("#queryselection").css("display","none");
});

/*-----------------------top previous button start --------------------------------------*/
$('#top_previousbutton').click(function(e){
  $('#queryselection').hide();
  $('#buttonrow').show();
});
/*-----------------------top previous button end--------------------------------------*/
/*-----------------------top previous button start --------------------------------------*/
$('#bottom_previousbutton').click(function(e){
  $('#queryselection').hide();
  $('#buttonrow').show();
});
/*-----------------------top previous button end--------------------------------------*/
</script>
<script>
$('#query_executed').click(function(e){  
  $('#queryselection').slideUp();
  $("#griddatashow").css("display","block");
});
</script>
<script>
  $( ".parenttable" ).on( "change", function() {
    $("#viewbutton").css("display","block");
    $("#createbutton").css("display","block");
    
    $("#createbutton").on("click",function(){
      var pagedetails = $("#pagename").val();
      var userid = $('#userid').val();
      var match = pagedetails.split(',')
      var projectid = (match[0]);
      var moduleid = (match[1]);
      var pageid = (match[2]); 
  
      var formbuilder_url = $('#formbuilderurl').val();
      $.ajax({
        type: 'POST',
        url: '/gettabbasedflow/',
        data: {projectid:projectid,
              pageid :pageid
        },
        success: function(data){
          if(data.status == 'Success'){
            if(data.status == 'Success'){
              if(data.tabpage_status == 1){
                if(data.tab_status == 1){
                window.open("http://192.168.16.77:4300/?pageid="+pageid+"&projectid="+projectid+"&moduleid="+moduleid+"&userid="+userid+"&tab=1","_blank");
               // window.open(formbuilder_url+"?pageid="+pageid+"&projectid="+projectid+"&moduleid="+moduleid+"&userid="+userid+"&tab=1","_blank");
                  }
                  else{
                    window.open("http://192.168.16.77:4300/?pageid="+pageid+"&projectid="+projectid+"&moduleid="+moduleid+"&userid="+userid+"&tab=0&tabpagestatus=1","_blank");
                    //window.open(formbuilder_url+"?pageid="+pageid+"&projectid="+projectid+"&moduleid="+moduleid+"&userid="+userid+"&tab=0&tabpagestatus=1","_blank");
                  }
  
              }else{
                if(data.tab_status == 1){
                window.open("http://192.168.16.77:4300/?pageid="+pageid+"&projectid="+projectid+"&moduleid="+moduleid+"&userid="+userid+"&tab=1","_blank");
                //window.open(formbuilder_url+"?pageid="+pageid+"&projectid="+projectid+"&moduleid="+moduleid+"&userid="+userid+"&tab=1","_blank");
                }
                else{
                  if(data.printscreen_status == null){
                  window.open("http://192.168.16.77:4300/?pageid="+pageid+"&projectid="+projectid+"&moduleid="+moduleid+"&userid="+userid+"&tab=0","_blank");
                  //window.open(formbuilder_url+"?pageid="+pageid+"&projectid="+projectid+"&moduleid="+moduleid+"&userid="+userid+"&tab=0","_blank");
                  }else{
                  var printscreenid = data.printscreen_status
                  window.open("http://192.168.16.77:4300/?pageid="+pageid+"&projectid="+projectid+"&moduleid="+moduleid+"&userid="+userid+"&tab=0&printscreen="+printscreenid+"","_blank");
                  //window.open(formbuilder_url+"?pageid="+pageid+"&projectid="+projectid+"&moduleid="+moduleid+"&userid="+userid+"&tab=0&printscreen="+printscreenid+"","_blank");
                  }
                  
                }
              }
             
            }
           
          }
        }
      })
    });
  
  });

  $('#tab_design').click(function(){
    $("#pagename").empty();
    $('#createbutton').hide()
  
    var projectid = $('#projectid').val();
    if($("#buildpage-tab").attr('class') == "nav-link active"){
      var showpage = $("#buildpage-tab").val()
    }if($("#buildpagequery-tab").attr('class') == "nav-link active"){
      var showpage = $("#buildpagequery-tab").val()
    }if($("#buildmanagequery-tab").attr('class') == "nav-link active"){
      var showpage = $("#buildmanagequery-tab").val()
    }
    $.ajax({
      type : 'POST',
      url :'/pagelist_data/',
      data : { projectid : projectid,showpage : showpage},
      success: function(data){
      $('#pagename').append('<option value="select page" disabled selected>--- Select page ---</option>');
        $.each(data.pagelist, function(index, value) {
          $("#pagename").append('<option value="' + value.projectid + ','+ value.moduleid + ',' + value.id + '">' + value.pagename + '</option>');
        });
      }
    });
  });

$('#buildpage-tab').click(function (){
  $('#top_previousbutton').trigger("click");
  $("#tab_design").trigger("click")
  ajax_gettablename()
})

$('#buildpagequery-tab').click(function (){
  $('#top_previousbutton').trigger("click");
  $("#tab_design").trigger("click")
  ajax_gettablename()
})

$('#buildmanagequery-tab').click(function (){
  $('#top_previousbutton').trigger("click");
  $("#tab_design").trigger("click")
  ajax_gettablename()
})
</script>
<script>
//----###################  select tablelist code start #################################3---------------

function ajax_gettablename(){
  $('#createbutton').hide()
  var urllist = window.location.pathname;
  var url=urllist.split('/');
  var projectid=url[2];
  var pagename =$('#pagename').val();
  var array = pagename.split(",");
  var pageid =(array[2]);
  $.ajax({
      type : 'POST',
      url :"/ajax_tanlename/",
      async: false,
      data:{'projectid':projectid,'pageid':pageid},
      success : function(data){
        $('#select_tablename').empty();
        $('#select_tablename').append('<option value="" disabled selected>{{ get_chache_selecttableerrormsg }}</option>');
        $.each(data.tablename, function(idx2,kvalue){ 
            $('#select_tablename').append('<option value="'+kvalue.id+'" data-aliases ="a">'+kvalue.tablename+'</option>');
        });
      }
  });
  var url=urllist.split('/');
  var projectid=url[2];
  var pagename =$('#pagename').val();
  var array = pagename.split(",");
  var pageid =(array[2]);
  var id =pageid
  $.ajax({
      type : 'POST',
      url :"/pagefromdatashow/",
      async: false,
      data:{'projectid':projectid,'id':id},
      success : function(data){
        if($("#buildpage-tab").attr('class') == "nav-link active"){
          $('#createbutton').show();
        }
        if($("#buildpagequery-tab").attr('class') == "nav-link active"){
                $('#createbutton').hide();
                $('#formdata').trigger("click");
        }
        if($("#buildmanagequery-tab").attr('class') == "nav-link active"){
                $('#createbutton').hide();
                $("#manageqdata").trigger("click");
        }
        
      },
      error : function(request, status, error) {
          var val = request.responseText;
          alert(val)
          }
    });
}
//----###################  select tablelist code end #################################3---------------
//-----------------select_tablename-----------------------------------------------------------
$("#selectpicker").change(function (){
  var key =  $("#selectpicker :selected").map((_, e) => e.value).get();
  var value =  $("#selectpicker :selected").map((_, e) => e.text).get();
  column_data = value
  for(var i = 0; i < value.length; i++){
    if(value[i] == "select all"){
      $('#selectpicker option').prop('selected', true);
      $("#selectpicker option:first-child" ).prop('selected', false);
      $('#selectpicker option[value ="select all"]').prop('selected', false); 
      $("#selectpicker").selectpicker("refresh")
      var value_all =  $("#selectpicker :selected").map((_, e) => e.text).get();
      column_data = value_all
    }
  }
  
  string = JSON.stringify(column_data);
  
  var urllist = window.location.pathname;
  var url=urllist.split('/');
  var projectid=url[2];
  var tableid =  $("#select_tablename").val();
  var aliasesname=$("#select_tablename :selected").data("aliases");
  $.ajax({
    url :"/ajax_option/",
    type : 'POST',
    async: false,
    data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname},
    dataType : 'json',
    success : function(data) {
      var val = $("#querycontent_data").val()
      var join_check = val.search("JOIN")
      if(join_check == -1){
        $("#selectquery").html(data.query1); 
        $('#selectquery2').html(data.query2)
      }    
      $('#groupby_columnlist').empty();
      $('#groupby_columnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
      $.each(data.string_val3, function(idx2,kvalue){ 
          $("#groupby_columnlist").append('<option value="'+aliasesname+'.'+kvalue+'">'+aliasesname+'.'+kvalue+'</option>');
        });
    }
  });
  $('#groupby_columnlist').selectpicker('refresh')
  var q = $('#queryset').text();
    var ans1 = $.trim(q.replace(/\s/g, ' '))
    var ans = ans1.replace(/ +/g, " ")
    $('#exampleFormControlTextarea1').val(ans);     
    var grp_con = $("#groupbycondition").val()
    if(grp_con != null){
      $('#groupbycondition').trigger("click")
    }
});
$("#selectpicker1").change(function (){
  var key =  $("#selectpicker1 :selected").map((_, e) => e.value).get();
  var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();       
  column_data = value 
  string = JSON.stringify(column_data);
  
  var urllist = window.location.pathname;
  var url=urllist.split('/');
  var projectid=url[2];
  var tableid =  $("#update_tablename").val();
  var aliasesname=$("#update_tablename :selected").data("aliases");
  $.ajax({
    url :"/ajax_option/",
    type : 'POST',
    async: false,
    data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname},
    dataType : 'json',
    success : function(data) {
      
      var val = $("#querycontent_data").val()
      var join_check = val.search("JOIN")
      if(join_check == -1){
        $("#selectqueryupdate").html(data.query); 
      }    
      $('#groupby_updatecolumnlist').empty();
      $('#groupby_updatecolumnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
      $.each(data.string_val3, function(idx2,kvalue){ 
          $("#groupby_updatecolumnlist").append('<option value="'+aliasesname+'.'+kvalue+'">'+aliasesname+'.'+kvalue+'</option>');
        });
    }
  });
  $('#groupby_updatecolumnlist').selectpicker('refresh')
});

$("#Joinupdatecolumnname").change(function (){
  $("#selectpicker1").trigger("change");
  var key =  $("#Joinupdatecolumnname :selected").map((_, e) => e.value).get();
  var value =  $("#Joinupdatecolumnname :selected").map((_, e) => e.text).get();
  column_data = value 
  string = JSON.stringify(column_data);
  
  var urllist = window.location.pathname;
  var url=urllist.split('/');
  var projectid=url[2];
  var tableid =  $("#joinupdatetables").val();
  var aliasesname=$("#joinupdatetables :selected").data("aliases");
  $.ajax({
    url :"/ajax_option/",
    type : 'POST',
    async: false,
    data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname},
    dataType : 'json',
    success : function(data) {
      $.each(data.string_val3, function(idx2,kvalue){ 
          $("#groupby_updatecolumnlist").append('<option value="'+aliasesname+'.'+kvalue+'">'+aliasesname+'.'+kvalue+'</option>');
        });
    }
  });
  $('#groupby_updatecolumnlist').selectpicker('refresh') 
});

function getval(){
  var urllist = window.location.pathname;
  var url=urllist.split('/');
  var projectid=url[2];
  var tableid =$("#select_tablename :selected").val();
  var aliasesname=$("#select_tablename :selected").data("aliases");
  
  $.ajax({
    type : 'POST',
    url :"/ajax_option/",
    async: false,
    data:{'projectid':projectid,'tableid':tableid,'string':1,'aliasesname':aliasesname},
    dataType : 'json',
    success : function(res) {
        $("#selectquery").html(res.query);
        $("#joinsection").show();
      }
    });

  $.ajax({
      url :"/column_list/",
      type : 'POST',
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data) {
        $('#selectpicker').empty();
        $('#selectpicker').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
        $('#selectpicker').append('<option value="select all">select all</option>');
        $('#selectpicker').append('<option value="id" selected="true">id</option>');
        $('#selectpicker').append('<option value="status">status</option>');
        $('#selectpicker').append('<option value="createdon">createdon</option>');
        $('#selectpicker').append('<option value="createdby">createdby</option>');
        $('#selectpicker').append('<option value="modifiedon">modifiedon</option>');
        $('#selectpicker').append('<option value="modifiedby">modifiedby</option>');
        $.each(data.get_columnname, function(idx2,kvalue) { 
          $('#selectpicker').append('<option value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
          $("#columnquery").html(data.columnquery);
        });
        $('#aggregatefunctions').empty();
        $('#aggregatefunctions').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
        $.each(data.get_columnname, function(idx2,kvalue) { 
          $('#aggregatefunctions').append('<option value="'+ aliasesname +'.'+kvalue.columnname+'">'+ aliasesname +'.'+kvalue.columnname+'</option>');
        });
      }
  });
  $('#selectpicker').selectpicker('refresh')
  $('#aggregatefunctions').selectpicker('refresh')
  $.ajax({
    type : 'POST',
    url :"/ajaxwhere_tablelist/",
    async: false,
    data:{'projectid':projectid,'tableid':tableid},
    dataType : 'json',
    success : function(data) {
      $('#select').empty();
      $('#select').append('<option value="" disabled selected>{{ get_chache_selecttableerrormsg }}</option>');
      $.each(data.table_data, function(idx2,kvalue) { 
        $('#select').append('<option value="'+kvalue.id+'">'+kvalue.tablename+'</option>');
      });
    }
  });
//------------group_bytable list----------------------------------------------
  $.ajax({
        type : 'POST',
        url :"/ajaxwhere_tablelist/",
        async: false,
        data:{'projectid':projectid,'tableid':tableid},
        dataType : 'json',
        success : function(data) {
          $('#groupby_table').empty();
          $('#groupby_table').append('<option value="Select table">{{ get_chache_selecttableerrormsg }}</option>');
          $.each(data.table_data, function(idx2,kvalue) { 
            $('#groupby_table').append('<option value="'+kvalue.id+'">'+kvalue.tablename+'</option>');
          });
        }
    });


//---------------------------join_query_linktable----------------------------------------


var pagename =$('#pagename').val();
var array = pagename.split(",");
var pageid =(array[2]);  
   
    $.ajax({
          type : 'POST',
          url :"/ajax_tanlename/",
          async: false,
          data:{'projectid':projectid,'pageid':pageid},
          success : function(data) {
            $('#jointables').empty();
            $('#jointables').append('<option value=""selected disabled>{{ get_chache_selectjointableerror }}</option>');
            $.each(data.tablename, function(idx2,kvalue) { 
              $('#jointables').append('<option value="'+kvalue.id+'" data-aliases ="a">'+kvalue.tablename+'</option>');
            });
          }
      });   
  }
  //------------------jointables--------------------------------------------------
  
  $("#jointables").click(function(){
    var tableid = $("#jointables :selected").val();
    var tablename = $("#jointables :selected").text();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
  
    $.ajax({
      url :"/column_list/",
      type : 'POST',
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data) {
        $('#joincolumns').empty();
        $('#joincolumns').append('<option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>');
        $('#joincolumns').append('<option data-datatype="serial" value="id">id</option>');
        $('#joincolumns').append('<option data-datatype="int4" value="status">status</option>');
        $('#joincolumns').append('<option value="createdon">createdon</option>');
        $('#joincolumns').append('<option value="createdby">createdby</option>');
        $('#joincolumns').append('<option value="modifiedon">modifiedon</option>');
        $('#joincolumns').append('<option value="modifiedby">modifiedby</option>');   
        $.each(data.get_columnname, function(idx2,kvalue) {   
          $('#joincolumns').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
        }); 
        
        $('#Joincolumnname').empty();
        $('#Joincolumnname').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
        $('#Joincolumnname').append('<option value="select all">select all</option>');
        $('#Joincolumnname').append('<option value="id">id</option>');
        $('#Joincolumnname').append('<option value="status">status</option>');
        $('#Joincolumnname').append('<option value="createdon">createdon</option>');
        $('#Joincolumnname').append('<option value="createdby">createdby</option>');
        $('#Joincolumnname').append('<option value="modifiedon">modifiedon</option>');
        $('#Joincolumnname').append('<option value="modifiedby">modifiedby</option>'); 
        $.each(data.get_columnname, function(idx2,kvalue) {   
          $('#Joincolumnname').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
        }); 
      }
    }); 
    $('#Joincolumnname').selectpicker('refresh')
  });
  //----------------parent_tableappend------------------------------------------------
  $('#select_tablename').click(function(){
      var urllist = window.location.pathname;
      var url=urllist.split('/');
      var projectid=url[2];
      var tableid = $("#select_tablename :selected").val();
      
      $.ajax({
        type : 'POST',
        url :"/ajaxwhere_tablelist/",
        async: false,
        data:{'projectid':projectid,'tableid':tableid},
        dataType : 'json',
        success : function(data) {
          $('#joinfromtablelist').empty();
          $('#joinfromtablelist').append('<option value="" disabled>{{ get_chache_selectjointableerror}}</option>');
          $.each(data.table_data, function(idx2,kvalue) { 
            $('#joinfromtablelist').append('<option value="'+kvalue.id+'" data-aliases ="a">'+kvalue.tablename+'</option>');
          });
        }
      });
    })
  
  $("#joinfromtablelist").click(function(){
    var tableid = $("#joinfromtablelist :selected").val();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    
  
    $.ajax({
      url :"/column_list/",
      type : 'POST',
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data) {
        $('#joinfromcolumns').empty();
        $('#joinfromcolumns').append('<option value disabled selected>{{ get_chache_selectcolumnerror }}</option>');
        $('#joinfromcolumns').append('<option value="id">id</option>');
        $('#joinfromcolumns').append('<option value="status">status</option>');
        $('#joinfromcolumns').append('<option value="createdon">createdon</option>');
        $('#joinfromcolumns').append('<option value="createdby">createdby</option>');
        $('#joinfromcolumns').append('<option value="modifiedon">modifiedon</option>');
        $('#joinfromcolumns').append('<option value="modifiedby">modifiedby</option>');   
        
        $.each(data.get_columnname, function(idx2,kvalue) { 
          $('#joinfromcolumns').append('<option value="'+kvalue.columnname+'">'+kvalue.columnname+'</option>');
        });   
      }
    });
    
  });
  
  //-------------------get_joincolum_values---------------------------------------
  $('#joincolumns').click(function(){
    var tableid = $("#jointables :selected").text();
  
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    var column_id = $("#joincolumns :selected").text();
    
    $.ajax({
      type:'POST',
      url:"/join_columnvalues/",
      async:false,
      data:{'projectid':projectid,'tableid':tableid,'column_id':column_id},
      datatype:'json',
      success : function(data) {
        if(column_id =='status'){
          $('#joincolumnvalues').empty();
          $('#joincolumnvalues').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
          $.each(data.status_values, function(idx21,value) { 
             $('#joincolumnvalues').append('<option value="'+value+'">'+value+'</option>');
          });
        
        }else{
          $('#joincolumnvalues').empty();
          $('#joincolumnvalues').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
          $.each(data.column_values, function(idx2,kvalue) { 
            $.each(kvalue, function(idx21,kvalue1) { 
              $('#joincolumnvalues').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
            });
          });
        }
      }
    });
    $('#joincolumnvalues').selectpicker('refresh')
  });
  
  $("#join_condition_col").click(function(){
    $('#joincheck').prop('checked', true);
    $("#joincolumnvalues_data").show();
  });
  
  $('#joincheck').click(function(){
    var datatype = $("#joincolumns :selected").data("datatype");
    data =$('#joincheck').val()
   
    if($(this).is(":checked")){
      $("#joincolumnvalues_data").show();
      $("#joininput_data").hide();
    }else{
      $("#joincolumnvalues_data").hide();
      $('#from_joincheck').after('<div class="col-md-3" id ="joininput_data"><label>Column values</label><input type="text" id="text_joininputtypes" name="varchartext" required="true"></div>')
      if((datatype == "int")||(datatype =="int4")||(datatype =="int8")||(datatype =="bigint") || (datatype =="float4") || (datatype =="float8") ||(datatype =="decimal") ||(datatype =="serial") ){
        $("#text_joininputtypes").prop("type", "number");
      }
      else{
        $("#text_joininputtypes").prop("type", "text");
      }
    }
  });
 
  $("#join_check_condition").click(function(){
    var joincondition =$("#joincondition :selected").val();
    var join_check_condition =$("#join_check_condition :selected").val();
    $("#joinfromtablelist").trigger("click")
    if(joincondition =='ON'){
      $("#from_table_show_data").show();
      $("#from_column_show_data").show();
      $("#from_joincheck").hide();
      $("#joincolumnvalues_data").hide();
      $("#joininput_data").hide();
    }else{
      $('#joincheck').prop('checked', true);
      $("#from_table_show_data").hide();
      $("#from_column_show_data").hide();
      $("#joininput_data").hide();
      $("#from_joincheck").show();
      $("#joincolumnvalues_data").show();
    } 
  });
  
  $("#joindynamic").click(function(){
    data =$("#joindynamic").val()
    var datatype = $("#joincolumns :selected").data("datatype");
    var joincondition =$("#joincondition :selected").val();
    
    if($(this).is(":checked")&&(joincondition !='AND')){
      $("#from_table_show_data").show();
      $("#from_column_show_data").show();
      $("#fromjoin_condition_col").show();
      $("#from_joincheck").hide();
      $("#joincolumnvalues").hide(); 
      $("#joincolumnvalues_data").hide(); 
    }else{
      $("#from_table_show_data").hide();
      $("#from_column_show_data").hide();
      $("#from_joincheck").show();
      $('#joinfromtablelist option[value =""]').prop('selected', true);
      $('#joinfromcolumns').empty()
      var values=$('#joincheck').prop('checked', true);
      if($("#joincheck").is(":checked")){
        $("#joincolumnvalues_data").show();
        $("#joininput_data").hide();
      }else{
        $("#joininput_data").show();
        $("#joincolumnvalues_data").hide();
      } 
    }
  });
  
  $("#joincondition").click(function(){
    var joincolname = $("#Joincolumnname :selected").map((_, e) => e.value).get();
    var joincolname_len = (joincolname.length);
    $('#join_columnnames_error').remove();
    if(joincolname_len == 0){
      var join_columnnames_errormsg = "please select columns"
      join_columnnames_error = join_columnnames_errormsg
      $('#Joincolumnname').parent().after("<span id='join_columnnames_error' class='error_msg'>"+join_columnnames_error+"</span>");
      $('#joincondition option[value="select condition"]').prop('selected', true);
      return false
    }
  });

  $("#joinupdatecondition").click(function(){
    var joincolname = $("#Joinupdatecolumnname :selected").map((_, e) => e.value).get();
    var joincolname_len = (joincolname.length);
    $('#join_columnupdatenames_error').remove();
    if(joincolname_len == 0){
      var join_columnnames_errormsg = "please select columns"
      join_columnnames_error = join_columnnames_errormsg
      $('#Joinupdatecolumnname').parent().after("<span id='join_columnupdatenames_error' class='error_msg'>"+join_columnnames_error+"</span>");
      $('#joinupdatecondition option[value="select condition"]').prop('selected', true);
      return false
    }
  });

  

  $("#joincolumn_go").click(function(){
      var jointablename = $("#jointables :selected").text();
      var joincolumns =$("#joincolumns :selected").text();
      var joinfromtable =$("#joinfromtablelist :selected").text();
      var joinfromcolumns =$("#joinfromcolumns :selected").val();
      var joincondition =$("#joincondition :selected").val();
      var join_condition_col =$("#join_condition_col :selected").text();
      var join_check_condition =$("#join_check_condition :selected").val();
      var colum_valus1 = $("#joincolumnvalues :selected").map((_, e) => e.value).get();
      var colum_valus= JSON.stringify(colum_valus1);
      var column_datatype = $("#joincolumns :selected").data("datatype");
      var jointypes = $('#jointypes').val();
      var colum_valus_text =$("#text_joininputtypes").val();
      var from_joininput_text=$("#from_joininput_text").val();
      var aliasesname=$("#joinfromtablelist :selected").data("aliases");
      colum_valus_len=(colum_valus1.length)
      var err_msg = $('#join_condition_error').remove();
      var fromtablevalues =$("#fromjoin_execute").val();
      var get_aliasesname=$(" #jointables :selected").data("aliases");
      var joinfromcoltype =$("#joinfromcolumns :selected").data("datatype");
      
      
      $('#join_condition_error').remove();
      $('#join_tablename').remove();
      $('#join_columnnames').remove();
      $('#join_check_condition_error').remove();
      $('#joinfromtable_error').remove();
      $('#joinfromcolumns_error').remove();
      $('#jointypes_error0').remove();
      var ermsg = 0;
      var jointypes_errormsg ="{{ get_chache_jointypeserror }}"
      if(jointypes =="{{ get_chache_selectjoineerror }}" || jointypes == null){
      jointypes_error = jointypes_errormsg 
      $('#jointypes').after("<span id='jointypes_error0' class='error_msg'>"+jointypes_error+"</span>");
      ermsg = 1;
      }
      var join_tablenameerrormsg ="{{ get_chache_jointablenameerrormsg }}"
      if(jointablename =="{{ get_chache_selectjointableerror }}"){
        join_tablename = join_tablenameerrormsg
        $('#jointables').after("<span id='join_tablename' class='error_msg'>"+join_tablename+"</span>");
        ermsg = 1;
      }
      var joincloumserrormsg ="{{ get_chache_joincolumnserrormsg }}"
      if(joincolumns =="{{ get_chache_selectcolumnerror }}"){
        join_columnnames= joincloumserrormsg
        $('#joincolumns').after("<span id='join_columnnames' class='error_msg'>"+join_columnnames+"</span>");
        ermsg = 1;
      }
      var joincheckconderrormsg ="{{ getcachejoincheckconditionerrormsg }}"
      if((join_check_condition =="{{ get_chache_selectconditionerror }}")||(join_check_condition =="sélectionner l'état")){
        join_check_condition_error= joincheckconderrormsg
        $('#join_check_condition').after("<span id='join_check_condition_error' class='error_msg'>"+join_check_condition_error+"</span>");
        ermsg = 1;
      }
      var joinfromcolumns_errormsg ="{{ get_chache_joinfromcolumnserrormsg }}"
      if(joinfromcolumns == "" && colum_valus_len == 0){
        joinfromcolumns_error= joinfromcolumns_errormsg
        $('#joinfromcolumns').after("<span id='joinfromcolumns_error' class='error_msg'>"+joinfromcolumns_error+"</span>");
        ermsg = 1;
      }
      var join_condition_errormsg ="{{ get_chache_joinconditionerrormsg }}"
      if(((joincondition =="ON") || (joincondition =='AND') || (joincondition =='OR'))&&(colum_valus_len > 1)&&((join_check_condition =='=')||(join_check_condition =='<>')||(join_check_condition =='!=')||(join_check_condition =='>')||(join_check_condition =='>=')||(join_check_condition =='<=')||(join_check_condition =='<'))){
        join_condition_error = join_condition_errormsg
        $('#joincolumnvalues').after("<span id='join_condition_error' class='error_msg'>"+join_condition_error+"</span>");
        ermsg = 1;
      }
      var joinfromtable_errormsg ="{{ get_chache_joinfromtableerrormsg }}"
      if(joinfromtable == "" && colum_valus_len == 0){
        joinfromtable_error= joinfromtable_errormsg
        $('#joinfromtablelist').after("<span id='joinfromtable_error' class='error_msg'>"+joinfromtable_error+"</span>");
        ermsg = 1;
      }
      if(ermsg){
        return false
      }
  
      if($("#joindynamic").is(":checked")){
        if((joincondition =='ON')&&(joincolumns !="{{ get_chache_selectcolumnerror }}")&&(join_check_condition !="{{ get_chache_selectconditionerror }}")&&(joinfromtable !="{{ get_chache_selecttableerrormsg }}")&&(joinfromcolumns !="{{ get_chache_selectcolumnerror }}") &&(jointablename !="{{ get_chache_selectjointableerror }}")){
          var get_aliasesname=$(" #jointables :selected").data("aliases");
          $('#output1').html(function(i, val) { return val*1+1 });
          get_randomnum =$("#output1").html();
          aliasesname_col=(get_aliasesname + get_randomnum)
          var alisejoin =$('#joincolumnsalisedata').html(aliasesname_col)
        }
      }
      else{
        if((joincondition =='ON')&&(joincolumns !="{{ get_chache_selectcolumnerror }}")&&(join_check_condition !="{{ get_chache_selectconditionerror }}")){
          var get_aliasesname=$(" #jointables :selected").data("aliases");
          $('#output1').html(function(i, val) { return val*1+1 });
          get_randomnum =$("#output1").html();
          aliasesname_col=(get_aliasesname + get_randomnum)
          var alisejoin =$('#joincolumnsalisedata').html(aliasesname_col)
        }
      }
  
    $.ajax({
      type:'POST',
      url:"/join_columnquery/",
      data:{'jointablename':jointablename,'joincolumns':joincolumns,'joinfromtable':joinfromtable,'joinfromcolumns':joinfromcolumns,'joincondition':joincondition,'join_condition_col':join_condition_col,'join_check_condition':join_check_condition,'colum_valus':colum_valus,'column_datatype':column_datatype,'colum_valus_text':colum_valus_text,'fromtablevalues':fromtablevalues,'aliasesname':aliasesname,'aliasesname_col':aliasesname_col,'joinfromcoltype':joinfromcoltype},
      success : function(data) {
        var fromtablevaluesend=fromtablevalues+' '+data.query;
        $("#fromjoin_execute").val(fromtablevaluesend);
        var fromtablevaluesafter =$("#fromjoin_execute").val();
        if(fromtablevaluesafter.length){
          $("#joinand").show();
          $("#joinor").show();
          $('#joinon').prop('disabled', 'disabled')
        }
      }
    });
    $("#joincondition").val([]);
    $("#joinfromtablelist").val([]);
    $("#joinfromcolumns").val([]);
    $("#join_condition_col").val([]);
    $("#text_joininputtypes").val([]);
    $("#joincolumns").val([]);
    $("#join_check_condition").val([]);
    $("#joincolumnvalues").val([]); 
    //$("#Joincolumnname").val([]);
  
    var aliasesname_colval=aliasesname_col
    var tableid = $("#jointables :selected").val();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
  
    $.ajax({
      url :"/column_list/",
      type : 'POST',
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data) {
        //$('#aggregatefunctions').empty();
        $.each(data.get_columnname, function(idx2,kvalue) {   
          $('#aggregatefunctions').append('<option value="'+aliasesname_colval+'.'+kvalue.columnname+'">'+aliasesname_colval+'.'+kvalue.columnname+'</option>');
        }); 
      }
    }); 
    $('#aggregatefunctions').selectpicker('refresh')
  
  });
 
  $("#join_go").click(function(){
    var jointypes = $("#jointypes :selected").val();
    var jointablename = $("#jointables :selected").text();
    var joinfromsection = $('#fromjoin_execute').val();
    var fromtablevalues =$("#fromjoin_execute").val();
    var joinquery = $('#joinquery').val();

    $('#jointypes_error').remove();
    $('#joinfromsection_error').remove();
    var ermsg = 0;
    var jointypes_errormsg ="{{ get_chache_jointypeserror }}"
    if(jointypes =="{{ get_chache_selectjoineerror }}"){
      jointypes_error = jointypes_errormsg
      $('#jointypes').after("<span id='jointypes_error' class='error_msg'>"+jointypes_error+"</span>");
      ermsg = 1;
    }
    var joinfromsection_errormsg = "{{ get_chache_joinfromsectionerror }}"
    if(joinfromsection == ''){
      joinfromsection_error = joinfromsection_errormsg
      $('#fromjoin_execute').after("<span id='joinfromsection_error' class='error_msg'>"+joinfromsection_error+"</span>");
      ermsg = 1;
    }
    if(ermsg){
        return false
      }
    if((joinfromsection)&&(jointypes !="{{ get_chache_selectjoineerror }}")){
      var get_aliasesname=$("#jointables :selected").data("aliases");
      $('#output').html(function(i, val) { return val*1+1 });
      get_randomnum =$("#output").html();
      aliasesname_val=(get_aliasesname + get_randomnum)
    }
    
    if((fromtablevalues.length ==0)|| jointypes){
      $("#joinon").prop('disabled', false);
      $("#joinand").hide();
      $("#joinor").hide();
    }else{
      $('#joinon').prop('disabled', 'disabled')
    }
    $.ajax({
      type:'POST',
      url:"/join_query/",
      async:false,
      data:{'jointypes':jointypes,'jointablename':jointablename,'joinfromsection':joinfromsection,'aliasesname_val':aliasesname_val},
      datatype:'json',
      success : function(data){
        $("#joinquery").append(data.query);
      }
    });
    $("#jointypes").val([]);
    $("#jointables").val([]);
    $( "#fromjoin_execute" ).val([]);
    $( "#joinquery").val([]);
    

    var value =  $("#selectpicker :selected").map((_, e) => e.text).get();
    string = JSON.stringify(column_data);
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    var tableid =  $("#select_tablename").val();
    var jointableselect_column_val =  $("#Joincolumnname :selected").map((_, e) => e.text).get();
    var joinselectcolumn_name= JSON.stringify(jointableselect_column_val);
    var aliasesname=$("#select_tablename :selected").data("aliases");
    var get_randomnum =$("#column_alisename").html();
    var joincolmun_aliasesname =aliasesname_val

    $( "#Joincolumnname").val([]);
    $('#Joincolumnname').selectpicker('refresh')

    $.ajax({
      url :"/ajax_option/",
      type : 'POST',
      async: false,
      data:{'projectid':projectid,'tableid':tableid,'string':string,'aliasesname':aliasesname,'joinselectcolumn_name':joinselectcolumn_name,'joincolmun_aliasesname':joincolmun_aliasesname},
      dataType : 'json',
      success : function(data){
        $("#selectquery").append(data.query2);
        // $("#selectquery1").append(data.query2);
        $("#selectquery2").html(data.query3);          
      }
    });
    $.ajax({
      url :"/ajax_option/",
      type : 'POST',
      async: false,
      data:{'projectid':projectid,'tableid':tableid,'string':joinselectcolumn_name,'aliasesname':aliasesname},
      dataType : 'json',
      success : function(data) {
        var joincolmun_aliasesname =aliasesname_val
        $.each(data.string_val3, function(idx2,kvalue){ 
            $("#groupby_columnlist").append('<option value="'+joincolmun_aliasesname+'.'+kvalue+'">'+joincolmun_aliasesname+'.'+kvalue+'</option>');
          });
        }
    });

    $('#groupby_columnlist').selectpicker('refresh')
    var q = $('#queryset').text();
    var ans1 = $.trim(q.replace(/\s/g, ' '))
    var ans = ans1.replace(/ +/g, " ")
    $('#exampleFormControlTextarea1').val(ans);     
    var grp_con = $("#groupbycondition").val()
    if(grp_con != null){
      $('#groupbycondition').trigger("click")
    }
  });
  
  //--------------------select_wherecondition-----------------------------------------
  $("#select").change(function(){
    var tableid =  $("#select :selected").val();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
  
    var aliasesname=$("#select_tablename :selected").data("aliases");
   
    $.ajax({
      type:'POST',
      url:"/ajaxwhere_tablelist/",
      async:false,
      data:{'projectid':projectid,'tableid':tableid},
      datatype:'json',
      success : function(data){ 
        $('#select_columns').empty();
        $('#select_columns').append('<option value="" disabled selected>{{ get_chache_selectcolumnerror }}</option>');
        $('#select_columns').append('<option data-datatype ="serial" value="">id</option>');
        $('#select_columns').append('<option data-datatype ="int4" value="">status</option>');
        $('#select_columns').append('<option value="createdon">createdon</option>');
        $('#select_columns').append('<option value="createdby">createdby</option>');
        $('#select_columns').append('<option value="modifiedon">modifiedon</option>');
        $('#select_columns').append('<option value="modifiedby">modifiedby</option>'); 
        $.each(data.where_get_columnname, function(idx2,kvalue){ 
          $('#select_columns').append('<option data-datatype="'+kvalue.column_datatype+'" value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
        });
      }
    });
  });
  
  
  $("#select_columns").click(function(){
    $('#defaultvalues').prop('checked', true);
    var tableid =  $("#select :selected").val();
    var column_id=  $("#select_columns :selected").val();
    var column_name=  $("#select_columns :selected").text();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    
    dynamicfunction(projectid,tableid,column_id);
    $("#get_columvalues").show();      
  });
    
  $('#defaultvalues').click(function(){
    var datatype = $("#select_columns :selected").data("datatype");
    var tableid =  $("#select :selected").val();
    var column_id=  $("#select_columns :selected").val();
  
    var column_name=  $("#select_columns :selected").text();
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    if($(this).is(":checked")){
      $("#get_columvalues").show();
      $("#defaultinputbox").hide();
      dynamicfunction(projectid,tableid,column_id);

    }else{
      $("#get_columvalues").hide();
      $('#dynamic').prepend('<div class="col-md-3" id="defaultinputbox"><label>Column values:</label><input type="text" id="text_select_columnsvalues" name="varchartext" required="true"></div>')
      
      if((datatype == "int")||(datatype =="int4")||(datatype =="int8")||(datatype =="bigint") || (datatype =="float4") || (datatype =="float8") ||(datatype =="decimal") ){
        $("#text_select_columnsvalues").prop("type", "number");
      }
      else{
        $("#text_select_columnsvalues").prop("type", "textdisabled");
      }
    }
  });
  
  function dynamicfunction(projectid,tableid,column_id){
    var tablename =  $("#select :selected").text();
    var column_name=  $("#select_columns :selected").text();
  
    $.ajax({
        type:'POST',
        url:"/ajaxwhere_columndata/",
        async:false,
        data:{'projectid':projectid,'tableid':tableid,'column_id':column_id,'column_name':column_name,'tablename':tablename},
        datatype:'json',
        success : function(data) {
          if(column_name =='status'){
            $('#select_columnsvalues').empty();
            $('#select_columnsvalues').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
            $.each(data.status_values, function(idx21,value){ 
               $('#select_columnsvalues').append('<option value="'+value+'">'+value+'</option>');
            });
          }else{
          $('#select_columnsvalues').empty();
          $('#select_columnsvalues').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>')
            $.each(data.get_columnvalues, function(idx2,kvalue){ 
              $.each(kvalue, function(idx21,kvalue1){ 
                $('#select_columnsvalues').append('<option value="'+kvalue1+'">'+kvalue1+'</option>');
              });
            });
          }
        }
    });
    $('#select_columnsvalues').selectpicker('refresh')
  }
  
  $("#condition_executed").click(function(){
      var checkcondition1 =$("#where_check_condition").val();
      var column_datatype = $("#select_columns :selected").data("datatype");
      var tableid =  $("#select :selected").val();
      var column_id=  $("#select_columns :selected").val();
      var tablename =  $("#select :selected").text();
      var column_name=  $("#select_columns :selected").text();
  
      var urllist = window.location.pathname;
      var url=urllist.split('/');
      var projectid=url[2];
      var key =  $("#select_columnsvalues :selected").map((_, e) => e.value).get();
      var value =  $("#select_columnsvalues :selected").map((_, e) => e.text).get();
      column_data = value
      colum_valus =(column_data.length)
      var bla = $('#text_select_columnsvalues').val();
      var condition=  $("#wherecondition :selected").val();
      var aliasesname=$("#select_tablename :selected").data("aliases");
      var columndatas1=$("#select_columnsvalues :selected").map((_, e) => e.value).get();
      var columndatas= JSON.stringify(columndatas1);
      var columndatastext=$('#text_select_columnsvalues').val();

      $('#tablename_error').remove();
      $('#column_name_error').remove();
      $('#checkcondition_error').remove();
      $('#condition_error').remove();
      
      var ermsg = 0;
      var wheretable_errormsg ="{{ get_chache_jointablenameerrormsg }}"
      if(tablename =="{{ get_chache_selecttableerrormsg }}"){
        tablename_error = wheretable_errormsg;
        $('#select').after("<span id='tablename_error' class='error_msg'>"+tablename_error+"</span>");
        ermsg = 1;
      }
      var columnname_errormsg = "{{ get_chache_joincolumnserrormsg }}"
      if(column_name =="{{ get_chache_selectcolumnerror }}"){
        var column_name_error = columnname_errormsg;
        $('#select_columns').after("<span id='column_name_error' class='error_msg'>"+column_name_error+"</span>");
        ermsg = 1;
      }
      var checkconditionerrormsg = "{{ get_chache_wherecheckconditionerrormsg }}"
      if((checkcondition1 =="{{ get_chache_selectconditionerror }}")||(checkcondition1 =="sélectionner l'état")){
        checkcondition_error = checkconditionerrormsg
        $('#where_check_condition').after("<span id='checkcondition_error' class='error_msg'>"+checkcondition_error+"</span>");
        ermsg = 1;
      }
      if(ermsg){
        return false
      }
      
      if (checkcondition1 ==null){
          checkcondition =1    
      }else{
        checkcondition=checkcondition1 
      }
      var conditionerrormsg ="{{ get_chache_wherecheckequal }}"
      if(((condition =="where") || (condition =='AND') || (condition =='OR'))&&(colum_valus > 1)&&((checkcondition =='=')||(checkcondition =='<>')||(checkcondition =='!=')||(checkcondition =='>')||(checkcondition =='>=')||(checkcondition =='<=')||(checkcondition =='<'))){
        var condition_error = conditionerrormsg
        $('#select_columnsvalues').after("<span id='condition_error' class='error_msg'>"+condition_error+"</span>");
      }
      else{
        var multiselect=$("#selectpicker :selected").text();
        $.ajax({
          type:'POST',
          url:"/ajaxwhere_columndataviews/",
          async:false,
          data:{'projectid':projectid,'tableid':tableid,'column_id':column_id,'columndatas':columndatas,'checkcondition':checkcondition,'condition':condition,'aliasesname':aliasesname,'columndatastext':columndatastext,'column_datatype':column_datatype,'tablename':tablename,'column_name':column_name},
          datatype:'json',
          success : function(data) {
            if((condition =="where") &&(condition.length ==0)){
                $("#wherequery").html(data.query);
              }
            else{
              $("#wherequery").append(data.query);
              $("#or_option").show();
              $("#and_option").show();
              $('#where_option').prop('disabled', 'disabled')
            }
          }
        });
        $("#wherecondition").val([]);
        $("#select").val([]);
        $("#select_columns").val([]);
        $("#where_check_condition").val([]);
        $("#defaultvalues").val([]);
        $("#select_columnsvalues").val([]);
        $("#text_select_columnsvalues").val('');
        $("#multi_values").val([]);
       }
    });
  //------------------group_by_columnlist--------------------------------------------
  $("#groupby_columnlist").change(function(){
    var key =  $("#groupby_columnlist :selected").map((_, e) => e.value).get();
    var value =  $("#groupby_columnlist :selected").map((_, e) => e.text).get();
    var column_data = value
    var string = JSON.stringify(column_data);
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    if (key.length == 0){
      $("#groupbyquery").empty();
      $("#orderby_hideshow").show();
      $("#limits_hideshow").show();
      $("#groupbyquery").empty();
    }
    $.ajax({
      type:'POST',
      url:"/groupby_query/",
      async:false,
      data:{'projectid':projectid,'string':string},
      datatype:'json',
      success : function(data) {
      if(key.length != 0){
        $("#groupbyquery").html(data.query);
        $("#orderby_hideshow").hide();
        $("#limits_hideshow").hide();
      }else{
        $("#orderby_hideshow").show();
        $("#limits_hideshow").show();
        $("#groupbyquery").empty();
      }
    }
    });
    var q = $('#queryset').text();
    var ans = $.trim(q.replace(/\s/g, ' '))
    var finalquery = ans.replace(/ +/g, " ")
    $('#exampleFormControlTextarea1').val(finalquery);
  });
  $("#groupby_updatecolumnlist").change(function(){
    var key =  $("#groupby_updatecolumnlist :selected").map((_, e) => e.value).get();
    var value =  $("#groupby_updatecolumnlist :selected").map((_, e) => e.text).get();
    var column_data = value
    var string = JSON.stringify(column_data);
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    if (key.length == 0){
      $("#groupbyqueryupdate").empty();
    }
    $.ajax({
      type:'POST',
      url:"/groupby_query/",
      async:false,
      data:{'projectid':projectid,'string':string},
      datatype:'json',
      success : function(data) {
        if(key != [] || key != ""){
          $("#groupbyqueryupdate").html(data.query);
          $("#orderby_updatehideshow").hide();
          $("#limits_updatehideshow").hide();
        }else{
          $("#orderby_updatehideshow").show();
          $("#limits_updatehideshow").show();
          $("#groupbyqueryupdate").empty();
        }
      }
    });
    var q = $('#querysetupdate').text();
    var ans = $.trim(q.replace(/\s/g, ' '))
    var finalquery = ans.replace(/ +/g, " ")
    $('#querycontent_data').val(finalquery);

  });
  
  $('#aggregatefunctionsupdate').change(function(){
    var groupbycond_val = $('#groupbyconditionupdate').val()
    if(groupbycond_val == null){
      var columnname_errormsg = "Please select groupby condition"
      var groupbycond_val_error = columnname_errormsg;
      $('#groupbyconditionupdate_error').remove()
      $('#groupbyconditionupdate').after("<span id='groupbyconditionupdate_error' class='error_msg'>"+groupbycond_val_error+"</span>");
        $("#aggregatefunctionsupdate option:selected").prop("selected", false)
        $("#aggregatefunctionsupdate").selectpicker("refresh");
        $("#groupbydataupdate").html("");  
        // return false
    }else{
      $('#groupbyconditionupdate_error').remove()
      $('#groupbyconditionupdate').trigger("click")
    }
  });

  $('#aggregatefunctions').change(function(){
    $("#aggregatefunctions").selectpicker("refresh");
    var groupbycond_val = $('#groupbycondition').val()
    if(groupbycond_val == null){
      var columnname_errormsg = "Please select groupby condition"
      var groupbycond_val_error = columnname_errormsg;
      $('#groupbycondition_error').remove()
      $('#groupbycondition').after("<span id='groupbycondition_error' class='error_msg'>"+groupbycond_val_error+"</span>");
        $("#aggregatefunctions option:selected").prop("selected", false)
        $("#aggregatefunctions").selectpicker("refresh");
        $("#groupbydataupdate").html("");  
        // return false
    }else{
      $('#groupbycondition_error').remove()
      $('#groupbycondition').trigger("click")
    }
  });


  //---------------orderby_query-----------------------------------------------
  $("#select_tablename").click(function(){
     var tableid =  $("#select_tablename :selected").val();
     var pathname = window.location.pathname;
     var get_projectid=pathname.split('/')
     var get_projectidex=get_projectid[2]
     var projectid=get_projectidex
  
    $.ajax({
      type : 'POST',
      url :"/ajaxwhere_tablelist/",
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data) {
        $('#orderby_table').empty();
        $('#orderby_table').append('<option value="" disabled selected>{{ get_chache_selecttableerrormsg }}</option>');
        $.each(data.table_data, function(idx2,kvalue){ 
          $('#orderby_table').append('<option value="'+kvalue.id+'">'+kvalue.tablename+'</option>');
        });
      }
    });
  });

  $("#groupbycondition").click(function(){
    var find_from_select = $('#selectquery').html();
    let from_index = find_from_select.indexOf("from");
    var groupbycondition_val = $("#groupbycondition").val();
    var groupby_columnlist_string =$("#aggregatefunctions").val();
    var groupby_columnlist_val = JSON.stringify(groupby_columnlist_string);
    var value =  $("#selectpicker :selected").map((_, e) => e.text).get();
    string = JSON.stringify(value);
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    var tableid =  $("#select_tablename").val();
    var aliasesname=$("#select_tablename :selected").data("aliases");

    var jointableselect_column_val =  $("#Joincolumnname :selected").map((_, e) => e.text).get();
    var joinselectcolumn_name= JSON.stringify(jointableselect_column_val);
    $("#groupbydata").html("")
    if(from_index != -1){
      var query_q = $('#queryset').text();
      var query_ans1 = $.trim(query_q.replace(/\s/g, ' '))
      var query_ans = query_ans1.replace(/ +/g, " ")
      var val_str = query_ans.split("from")
      if(groupby_columnlist_string.length == 0 && groupbycondition_val != null){
        $("#groupbydata").html("");
      }else{
          $.ajax({
            type : 'POST',
            url :"/groupbycondition_query/",
            async: false,
            data:{'groupbycondition_val':groupbycondition_val,'groupby_columnlist_val':groupby_columnlist_val,'string':string,'projectid':projectid,'tableid':tableid,'aliasesname':aliasesname,'joinselectcolumn_name':joinselectcolumn_name},
            dataType : 'json',
            success : function(data){
              if(data.status =='success'){
                $("#groupbydata").html(data.query);
                var data_groupby = data.query
                var value_query = insertAtIndex(query_ans, data_groupby, from_index)
                $('#exampleFormControlTextarea1').val(value_query);
              }
              else{
                $("#groupbydata").html(data.query);
                var data_groupby = data.query
                var value_query = insertAtIndex(query_ans, data_groupby, from_index)
                $('#exampleFormControlTextarea1').val(value_query);
              }
            }
          });
        }
        
    }else{
      $.ajax({
            type : 'POST',
            url :"/groupbycondition_query/",
            async: false,
            data:{'groupbycondition_val':groupbycondition_val,'groupby_columnlist_val':groupby_columnlist_val,'string':string,'projectid':projectid,'tableid':tableid,'aliasesname':aliasesname,'joinselectcolumn_name':joinselectcolumn_name},
            dataType : 'json',
            success : function(data){
              if(data.status =='success'){
                $("#groupbydata").html(data.query);
              }
              else{
                $("#groupbydata").html(data.query);
              }
            }
          });
      var q = $('#queryset').text();
      var ans1 = $.trim(q.replace(/\s/g, ' '))
      var ans = ans1.replace(/ +/g, " ")
      $('#exampleFormControlTextarea1').val(ans);     
    }
    
  });
  $("#groupbyconditionupdate").click(function(){
    
    var groupby_columnlist_string =$("#aggregatefunctionsupdate").val();
    var groupby_columnlist_val = JSON.stringify(groupby_columnlist_string);
    var value =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
    var groupby_updatecolumnlist = $("#groupby_updatecolumnlist :selected").map((_, e) => e.text).get();
    string = JSON.stringify(value);
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    var tableid =  $("#update_tablename").val();
    var aliasesname=$("#update_tablename :selected").data("aliases");

    var jointableselect_column_val =  $("#Joinupdatecolumnname :selected").map((_, e) => e.text).get();
    var joinselectcolumn_name= JSON.stringify(jointableselect_column_val);
    
    var tablename = $('#update_tablename :selected').text()
    var columnname =  $("#selectpicker1 :selected").map((_, e) => e.text).get();
    var aliasesname = $("#update_tablename :selected").data("aliases");
    var stringvalarray = []
    $('#groupbyconditionupdate_error').remove()
    if(tablename != null && tablename != '' && columnname != null && columnname != '' && jointableselect_column_val.length == 0){
            for(var i = 0; i < columnname.length; i++){
                  var strvalconvert=aliasesname+'.'+columnname[i]+' as '+aliasesname+'_'+columnname[i]
                  stringvalarray.push(strvalconvert)
                  var my_string = stringvalarray.join()
                        }
              var data = "select "+my_string+" from "+ tablename +" as "+ aliasesname +"" 
              $("#selectqueryupdate").html(data); 
            }
   
    if(groupby_columnlist_string.length == 0 && groupbycondition_val != null){
      $("#groupbydataupdate").html("");
    }else{
      $.ajax({
        type : 'POST',
        url :"/groupbycondition_query/",
        async: false,
        data:{'groupbycondition_val':groupbycondition_val,'groupby_columnlist_val':groupby_columnlist_val,'string':string,'projectid':projectid,'tableid':tableid,'aliasesname':aliasesname,'joinselectcolumn_name':joinselectcolumn_name},
        dataType : 'json',
        success : function(data){
          if(data.status =='success'){
              $("#groupbydataupdate").html(data.query);
          }
          else{
            $("#groupbydataupdate").html(data.query);
          }
        }
      });   
    }          
    var q = $('#querysetupdate').text();
    var ans1 = $.trim(q.replace(/\s/g, ' '))
    var ans = ans1.replace(/ +/g, " ")
    $('#querycontent_data').val(ans); 
  });
  
 
  $("#orderby_table").click(function(){
    var tableid =  $("#select_tablename :selected").val();
    var pathname = window.location.pathname;
    var get_projectid=pathname.split('/')
    var get_projectidex=get_projectid[2]
    var projectid=get_projectidex
    
    $.ajax({
      url :"/column_list/",
      type : 'POST',
      async: false,
      data:{'projectid':projectid,'tableid':tableid},
      dataType : 'json',
      success : function(data){
        $('#orderby_columnlist').empty();
        $('#orderby_columnlist').append('<option value="" disabled>{{ get_chache_selectcolumnerror }}</option>');
        $('#orderby_columnlist').append('<option value="">id</option>');
        $('#orderby_columnlist').append('<option value="">status</option>')
        $('#orderby_columnlist').append('<option value="createdon">createdon</option>');
        $('#orderby_columnlist').append('<option value="createdby">createdby</option>');
        $('#orderby_columnlist').append('<option value="modifiedon">modifiedon</option>');
        $('#orderby_columnlist').append('<option value="modifiedby">modifiedby</option>'); 
        $.each(data.get_columnname, function(idx2,kvalue){ 
          $('#orderby_columnlist').append('<option value="'+kvalue.id+'">'+kvalue.columnname+'</option>');
        });     
      }
    });
  });
  
  $("#orferby_go").click(function(){
    var columnname =  $("#orderby_columnlist :selected").text();
    var columnname_val =  $("#orderby_columnlist :selected").val();
    var pathname = window.location.pathname;
    var get_projectid=pathname.split('/')
    var get_projectidex=get_projectid[2]
    var projectid=get_projectidex
    var orderbyvalues= $("#orderbylist :selected").val();
    
   
    var aliasesname=$("#select_tablename :selected").data("aliases");
    var orderbytext = $('#orderbyquery').html();
  
    var tableid =  $("#select_tablename").val();
    var orderby_tablename =$('#orderby_table').val();
    
    $('#orderby_tablename_error').remove();
    $("#orderbyvalues_error").remove();
    var ermsg = 0;
    var orderby_tablenameerrmsg ="{{ get_chache_groupbytablename }}"
    if(orderby_tablename =="{{ get_chache_selecttableerrormsg }}"){
      orderby_tablename_error = orderby_tablenameerrmsg
      $('#orderby_table').after("<span id='orderby_tablename_error' class='error_msg'>"+orderby_tablename_error+"</span>");
      ermsg =1;
    }
    var ordertype_errormsg ="{{ get_chache_orderbytypeerrormsg }}"
    if(orderbyvalues=="{{ get_chache_selectlisterror }}"){
      var orderbyvalues_error= ordertype_errormsg
      $('#orderbylist').after("<span id='orderbyvalues_error' class='error_msg'>"+orderbyvalues_error+"</span>");
      ermsg =1;
    }
    if(ermsg){
      return false
    }
  $.ajax({
      type:'POST',
      url:"/orderby_query/",
      async:false,
      data:{'columnname':columnname,'orderbyvalues':orderbyvalues,'aliasesname':aliasesname,'orderbytext':orderbytext,'tableid':tableid,'projectid':projectid},
      datatype:'json',
      success : function(data){
        if(columnname){
          $("#orderbyquery").append(data.query);
          $("#groupby_hideshow").hide();
          $("#limits_hideshow").hide();
        }else{
          $("#groupby_hideshow").show();
          $("#limits_hideshow").show();
          $("#orderbyquery").empty();
        }
      }
  });
  $("#orderby_columnlist").val([]);
  $("#orderbylist").val([]);
  $("#orderby_table").val([]);
  });
  //----------------------limits---------------------------------------------
  
  $("#limitsnumbers").click(function(){
  var limitsvalue = $("[name='properties[wallpaper_size_width]']").val();
  $.ajax({
    type:'POST',
    url:"/limits_query/",
    async:false,
    data:{'limitsvalue':limitsvalue},
    datatype:'json',
    success : function(data) {
      if(limitsvalue){
        $("#limitsquery").html(data.query);
        $("#groupby_hideshow").hide();
        $("#orderby_hideshow").hide();
      }else{
        $("#groupby_hideshow").show();
        $("#orderby_hideshow").show();
        $("#limitsquery").empty();
        }
      }
    });
  });
  
  // ---------------------textarea_box----------------------------------------------
  $(".overflow").click(function(){
    var query= "";
    $("#queryset span").each(function(){
      query += $(this).text();
    });
    var ans1 = $.trim(query.replace(/\s/g, ' '))
    var query = ans1.replace(/ +/g, " ")
    $("#exampleFormControlTextarea1").html(query);
    $('#selectquery').attr('disabled');
    $('#joinquery').addClass('disabled');
    $('#wherequery').addClass('disabled');
    $('#groupbyquery').addClass('disabled');
    $('#orderbyquery').addClass('disabled');
    $('#limitsquery').addClass('disabled');
   });
</script>
<!--############################## Query save to query generator table code start ###################-->

<script>
  var jointablesid = [];
  $('#jointables').click(function(){
    var jointableid = $('#jointables').val();
    jointablesid.push({"jointablesid":jointableid});
  });

  $('#query_savebutton').click(function(){
    var urllist = window.location.pathname;
    var url=urllist.split('/');
    var projectid=url[2];
    var querdata= $("#exampleFormControlTextarea1").val();
    var queryshortname =$('#queryshortname').val();
    var pageid =$("#pagename").val();
    var array = pageid.split(",");
    var pageid_valu =(array[2]);
    var tablename = $('#select_tablename').val()


    $('#queryshortname_error').remove();
    $('#querdata_error').remove();

    var ermsg =0
    var queryshortname_errormsg ="{{ get_cache_queryshortnameerrormsg }}"
    var querdata_errormsg ="{{ get_cache_querdataerrormsg }}"
    if(!queryshortname){
      queryshortname_error = queryshortname_errormsg
      $('#queryshortname').after("<span id='queryshortname_error' class='error_msg'>"+queryshortname_error+"</span>");
      ermsg =1;
    }
    if(!querdata){
      querdata_error = querdata_errormsg
      $('#exampleFormControlTextarea1').after("<span id='querdata_error' class='error_msg' style='display: block'>"+querdata_error+"</span>");
      ermsg =1;
    }
    if(ermsg){
      setTimeout(function(){
            $('#queryshortname_error').remove();
            $('#querdata_error').remove();
            }, 2000)
      return false
    }
    $.ajax({
      type:'POST',
      url:"/query_generatoradd/",
      async:false,
      data:{
        'projectid':projectid,
        'querdata':querdata,
        'pageid_valu':pageid_valu,
        'queryshortname':queryshortname,
        'tablename':tablename,
        'jointablesid':JSON.stringify(jointablesid)
      },
      datatype:'json',
      success : function(data){
        $('#querdata_message').remove();
        if(data.status =='success'){
        querdata_message = (data.message);
        error_msg = 0;
        $('#exampleFormControlTextarea1').after("<p id='querdata_message' style='color:green;font-family: 'Roboto', sans-serif;'>"+querdata_message+"</p>");
        $('#querydatalist').empty();
        $.each(data.query_tablelist, function(index, value){
          var queryid =(value.id);
          var querypage =value.pageid;
          var querystatus =value.status;
          var queryshortname =value.queryshortname;
          $('#querydatalist').append('<tr class="tablequerylistdata" id ="delectqueryrow'+queryid+'"><td id="querydataid" >'+queryid+'</td><td id="querydatapage">'+querypage+'</td><td id ="querydatastatus">'+querystatus+'</td><td id ="querydatashortname'+queryid+'" >'+queryshortname+'</td><td class="dev-icons" style="padding-left:30px;"><i class="fa fa-edit me-2" aria-hidden="true" onclick="editquery('+querypage+','+queryid+')"></i><i class="fa fa-trash ms-3" aria-hidden="true" onclick="deletequery('+querypage+','+queryid+')"></i></td></tr>');
        });
        error_msg = 0;
        setTimeout(function(){
            $('#querdata_message').remove();
            }, 2000)
      }
      else{
        querdata_message = (data.message);
        $('#exampleFormControlTextarea1').after("<p id='querdata_message' style='color:red;font-family: 'Roboto', sans-serif;'>"+querdata_message+"</p>");
        error_msg = 1;
        setTimeout(function(){
            $('#querdata_message').remove();
            }, 2000)
      }
      if(error_msg){
            return false
        }
      }
    });
  });



$("#selectcolumn_alisename").click(function(){
  var get_aliasesname=$("#jointables :selected").data("aliases");
  $('#column_alisename').html(function(i, val) { return val*1+1 });
  get_randomnum =$("#column_alisename").html();
  joincolmun_aliasesname=(get_aliasesname + get_randomnum)  

});
</script>
<script>
  function insertAtIndex(str, substring, index) {
  return str.slice(0, index) + substring + str.slice(index);
}
</script>
<script>
  $(document).ready(function(){
    $("#groupbytoggledisplay").click(function(){
     $("#groupby_updatehideshow").toggle()
    })
  })
</script> 

<!-- ############# new --> 
<script>
  $(document).ready(function(){
    $("#groupbytoggledisplay").click(function(){
     $("#groupby_updatehideshow").toggle()
    })
  })
  $("#Joincolumnname").change(function (){
  var key =  $("#Joincolumnname :selected").map((_, e) => e.value).get();
  var value =  $("#Joincolumnname :selected").map((_, e) => e.text).get();
  column_data = value
  for(var i = 0; i < value.length; i++){
    if(value[i] == "select all"){
      $('#Joincolumnname option').prop('selected', true);
      $("#Joincolumnname option:first-child" ).prop('selected', false);
      $('#Joincolumnname option[value ="select all"]').prop('selected', false); 
      $("#Joincolumnname").selectpicker("refresh")
    }
    }
  });
</script>  


<!--############################## Query save to query generator table code end ###################-->

<script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
